import{r as n,j as u}from"./react-C4wAxbNA.js";import{P as T}from"./vendor-BBRlQ_zh.js";import{g as i}from"./gsap-CH_iu5NA.js";import{C as M}from"./index-DKontgsU.js";import"./leaflet-BcfEFI1A.js";import"./three-Hf6x_wfq.js";const F=({imageSrc:v,hoverImageSrc:j})=>{const f=n.useRef(null),d=n.useRef(null),[h,w]=n.useState(!1),[m,k]=n.useState(1),[x,E]=n.useState(!0),c=n.useRef(null),p=n.useRef([]),l=n.useCallback(()=>{const e=p.current;e.length&&(e.forEach(t=>{i.set(t,{x1:t.x0+(Math.random()-.5)*20,y1:-50-Math.random()*30})}),e.forEach(t=>{i.to(t,{duration:t.speed,x1:t.x0,y1:t.y0,delay:t.y0/200+Math.random()*.3,ease:"elastic.out(1, 0.5)"})}))},[]);n.useEffect(()=>(c.current=new Worker(new URL("/assets/particleWorker-CaFAatOH.js",import.meta.url)),c.current.onmessage=e=>{const t=e.data;p.current=t,l()},()=>{c.current&&c.current.terminate()}),[l]),n.useEffect(()=>{const e=new Image;e.onload=()=>{const t=f.current;if(!t)return;t.width=e.width*2,t.height=e.height*2,k(e.width/e.height);const s=new OffscreenCanvas(e.width,e.height);s.getContext("2d").drawImage(e,0,0);const a=s.transferToImageBitmap();c.current&&c.current.postMessage({imageBitmap:a,width:e.width,height:e.height},[a]),E(!1)},e.onerror=()=>{console.warn("EffectAvatar: 图片加载失败:",v),E(!1)},e.src=v},[v]),n.useEffect(()=>{const e=f.current;if(!e)return;const t=e.getContext("2d",{willReadFrequently:!0,alpha:!1});let s;const r=()=>{t.clearRect(0,0,e.width,e.height);const a=p.current;a.length>0&&a.forEach(o=>{t.fillStyle=o.color,t.fillRect(o.x1*2,o.y1*2,2,2)}),s=requestAnimationFrame(r)};return s=requestAnimationFrame(r),()=>{s&&cancelAnimationFrame(s)}},[]),n.useEffect(()=>{var a;let e;const t=()=>{const o=f.current;o&&(clearTimeout(e),e=setTimeout(()=>{const R=o.parentElement;if(!R)return;const{clientWidth:C,clientHeight:b}=R;let g,y;C/b>m?(y=b,g=y*m):(g=C,y=g/m),o.style.width=`${g}px`,o.style.height=`${y}px`},150))},s=new ResizeObserver(t),r=(a=f.current)==null?void 0:a.parentElement;return r&&s.observe(r),t(),()=>{s.disconnect(),clearTimeout(e)}},[m]);const I=n.useCallback(()=>{var t;w(!0);const e=(t=d.current)==null?void 0:t.parentElement;e&&(i.killTweensOf(e),i.fromTo(e,{opacity:0,transform:"translate(-50%, -50%) scale(0.9)"},{opacity:1,transform:"translate(-50%, -50%) scale(1.0)",duration:.8,ease:"elastic.out"})),l()},[l]),z=n.useCallback(()=>{var t;const e=(t=d.current)==null?void 0:t.parentElement;e&&(i.killTweensOf(e),i.to(e,{opacity:0,transform:"translate(-50%, -50%) scale(0.9)",duration:.8,ease:"elastic.out",onComplete:()=>{w(!1),setTimeout(l,100)}}))},[l]);return n.useEffect(()=>{const e=d.current,t=p.current;return()=>{const s=e==null?void 0:e.parentElement;s&&i.killTweensOf(s),t&&t.forEach(r=>{i.killTweensOf(r)})}},[]),u.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",zIndex:3},onMouseEnter:I,onMouseLeave:z,children:[x&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-800 rounded-full",children:u.jsx(M,{size:60,strokeWidth:4,showMask:!1,className:"opacity-80"})}),u.jsx("canvas",{ref:f,style:{width:"100%",height:"100%",cursor:"pointer",objectFit:"cover",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -30%) scale(1.5)",opacity:x?0:h?.1:.85,transition:"opacity 0.5s ease",zIndex:1,imageRendering:"auto",willChange:h?"opacity":"auto"}}),u.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"100%",height:"100%",borderRadius:"50%",overflow:"hidden",opacity:h?1:0,visibility:h?"visible":"hidden",transition:"opacity 0.5s ease, visibility 0.5s ease",pointerEvents:"none",zIndex:2,willChange:h?"opacity, transform":"auto"},children:u.jsx("img",{ref:d,src:j,alt:"清晰头像",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"100%",height:"100%",objectFit:"cover",pointerEvents:"none",imageRendering:"auto"},loading:"lazy",decoding:"async"})})]})};F.propTypes={imageSrc:T.string.isRequired,hoverImageSrc:T.string.isRequired};export{F as default};
