import{r as n,j as f}from"./react-N-_5-tx-.js";import{P as k}from"./vendor-RxfllKF0.js";import{g as o}from"./gsap-CH_iu5NA.js";import{C as O}from"./gallery-BAdvkUEb.js";import{O as W}from"./projects-Cq0ttE_e.js";import{w as I}from"./home-BfC_H3ir.js";import"./d3-BbFmVfHF.js";import"./three-CFp4aWDs.js";import"./about-C9SXAjZo.js";import"./texture-system-DiHy9DgQ.js";import"./leaflet-BCigXWF9.js";const A=({imageSrc:v,hoverImageSrc:T})=>{const i=n.useRef(null),d=n.useRef(null),[y,x]=n.useState(!1),[h,j]=n.useState(1),[R,b]=n.useState(!0),c=n.useRef(null),m=n.useRef([]),l=n.useCallback(()=>{const e=m.current;e.length&&(e.forEach(t=>{o.set(t,{x1:t.x0+(Math.random()-.5)*20,y1:-50-Math.random()*30})}),e.forEach(t=>{o.to(t,{duration:t.speed,x1:t.x0,y1:t.y0,delay:t.y0/200+Math.random()*.3,ease:"elastic.out(1, 0.5)"})}))},[]);n.useEffect(()=>(c.current=new Worker(new URL("/assets/particleWorker-CaFAatOH.js",import.meta.url)),c.current.onmessage=e=>{const t=e.data;m.current=t,l()},()=>{c.current&&c.current.terminate()}),[l]),n.useEffect(()=>{const e=new Image;let t=null;return e.onload=()=>{const r=i.current;if(!r)return;r.width=e.width*2,r.height=e.height*2,j(e.width/e.height);const s=new OffscreenCanvas(e.width,e.height);s.getContext("2d").drawImage(e,0,0);const a=s.transferToImageBitmap();c.current&&c.current.postMessage({imageBitmap:a,width:e.width,height:e.height},[a]);const p=r.getContext("2d");t=I.registerResources("EffectAvatar_about",{canvas:r,context2d:p,worker:c.current,offscreenCanvas:s},{persistent:!1}),b(!1)},e.onerror=()=>{console.warn("EffectAvatar: 图片加载失败:",v),b(!1)},e.src=v,()=>{t&&I.cleanup(t)}},[v]),n.useEffect(()=>{const e=i.current;if(!e)return;const t=e.getContext("2d",{willReadFrequently:!0,alpha:!1});let r;const s=()=>{t.clearRect(0,0,e.width,e.height);const u=m.current;u.length>0&&u.forEach(a=>{t.fillStyle=a.color,t.fillRect(a.x1*2,a.y1*2,2,2)}),r=requestAnimationFrame(s)};return r=requestAnimationFrame(s),()=>{r&&cancelAnimationFrame(r)}},[]),n.useEffect(()=>{var u;let e;const t=()=>{const a=i.current;a&&(clearTimeout(e),e=setTimeout(()=>{const p=a.parentElement;if(!p)return;const{clientWidth:E,clientHeight:C}=p;let g,w;E/C>h?(w=C,g=w*h):(g=E,w=g/h),a.style.width=`${g}px`,a.style.height=`${w}px`},150))},r=new ResizeObserver(t),s=(u=i.current)==null?void 0:u.parentElement;return s&&r.observe(s),t(),()=>{r.disconnect(),clearTimeout(e)}},[h]);const M=n.useCallback(()=>{var r;x(!0);const e=i.current;e&&o.to(e,{opacity:.1,duration:.3,ease:"power2.out"});const t=(r=d.current)==null?void 0:r.parentElement;t&&(o.killTweensOf(t),o.fromTo(t,{opacity:0,transform:"translate(-50%, -50%) scale(0.9)"},{opacity:1,transform:"translate(-50%, -50%) scale(1.0)",duration:.8,ease:"elastic.out"})),l()},[l]),z=n.useCallback(()=>{var r;x(!1);const e=i.current;e&&o.to(e,{opacity:.85,duration:.5,ease:"power2.out"});const t=(r=d.current)==null?void 0:r.parentElement;t&&(o.killTweensOf(t),o.to(t,{opacity:0,transform:"translate(-50%, -50%) scale(0.9)",duration:.8,ease:"elastic.out",onComplete:()=>{setTimeout(l,100)}}))},[l]);return n.useEffect(()=>{const e=d.current,t=m.current;return()=>{const r=e==null?void 0:e.parentElement;r&&o.killTweensOf(r),t&&t.forEach(s=>{o.killTweensOf(s)})}},[]),f.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",zIndex:3},onMouseEnter:M,onMouseLeave:z,children:[R&&f.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-800 rounded-full",children:f.jsx(O,{size:60,strokeWidth:4,showMask:!1,className:"opacity-80"})}),f.jsx("canvas",{ref:i,style:{width:"100%",height:"100%",cursor:"pointer",objectFit:"cover",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -30%) scale(1.5)",opacity:R?0:.85,zIndex:1,imageRendering:"auto"}}),f.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"100%",height:"100%",borderRadius:"50%",overflow:"hidden",opacity:y?1:0,visibility:y?"visible":"hidden",transition:"opacity 0.5s ease, visibility 0.5s ease",pointerEvents:"none",zIndex:2,WebkitBorderRadius:"50%",WebkitMaskImage:"radial-gradient(circle, white 100%, black 100%)",willChange:y?"opacity, transform":"auto"},children:f.jsx(W,{ref:d,src:T,alt:"清晰头像",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"100%",height:"100%",objectFit:"cover",pointerEvents:"none",borderRadius:"50%",WebkitBorderRadius:"50%",imageRendering:"auto"},loading:"lazy",decoding:"async"})})]})};A.propTypes={imageSrc:k.string.isRequired,hoverImageSrc:k.string.isRequired};export{A as default};
