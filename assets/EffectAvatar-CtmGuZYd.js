import{r as s,j as u}from"./react-DudRe3MH.js";import{P as k}from"./vendor-D2t9TNkl.js";import{g as o}from"./gsap-CH_iu5NA.js";import{C as z}from"./CircularLoadingIndicator-BO6eWUEl.js";import{w as I}from"./index-C_P_3xmA.js";import"./leaflet-BcfEFI1A.js";import"./three-Hf6x_wfq.js";const A=({imageSrc:y,hoverImageSrc:T})=>{const f=s.useRef(null),h=s.useRef(null),[d,x]=s.useState(!1),[m,j]=s.useState(1),[R,b]=s.useState(!0),i=s.useRef(null),p=s.useRef([]),c=s.useCallback(()=>{const e=p.current;e.length&&(e.forEach(t=>{o.set(t,{x1:t.x0+(Math.random()-.5)*20,y1:-50-Math.random()*30})}),e.forEach(t=>{o.to(t,{duration:t.speed,x1:t.x0,y1:t.y0,delay:t.y0/200+Math.random()*.3,ease:"elastic.out(1, 0.5)"})}))},[]);s.useEffect(()=>(i.current=new Worker(new URL("/assets/particleWorker-CaFAatOH.js",import.meta.url)),i.current.onmessage=e=>{const t=e.data;p.current=t,c()},()=>{i.current&&i.current.terminate()}),[c]),s.useEffect(()=>{const e=new Image;let t=null;return e.onload=()=>{const r=f.current;if(!r)return;r.width=e.width*2,r.height=e.height*2,j(e.width/e.height);const n=new OffscreenCanvas(e.width,e.height);n.getContext("2d").drawImage(e,0,0);const a=n.transferToImageBitmap();i.current&&i.current.postMessage({imageBitmap:a,width:e.width,height:e.height},[a]);const g=r.getContext("2d");t=I.registerResources("EffectAvatar_about",{canvas:r,context2d:g,worker:i.current,offscreenCanvas:n},{persistent:!1}),b(!1)},e.onerror=()=>{console.warn("EffectAvatar: 图片加载失败:",y),b(!1)},e.src=y,()=>{t&&I.cleanup(t)}},[y]),s.useEffect(()=>{const e=f.current;if(!e)return;const t=e.getContext("2d",{willReadFrequently:!0,alpha:!1});let r;const n=()=>{t.clearRect(0,0,e.width,e.height);const l=p.current;l.length>0&&l.forEach(a=>{t.fillStyle=a.color,t.fillRect(a.x1*2,a.y1*2,2,2)}),r=requestAnimationFrame(n)};return r=requestAnimationFrame(n),()=>{r&&cancelAnimationFrame(r)}},[]),s.useEffect(()=>{var l;let e;const t=()=>{const a=f.current;a&&(clearTimeout(e),e=setTimeout(()=>{const g=a.parentElement;if(!g)return;const{clientWidth:E,clientHeight:C}=g;let w,v;E/C>m?(v=C,w=v*m):(w=E,v=w/m),a.style.width=`${w}px`,a.style.height=`${v}px`},150))},r=new ResizeObserver(t),n=(l=f.current)==null?void 0:l.parentElement;return n&&r.observe(n),t(),()=>{r.disconnect(),clearTimeout(e)}},[m]);const M=s.useCallback(()=>{var t;x(!0);const e=(t=h.current)==null?void 0:t.parentElement;e&&(o.killTweensOf(e),o.fromTo(e,{opacity:0,transform:"translate(-50%, -50%) scale(0.9)"},{opacity:1,transform:"translate(-50%, -50%) scale(1.0)",duration:.8,ease:"elastic.out"})),c()},[c]),W=s.useCallback(()=>{var t;const e=(t=h.current)==null?void 0:t.parentElement;e&&(o.killTweensOf(e),o.to(e,{opacity:0,transform:"translate(-50%, -50%) scale(0.9)",duration:.8,ease:"elastic.out",onComplete:()=>{x(!1),setTimeout(c,100)}}))},[c]);return s.useEffect(()=>{const e=h.current,t=p.current;return()=>{const r=e==null?void 0:e.parentElement;r&&o.killTweensOf(r),t&&t.forEach(n=>{o.killTweensOf(n)})}},[]),u.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",zIndex:3},onMouseEnter:M,onMouseLeave:W,children:[R&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-800 rounded-full",children:u.jsx(z,{size:60,strokeWidth:4,showMask:!1,className:"opacity-80"})}),u.jsx("canvas",{ref:f,style:{width:"100%",height:"100%",cursor:"pointer",objectFit:"cover",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -30%) scale(1.5)",opacity:R?0:d?.1:.85,transition:"opacity 0.5s ease",zIndex:1,imageRendering:"auto",willChange:d?"opacity":"auto"}}),u.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"100%",height:"100%",borderRadius:"50%",overflow:"hidden",opacity:d?1:0,visibility:d?"visible":"hidden",transition:"opacity 0.5s ease, visibility 0.5s ease",pointerEvents:"none",zIndex:2,WebkitBorderRadius:"50%",WebkitMaskImage:"radial-gradient(circle, white 100%, black 100%)",willChange:d?"opacity, transform":"auto"},children:u.jsx("img",{ref:h,src:T,alt:"清晰头像",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"100%",height:"100%",objectFit:"cover",pointerEvents:"none",borderRadius:"50%",WebkitBorderRadius:"50%",imageRendering:"auto"},loading:"lazy",decoding:"async"})})]})};A.propTypes={imageSrc:k.string.isRequired,hoverImageSrc:k.string.isRequired};export{A as default};
