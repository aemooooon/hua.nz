import{r,j as u}from"./react-DudRe3MH.js";import{P as k}from"./vendor-D2t9TNkl.js";import{g as o}from"./gsap-CH_iu5NA.js";import{C as W}from"./CircularLoadingIndicator-BO6eWUEl.js";import"./leaflet-BcfEFI1A.js";const z=({imageSrc:y,hoverImageSrc:T})=>{const f=r.useRef(null),h=r.useRef(null),[d,v]=r.useState(!1),[m,j]=r.useState(1),[x,R]=r.useState(!0),c=r.useRef(null),p=r.useRef([]),l=r.useCallback(()=>{const e=p.current;e.length&&(e.forEach(t=>{o.set(t,{x1:t.x0+(Math.random()-.5)*20,y1:-50-Math.random()*30})}),e.forEach(t=>{o.to(t,{duration:t.speed,x1:t.x0,y1:t.y0,delay:t.y0/200+Math.random()*.3,ease:"elastic.out(1, 0.5)"})}))},[]);r.useEffect(()=>(c.current=new Worker(new URL("/assets/particleWorker-CaFAatOH.js",import.meta.url)),c.current.onmessage=e=>{const t=e.data;p.current=t,l()},()=>{c.current&&c.current.terminate()}),[l]),r.useEffect(()=>{const e=new Image;e.onload=()=>{const t=f.current;if(!t)return;t.width=e.width*2,t.height=e.height*2,j(e.width/e.height);const n=new OffscreenCanvas(e.width,e.height);n.getContext("2d").drawImage(e,0,0);const a=n.transferToImageBitmap();c.current&&c.current.postMessage({imageBitmap:a,width:e.width,height:e.height},[a]),R(!1)},e.onerror=()=>{console.warn("EffectAvatar: 图片加载失败:",y),R(!1)},e.src=y},[y]),r.useEffect(()=>{const e=f.current;if(!e)return;const t=e.getContext("2d",{willReadFrequently:!0,alpha:!1});let n;const s=()=>{t.clearRect(0,0,e.width,e.height);const a=p.current;a.length>0&&a.forEach(i=>{t.fillStyle=i.color,t.fillRect(i.x1*2,i.y1*2,2,2)}),n=requestAnimationFrame(s)};return n=requestAnimationFrame(s),()=>{n&&cancelAnimationFrame(n)}},[]),r.useEffect(()=>{var a;let e;const t=()=>{const i=f.current;i&&(clearTimeout(e),e=setTimeout(()=>{const E=i.parentElement;if(!E)return;const{clientWidth:b,clientHeight:C}=E;let g,w;b/C>m?(w=C,g=w*m):(g=b,w=g/m),i.style.width=`${g}px`,i.style.height=`${w}px`},150))},n=new ResizeObserver(t),s=(a=f.current)==null?void 0:a.parentElement;return s&&n.observe(s),t(),()=>{n.disconnect(),clearTimeout(e)}},[m]);const I=r.useCallback(()=>{var t;v(!0);const e=(t=h.current)==null?void 0:t.parentElement;e&&(o.killTweensOf(e),o.fromTo(e,{opacity:0,transform:"translate(-50%, -50%) scale(0.9)"},{opacity:1,transform:"translate(-50%, -50%) scale(1.0)",duration:.8,ease:"elastic.out"})),l()},[l]),M=r.useCallback(()=>{var t;const e=(t=h.current)==null?void 0:t.parentElement;e&&(o.killTweensOf(e),o.to(e,{opacity:0,transform:"translate(-50%, -50%) scale(0.9)",duration:.8,ease:"elastic.out",onComplete:()=>{v(!1),setTimeout(l,100)}}))},[l]);return r.useEffect(()=>{const e=h.current,t=p.current;return()=>{const n=e==null?void 0:e.parentElement;n&&o.killTweensOf(n),t&&t.forEach(s=>{o.killTweensOf(s)})}},[]),u.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",zIndex:3},onMouseEnter:I,onMouseLeave:M,children:[x&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-800 rounded-full",children:u.jsx(W,{size:60,strokeWidth:4,showMask:!1,className:"opacity-80"})}),u.jsx("canvas",{ref:f,style:{width:"100%",height:"100%",cursor:"pointer",objectFit:"cover",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -30%) scale(1.5)",opacity:x?0:d?.1:.85,transition:"opacity 0.5s ease",zIndex:1,imageRendering:"auto",willChange:d?"opacity":"auto"}}),u.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"100%",height:"100%",borderRadius:"50%",overflow:"hidden",opacity:d?1:0,visibility:d?"visible":"hidden",transition:"opacity 0.5s ease, visibility 0.5s ease",pointerEvents:"none",zIndex:2,WebkitBorderRadius:"50%",WebkitMaskImage:"radial-gradient(circle, white 100%, black 100%)",willChange:d?"opacity, transform":"auto"},children:u.jsx("img",{ref:h,src:T,alt:"清晰头像",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"100%",height:"100%",objectFit:"cover",pointerEvents:"none",borderRadius:"50%",WebkitBorderRadius:"50%",imageRendering:"auto"},loading:"lazy",decoding:"async"})})]})};z.propTypes={imageSrc:k.string.isRequired,hoverImageSrc:k.string.isRequired};export{z as default};
