import{_ as h}from"./about--wHcT9wa.js";import{T as v,k as w,H as m,q as p,x as S,s as y,f as b,V as D,r as z}from"./three-Br820KFa.js";const G={async getBestFormat(){const{formatDetector:n}=await h(async()=>{const{formatDetector:e}=await Promise.resolve().then(()=>A);return{formatDetector:e}},void 0);return n.getBestFormat()},async getCompressionInfo(){const{formatDetector:n}=await h(async()=>{const{formatDetector:e}=await Promise.resolve().then(()=>A);return{formatDetector:e}},void 0);return n.getCompressionInfo()},async loadTexture(n,e){const{textureLoader:t}=await h(async()=>{const{textureLoader:a}=await Promise.resolve().then(()=>_);return{textureLoader:a}},void 0);return t.loadTexture(n,e)},async loadCubeTextures(n,e){const{textureManager:t}=await h(async()=>{const{textureManager:a}=await Promise.resolve().then(()=>T);return{textureManager:a}},void 0);return t.loadCubeTextures(n,e)},async preloadTextures(n,e){const{textureLoader:t}=await h(async()=>{const{textureLoader:a}=await Promise.resolve().then(()=>_);return{textureLoader:a}},void 0);return t.preloadTextures(n,e)},getStats(){return{legacy:"ä½¿ç”¨ textureManager.getPerformanceStats() èŽ·å–ä¼ ç»Ÿç³»ç»Ÿç»Ÿè®¡",unified:"ä½¿ç”¨ textureSystem.getStats() èŽ·å–æ–°ç³»ç»Ÿç»Ÿè®¡"}},clearCache(){h(async()=>{const{textureManager:n}=await Promise.resolve().then(()=>T);return{textureManager:n}},void 0).then(({textureManager:n})=>{n.clearCache&&n.clearCache()}),h(async()=>{const{textureSystem:n}=await Promise.resolve().then(()=>x);return{textureSystem:n}},void 0).then(({textureSystem:n})=>{n.cleanup()})},async loadSceneTextures(n,e){const{textureSystem:t}=await h(async()=>{const{textureSystem:a}=await Promise.resolve().then(()=>x);return{textureSystem:a}},void 0);return t.loadSceneTextures(n,e)},async loadHeroCubeTextures(n){const e=n.filter(a=>a.texture).map(a=>a.texture),t=n.filter(a=>a.video).map(a=>({name:a.name,src:a.video}));return this.loadSceneTextures("hero-cube",{textures:e,videos:t})},async loadGalleryTextures(n,e={}){return this.loadSceneTextures("gallery",{images:n,folder:e.folder||"gallery",...e})},async getOptimalPath(n,e){if(e){const{textureSystem:t}=await h(async()=>{const{textureSystem:a}=await Promise.resolve().then(()=>x);return{textureSystem:a}},void 0);return t.getOptimalPath(n,e)}else{const{textureLoader:t}=await h(async()=>{const{textureLoader:a}=await Promise.resolve().then(()=>_);return{textureLoader:a}},void 0);return t.getOptimalPath(n)}}};class ${constructor(){this.supportCache=new Map,this.initializationPromise=this.initializeSupport()}async initializeSupport(){const[e,t]=await Promise.all([this.detectAVIFSupport(),this.detectWebPSupport()]);return this.supportCache.set("avif",e),this.supportCache.set("webp",t),this.supportCache}async detectAVIFSupport(){try{console.log("ðŸ” å¼€å§‹AVIFæ”¯æŒæ£€æµ‹...");const e="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgABogQEAwgMg8f8D///8WfhwB8+ErK42A=";return new Promise(t=>{const a=new Image;a.onload=()=>{console.log("âœ… AVIFæ”¯æŒæ£€æµ‹: æˆåŠŸ"),t(!0)},a.onerror=r=>{console.log("âŒ AVIFæ”¯æŒæ£€æµ‹: å¤±è´¥",r),t(!1)},a.src=e,setTimeout(()=>{console.log("â° AVIFæ”¯æŒæ£€æµ‹: è¶…æ—¶"),t(!1)},3e3)})}catch(e){return console.warn("âŒ AVIFæ£€æµ‹å¼‚å¸¸:",e),!1}}async detectWebPSupport(){try{const e="data:image/webp;base64,UklGRjoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==";return new Promise(t=>{const a=new Image;a.onload=()=>t(!0),a.onerror=()=>t(!1),a.src=e})}catch(e){return console.warn("WebPæ£€æµ‹å¼‚å¸¸:",e),!1}}async isFormatSupported(e){return await this.initializationPromise,this.supportCache.get(e.toLowerCase())||!1}async getAllSupport(){return await this.initializationPromise,Object.fromEntries(this.supportCache)}async getBestFormat(){await this.initializationPromise;const e=this.supportCache.get("avif"),t=this.supportCache.get("webp");let a;return e?a="avif":t?a="webp":a="jpg",console.log(`ðŸŽ¯ é€‰æ‹©æœ€ä½³æ ¼å¼: ${a.toUpperCase()} (AVIFæ”¯æŒ: ${e}, WebPæ”¯æŒ: ${t})`),a}async getCompressionInfo(){const e=await this.getBestFormat(),a={jpg:{ratio:1,description:"åŽŸå§‹JPEGæ ¼å¼",quality:"baseline",compression:"æ— é¢å¤–åŽ‹ç¼©"},webp:{ratio:.65,description:"WebPæ ¼å¼ï¼Œå¹³å‡å‡å°‘35%æ–‡ä»¶å¤§å°",quality:"good",compression:"é«˜æ•ˆæœ‰æŸ/æ— æŸåŽ‹ç¼©"},avif:{ratio:.45,description:"AVIFæ ¼å¼ï¼Œå¹³å‡å‡å°‘55%æ–‡ä»¶å¤§å°",quality:"excellent",compression:"æœ€æ–°AV1ç¼–ç ï¼Œæœ€ä½³åŽ‹ç¼©æ¯”"}}[e];return{format:e.toUpperCase(),...a,savings:Math.round((1-a.ratio)*100)}}}const B=new $,A=Object.freeze(Object.defineProperty({__proto__:null,FormatDetector:$,formatDetector:B},Symbol.toStringTag,{value:"Module"}));class P{constructor(e={}){this.loader=new v,this.cache=new Map,this.loadingPromises=new Map,this.config={enableCache:!0,enableFallback:!0,maxRetries:2,timeout:1e4,compression:{maxSize:1024,quality:.9},...e},this.defaultTextureSettings={generateMipmaps:!0,minFilter:S,magFilter:p,wrapS:m,wrapT:m,colorSpace:w}}async getOptimalPath(e,t="cube-textures"){if(console.log(`ðŸ” å¼€å§‹ä¸º ${e} èŽ·å–æœ€ä¼˜è·¯å¾„...`),e&&e.match(/\.(mp4|webm|mov|avi|mkv)$/i))return{primary:`${t}/${e}`,fallback:`${t}/${e}`,format:"video"};const{formatDetector:a}=await h(async()=>{const{formatDetector:l}=await Promise.resolve().then(()=>A);return{formatDetector:l}},void 0),r=await a.getBestFormat();console.log(`ðŸ“‹ æ£€æµ‹åˆ°çš„æœ€ä½³æ ¼å¼: ${r.toUpperCase()}`);const o=e.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,""),s=o.startsWith("gallery-");console.log(`ðŸ” TextureLoader: å¤„ç† ${e}, æ–‡ä»¶å: ${o}, æ ¼å¼: ${r}, æ˜¯Galleryå›¾ç‰‡: ${s}`);let i;s?(i={avif:`gallery-avif/${o}.avif`,webp:`gallery-webp/${o}.webp`,jpg:`gallery/${o}.jpg`},console.log("ðŸ“ ä½¿ç”¨Galleryç›®å½•ç»“æž„:",i)):(i={avif:`cube-textures-avif/${e}.avif`,webp:`cube-textures-webp/${e}.webp`,jpg:`${t}/${e}.jpg`},console.log("ðŸ“ ä½¿ç”¨Cubeç›®å½•ç»“æž„:",i));const c={primary:i[r],fallback:i.jpg,format:r,isGalleryImage:s};return console.log(`ðŸŽ¯ é€‰æ‹©çš„è·¯å¾„: ä¸»è¦=${c.primary}, å¤‡ç”¨=${c.fallback}`),c}async loadTexture(e,t={}){const a=`${e}_${JSON.stringify(t)}`;if(this.config.enableCache&&this.cache.has(a))return console.log(`ðŸ“¦ ä»Žç¼“å­˜åŠ è½½çº¹ç†: ${e}`),this.cache.get(a);if(this.loadingPromises.has(a))return this.loadingPromises.get(a);const r=this._loadTextureWithFallback(e,t);this.loadingPromises.set(a,r);try{const o=await r;return this.config.enableCache&&this.cache.set(a,o),o}finally{this.loadingPromises.delete(a)}}async _loadTextureWithFallback(e,t){const{primary:a,fallback:r,format:o}=await this.getOptimalPath(e),s=`/${a}`,i=`/${r}`;console.log(`ðŸ”„ å¼€å§‹åŠ è½½çº¹ç†: ${e}`),console.log(`ðŸŽ¯ ä¼˜é€‰æ ¼å¼: ${o.toUpperCase()} -> ${s}`),console.log(`ðŸ”„ å¤‡ç”¨æ ¼å¼: JPG -> ${i}`);try{const c=await this._loadSingleTexture(s,t);return console.log(`âœ… çº¹ç†åŠ è½½æˆåŠŸ: ${s}`),c}catch(c){if(console.warn(`âš ï¸ ä¸»æ ¼å¼åŠ è½½å¤±è´¥: ${s}`,c),this.config.enableFallback&&o!=="jpg"){console.log(`ðŸ”„ å›žé€€åˆ°JPEGæ ¼å¼: ${i}`);try{const l=await this._loadSingleTexture(i,t);return console.log(`âœ… å›žé€€åŠ è½½æˆåŠŸ: ${i}`),l}catch(l){throw console.error(`âŒ å›žé€€ä¹Ÿå¤±è´¥: ${i}`,l),l}}else throw c}}_loadSingleTexture(e,t){return new Promise((a,r)=>{const o=setTimeout(()=>{r(new Error(`çº¹ç†åŠ è½½è¶…æ—¶: ${e}`))},this.config.timeout);this.loader.load(e,s=>{clearTimeout(o),this._applyTextureSettings(s,t),a(s)},void 0,s=>{clearTimeout(o),r(s)})})}_applyTextureSettings(e,t={}){const a={...this.defaultTextureSettings,...t};return Object.keys(a).forEach(r=>{e[r]!==void 0&&(e[r]=a[r])}),e.needsUpdate=!0,e}async loadTextures(e,t={}){const{onProgress:a,onError:r}=t;console.log(`ðŸŽ¯ å¼€å§‹æ‰¹é‡åŠ è½½ ${e.length} ä¸ªçº¹ç†...`);let o=0;const s=[],i=e.map(async(l,d)=>{try{const u=await this.loadTexture(l,t);return s[d]=u,o++,a&&a(o/e.length,o,e.length),u}catch(u){return console.error(`çº¹ç†åŠ è½½å¤±è´¥: ${l}`,u),r&&r(u,l),s[d]=null,o++,a&&a(o/e.length,o,e.length),null}});await Promise.allSettled(i);const c=s.filter(l=>l!==null).length;return console.log(`âœ¨ æ‰¹é‡åŠ è½½å®Œæˆ: ${c}/${e.length} æˆåŠŸ`),s}async preloadTextures(e,t={}){console.log(`âš¡ é¢„åŠ è½½ ${e.length} ä¸ªçº¹ç†...`);const a=e.map(s=>this.loadTexture(s,t).catch(i=>(console.warn(`é¢„åŠ è½½å¤±è´¥: ${s}`,i),null))),o=(await Promise.allSettled(a)).filter(s=>s.status==="fulfilled"&&s.value).length;return console.log(`âš¡ é¢„åŠ è½½å®Œæˆ: ${o}/${e.length} æˆåŠŸ`),o}getCachedTexture(e,t={}){const a=`${e}_${JSON.stringify(t)}`;return this.cache.get(a)}clearCache(){console.log(`ðŸ§¹ æ¸…ç†çº¹ç†ç¼“å­˜ï¼Œå…± ${this.cache.size} ä¸ªçº¹ç†`),this.cache.forEach((e,t)=>{e&&e.dispose&&(e.dispose(),console.log(`ðŸ—‘ï¸ é‡Šæ”¾çº¹ç†èµ„æº: ${t}`))}),this.cache.clear(),this.loadingPromises.clear(),console.log("âœ… çº¹ç†ç¼“å­˜å·²æ¸…ç†")}getCacheStats(){return{total:this.cache.size,loading:this.loadingPromises.size,memory:this._estimateMemoryUsage()}}_estimateMemoryUsage(){let e=0;return this.cache.forEach(t=>{if(t&&t.image){const a=t.image.width||0,r=t.image.height||0;e+=a*r*4}}),{bytes:e,mb:Math.round(e/(1024*1024)*100)/100}}}const I=new P,_=Object.freeze(Object.defineProperty({__proto__:null,TextureLoader:P,textureLoader:I},Symbol.toStringTag,{value:"Module"}));class L{constructor(e={}){this.options=e,this.textureLoader=null,this.preloadQueue=new Map,this.loadingQueue=[],this.memoryThreshold=e.memoryThreshold||256,this.maxConcurrentLoads=e.maxConcurrentLoads||6,this.activeLoads=0,this.stats={totalLoads:0,successfulLoads:0,failedLoads:0,cacheHits:0,totalLoadTime:0},this._setupMemoryMonitoring()}async _ensureTextureLoader(){if(!this.textureLoader){const{TextureLoader:e}=await h(async()=>{const{TextureLoader:t}=await Promise.resolve().then(()=>_);return{TextureLoader:t}},void 0);this.textureLoader=new e(this.options)}return this.textureLoader}async preloadByPriority(e){console.log("ðŸš€ å¼€å§‹æ™ºèƒ½é¢„åŠ è½½...");const t=Object.entries(e).sort(([,a],[,r])=>(r.priority||0)-(a.priority||0));for(const[a,r]of t){console.log(`ðŸ“¦ é¢„åŠ è½½ç»„: ${a} (ä¼˜å…ˆçº§: ${r.priority||0})`);try{await this._preloadGroup(r)}catch(o){console.warn(`é¢„åŠ è½½ç»„å¤±è´¥: ${a}`,o)}await this._checkMemoryUsage()}}async _preloadGroup(e){const{textures:t,lazy:a=!1,timeout:r=5e3}=e;if(a){t.forEach(s=>{this.preloadQueue.set(s,{timestamp:Date.now(),group:e})});return}return(await this._ensureTextureLoader()).preloadTextures(t,{timeout:r})}async loadOnDemand(e,t="normal"){const a=performance.now();this.stats.totalLoads++;try{this.preloadQueue.has(e)&&this.preloadQueue.delete(e);const r=await this._throttledLoad(e,t);return this.stats.successfulLoads++,this.stats.totalLoadTime+=performance.now()-a,r}catch(r){throw this.stats.failedLoads++,r}}async _throttledLoad(e,t){return new Promise((a,r)=>{const o={textureName:e,priority:t,resolve:a,reject:r,timestamp:Date.now()};this.loadingQueue.push(o),this._processQueue()})}async _processQueue(){for(;this.loadingQueue.length>0&&this.activeLoads<this.maxConcurrentLoads;){this.loadingQueue.sort((t,a)=>{const r={high:3,normal:2,low:1};return(r[a.priority]||2)-(r[t.priority]||2)});const e=this.loadingQueue.shift();this.activeLoads++,this._executeLoad(e)}}async _executeLoad(e){const{textureName:t,resolve:a,reject:r}=e;try{const s=await(await this._ensureTextureLoader()).loadTexture(t);a(s)}catch(o){r(o)}finally{this.activeLoads--,this._processQueue()}}async loadCubeTextures(e,t={}){const{onProgress:a,onComplete:r,enableOptimization:o=!0}=t;console.log(`ðŸŽ¯ å¼€å§‹åŠ è½½Cubeçº¹ç†é›†åˆ: ${e.length}ä¸ª`);const{formatDetector:s}=await h(async()=>{const{formatDetector:u}=await Promise.resolve().then(()=>A);return{formatDetector:u}},void 0),i=await s.getCompressionInfo();console.log(`ðŸ“Š ä½¿ç”¨æ ¼å¼: ${i.format} (èŠ‚çœ: ${i.savings}%)`);let c=0;const l=[],d=e.map(async(u,f)=>{try{const g=await this.loadOnDemand(u,"high");return o&&this._optimizeForCube(g),l[f]=g,c++,a&&a(c/e.length,c,e.length),g}catch(g){return console.error(`Cubeçº¹ç†åŠ è½½å¤±è´¥: ${u}`,g),l[f]=this._createFallbackTexture(),c++,a&&a(c/e.length,c,e.length),null}});return await Promise.allSettled(d),r&&r(l.filter(u=>u!==null)),console.log(`âœ¨ Cubeçº¹ç†é›†åˆåŠ è½½å®Œæˆ: ${l.filter(u=>u!==null).length}/${e.length}`),l}_optimizeForCube(e){return e.wrapS=m,e.wrapT=m,e.minFilter=p,e.magFilter=p,e.generateMipmaps=!1,e.flipY=!1,e}_createFallbackTexture(){const e=document.createElement("canvas");e.width=256,e.height=256;const t=e.getContext("2d"),a=t.createLinearGradient(0,0,256,256);a.addColorStop(0,"#1a1a2e"),a.addColorStop(1,"#16213e"),t.fillStyle=a,t.fillRect(0,0,256,256),t.strokeStyle="#ffffff10",t.lineWidth=1;for(let o=0;o<256;o+=32)t.beginPath(),t.moveTo(o,0),t.lineTo(o,256),t.moveTo(0,o),t.lineTo(256,o),t.stroke();const r=new y(e);return this._optimizeForCube(r),r}_setupMemoryMonitoring(){setInterval(()=>{this._checkMemoryUsage()},3e4)}async _checkMemoryUsage(){if(!this.textureLoader)return;const e=this.textureLoader.getCacheStats();e.memory.mb>this.memoryThreshold&&(console.warn(`âš ï¸ çº¹ç†å†…å­˜ä½¿ç”¨è¶…é™: ${e.memory.mb}MB > ${this.memoryThreshold}MB`),await this._performMemoryCleanup())}async _performMemoryCleanup(){console.log("ðŸ§¹ å¼€å§‹çº¹ç†å†…å­˜æ¸…ç†...");const e=Date.now(),t=300*1e3;for(const[a,r]of this.preloadQueue)e-r.timestamp>t&&this.preloadQueue.delete(a);console.log("ðŸ§¹ å†…å­˜æ¸…ç†å®Œæˆ")}getPerformanceStats(){const e=this.textureLoader?this.textureLoader.getCacheStats():{size:0,hits:0,misses:0,memory:{mb:0,formatted:"0 MB"}};return{...this.stats,cache:e,queue:{preload:this.preloadQueue.size,loading:this.loadingQueue.length,activeLoads:this.activeLoads},averageLoadTime:this.stats.totalLoads>0?Math.round(this.stats.totalLoadTime/this.stats.totalLoads):0,successRate:this.stats.totalLoads>0?Math.round(this.stats.successfulLoads/this.stats.totalLoads*100):100}}resetStats(){this.stats={totalLoads:0,successfulLoads:0,failedLoads:0,cacheHits:0,totalLoadTime:0}}dispose(){this.textureLoader&&this.textureLoader.clearCache(),this.preloadQueue.clear(),this.loadingQueue.length=0,this.resetStats()}}const j=new L,T=Object.freeze(Object.defineProperty({__proto__:null,TextureManager:L,textureManager:j},Symbol.toStringTag,{value:"Module"}));class C{constructor(){this.cache=new Map,this.loadingPromises=new Map,this.sceneManagers=new Map,this.performanceStats={totalLoads:0,cacheHits:0,memoryUsage:0,errors:0},this.sceneConfigs={"hero-cube":{optimizer:this.cubeTextureOptimizer.bind(this),basePath:"/cube-textures",formats:["avif","webp","jpg"],fallback:this.createCubeFallback.bind(this)},gallery:{optimizer:this.galleryTextureOptimizer.bind(this),basePath:"/gallery",formats:["avif","webp","jpg"],fallback:this.createGalleryFallback.bind(this)},lightbox:{optimizer:this.lightboxTextureOptimizer.bind(this),basePath:"/gallery",formats:["avif","webp","jpg"],fallback:this.createLightboxFallback.bind(this)}}}async loadSceneTextures(e,t={}){console.log(`ðŸŽ¯ åŠ è½½${e}åœºæ™¯çº¹ç†...`);const a=this.sceneConfigs[e];if(!a)throw new Error(`æœªçŸ¥åœºæ™¯ç±»åž‹: ${e}`);const{formatDetector:r}=await h(async()=>{const{formatDetector:s}=await Promise.resolve().then(()=>A);return{formatDetector:s}},void 0);return await r.initializationPromise,this.sceneManagers.has(e)||this.sceneManagers.set(e,new R(e,a)),await this.sceneManagers.get(e).loadTextures(t)}async getOptimalPath(e,t="cube-textures"){if(e&&e.match(/\.(mp4|webm|mov|avi|mkv)$/i))return`/${t}/${e}`;const{formatDetector:a}=await h(async()=>{const{formatDetector:i}=await Promise.resolve().then(()=>A);return{formatDetector:i}},void 0),r=await a.getBestFormat(),o=e.replace(/\.(jpg|jpeg|png|webp|avif)$/i,""),s={avif:`/${t}-avif/${o}.avif`,webp:`/${t}-webp/${o}.webp`,jpg:`/${t}/${o}.jpg`};return s[r]||s.jpg}cubeTextureOptimizer(e){return e.wrapS=m,e.wrapT=m,e.minFilter=p,e.magFilter=p,e.generateMipmaps=!1,e.flipY=!1,e.colorSpace=w,e}galleryTextureOptimizer(e){return e.wrapS=b,e.wrapT=b,e.minFilter=S,e.magFilter=p,e.generateMipmaps=!0,e.colorSpace=w,e}lightboxTextureOptimizer(e){return e.wrapS=m,e.wrapT=m,e.minFilter=p,e.magFilter=p,e.generateMipmaps=!1,e.colorSpace=w,e}createCubeFallback(){const e=document.createElement("canvas");e.width=e.height=256;const t=e.getContext("2d"),a=32;for(let o=0;o<8;o++)for(let s=0;s<8;s++)t.fillStyle=(o+s)%2===0?"#666":"#999",t.fillRect(o*a,s*a,a,a);const r=new y(e);return this.cubeTextureOptimizer(r)}createGalleryFallback(){const e=document.createElement("canvas");e.width=e.height=512;const t=e.getContext("2d"),a=t.createLinearGradient(0,0,512,512);a.addColorStop(0,"#f0f0f0"),a.addColorStop(1,"#d0d0d0"),t.fillStyle=a,t.fillRect(0,0,512,512),t.fillStyle="#999",t.font="24px Arial",t.textAlign="center",t.fillText("Loading...",256,256);const r=new y(e);return this.galleryTextureOptimizer(r)}createLightboxFallback(){const e=document.createElement("canvas");e.width=e.height=256;const t=e.getContext("2d");t.fillStyle="#222",t.fillRect(0,0,256,256);const a=t.createRadialGradient(128,128,0,128,128,128);a.addColorStop(0,"rgba(255,255,255,0.8)"),a.addColorStop(1,"rgba(255,255,255,0)"),t.fillStyle=a,t.fillRect(0,0,256,256);const r=new y(e);return this.lightboxTextureOptimizer(r)}cleanup(e){if(e){const t=this.sceneManagers.get(e);t&&(t.cleanup(),this.sceneManagers.delete(e))}else this.sceneManagers.forEach(t=>t.cleanup()),this.sceneManagers.clear(),this.cache.clear(),this.loadingPromises.clear()}getStats(){const e={};return this.sceneManagers.forEach((t,a)=>{e[a]=t.getStats()}),{global:this.performanceStats,scenes:e,totalCacheSize:this.cache.size,totalScenes:this.sceneManagers.size}}}class R{constructor(e,t){this.sceneType=e,this.config=t,this.textures=new Map,this.videos=new Map,this.stats={loaded:0,failed:0,cached:0}}async loadTextures(e={}){const{textures:t=[],videos:a=[],images:r=[],folder:o,onProgress:s}=e,i={textures:new Map,videos:new Map,errors:[]},c=[...t,...r];if(c.length>0){const l=await this.loadImageTextures(c,o,s);i.textures=l.textures,i.errors.push(...l.errors)}if(a.length>0){const l=await this.loadVideoTextures(a,s);i.videos=l.videos,i.errors.push(...l.errors)}return console.log(`âœ… ${this.sceneType}åœºæ™¯åŠ è½½å®Œæˆ: 
            - å›¾ç‰‡: ${i.textures.size}
            - è§†é¢‘: ${i.videos.size}
            - é”™è¯¯: ${i.errors.length}`),i}async loadImageTextures(e,t,a){const r=new Map,o=[];let s=0;const i=e.map(async c=>{try{const l=t||this.config.basePath.replace("/",""),{formatDetector:d}=await h(async()=>{const{formatDetector:O}=await Promise.resolve().then(()=>A);return{formatDetector:O}},void 0),u=await d.getBestFormat(),f=c.replace(/\.(jpg|jpeg|png|webp|avif)$/i,""),g={avif:`/${l}-avif/${f}.avif`,webp:`/${l}-webp/${f}.webp`,jpg:`/${l}/${f}.jpg`},E=g[u]||g.jpg,M=await this.loadSingleTexture(E),F=this.config.optimizer(M);r.set(c,F),this.stats.loaded++,s++,a&&a(s/e.length,s,e.length)}catch(l){console.warn(`çº¹ç†åŠ è½½å¤±è´¥: ${c}`,l);const d=this.config.fallback();r.set(c,d),o.push({name:c,error:l.message}),this.stats.failed++,s++,a&&a(s/e.length,s,e.length)}});return await Promise.allSettled(i),{textures:r,errors:o}}async loadVideoTextures(e,t){const a=new Map,r=[];let o=0;const s=e.map(async i=>{try{const{name:c,src:l}=i,d=await this.createVideoTexture(l);a.set(c,d),this.stats.loaded++,o++,t&&t(o/e.length,o,e.length)}catch(c){console.warn(`è§†é¢‘çº¹ç†åŠ è½½å¤±è´¥: ${i.name}`,c),r.push({name:i.name,error:c.message}),this.stats.failed++,o++,t&&t(o/e.length,o,e.length)}});return await Promise.allSettled(s),{videos:a,errors:r}}async loadSingleTexture(e){return new Promise((t,a)=>{new v().load(e,t,void 0,a)})}async createVideoTexture(e){return new Promise((t,a)=>{const r=document.createElement("video");r.src=e,r.crossOrigin="anonymous",r.loop=!0,r.muted=!0,r.autoplay=!0,r.playsInline=!0,r.preload="metadata";const o=()=>{const s=new D(r);s.minFilter=p,s.magFilter=p,s.format=z,s.generateMipmaps=!1,s.flipY=!0,s.colorSpace=w,s.isVideoTexture=!0,r.play().then(()=>{console.log(`ðŸŽ¬ è§†é¢‘å¼€å§‹æ’­æ”¾: ${e}`)}).catch(i=>{console.warn(`âš ï¸ è§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’: ${e}`,i)}),t(s)};r.addEventListener("loadeddata",o),r.addEventListener("error",a),r.load()})}cleanup(){this.textures.forEach(e=>e.dispose()),this.videos.forEach(e=>e.dispose()),this.textures.clear(),this.videos.clear()}getStats(){return{...this.stats,textureCount:this.textures.size,videoCount:this.videos.size}}}const V=new C,x=Object.freeze(Object.defineProperty({__proto__:null,TextureSystem:C,textureSystem:V},Symbol.toStringTag,{value:"Module"}));export{A as F,G as t};
