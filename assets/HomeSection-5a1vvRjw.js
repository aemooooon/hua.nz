import{r as u,j as f,F as $e,b as je}from"./react-CgIfOqKe.js";import{l as xe,P as F}from"./vendor-rLp43SRl.js";import{u as Ce,a as Te,w as X}from"./index-C3Z5zBf4.js";import{T as Be,r as se,s as N,L as H,t as Se,k as ie,S as Fe,b as Ie,W as Qe,N as we,f as We,D as oe,g as ye,u as _e,v as ae,w as be,q as Ue,M as Ge,x as Oe,y as De,z as He,G as Ye,H as Ve}from"./three-BY4XbaxT.js";import{g as Xe}from"./gsap-CH_iu5NA.js";import{C as qe}from"./CircularLoadingIndicator-C-ojp_cu.js";import{c as ve,T as Ne,a as Ze}from"./ThemeComponents-X5TrOFKp.js";import"./leaflet-BD0kuunB.js";class Je{constructor(){this.supportCache=new Map,this.initializationPromise=this.initializeSupport()}async initializeSupport(){const[e,o]=await Promise.all([this.detectAVIFSupport(),this.detectWebPSupport()]);return this.supportCache.set("avif",e),this.supportCache.set("webp",o),console.log("🖼️ 图像格式支持检测完成:",{avif:e,webp:o}),this.supportCache}async detectAVIFSupport(){try{const e="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgABogQEAwgMg8f8D///8WfhwB8+ErK42A=";return new Promise(o=>{const t=new Image;t.onload=()=>o(!0),t.onerror=()=>o(!1),t.src=e})}catch(e){return console.warn("AVIF检测异常:",e),!1}}async detectWebPSupport(){try{const e="data:image/webp;base64,UklGRjoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==";return new Promise(o=>{const t=new Image;t.onload=()=>o(!0),t.onerror=()=>o(!1),t.src=e})}catch(e){return console.warn("WebP检测异常:",e),!1}}async isFormatSupported(e){return await this.initializationPromise,this.supportCache.get(e.toLowerCase())||!1}async getAllSupport(){return await this.initializationPromise,Object.fromEntries(this.supportCache)}async getBestFormat(){return await this.initializationPromise,this.supportCache.get("avif")?"avif":this.supportCache.get("webp")?"webp":"jpg"}async getCompressionInfo(){const e=await this.getBestFormat(),t={jpg:{ratio:1,description:"原始JPEG格式",quality:"baseline",compression:"无额外压缩"},webp:{ratio:.65,description:"WebP格式，平均减少35%文件大小",quality:"good",compression:"高效有损/无损压缩"},avif:{ratio:.45,description:"AVIF格式，平均减少55%文件大小",quality:"excellent",compression:"最新AV1编码，最佳压缩比"}}[e];return{format:e.toUpperCase(),...t,savings:Math.round((1-t.ratio)*100)}}}const V=new Je;class Re{constructor(e={}){this.loader=new Be,this.cache=new Map,this.loadingPromises=new Map,this.config={enableCache:!0,enableFallback:!0,maxRetries:2,timeout:1e4,compression:{maxSize:1024,quality:.9},...e},this.defaultTextureSettings={generateMipmaps:!0,minFilter:Se,magFilter:H,wrapS:N,wrapT:N,colorSpace:se}}async getOptimalPath(e,o="cube-textures"){const t=await V.getBestFormat(),a={avif:`cube-textures-avif/${e}.avif`,webp:`cube-textures-webp/${e}.webp`,jpg:`${o}/${e}.jpg`};return{primary:a[t],fallback:a.jpg,format:t}}async loadTexture(e,o={}){const t=`${e}_${JSON.stringify(o)}`;if(this.config.enableCache&&this.cache.has(t))return console.log(`📦 从缓存加载纹理: ${e}`),this.cache.get(t);if(this.loadingPromises.has(t))return this.loadingPromises.get(t);const a=this._loadTextureWithFallback(e,o);this.loadingPromises.set(t,a);try{const n=await a;return this.config.enableCache&&this.cache.set(t,n),n}finally{this.loadingPromises.delete(t)}}async _loadTextureWithFallback(e,o){const{primary:t,fallback:a,format:n}=await this.getOptimalPath(e),d=`/${t}`,h=`/${a}`;console.log(`🔄 加载纹理: ${e} (${n.toUpperCase()})`);try{const x=await this._loadSingleTexture(d,o);return console.log(`✅ 纹理加载成功: ${d}`),x}catch(x){if(console.warn(`⚠️ 主格式加载失败: ${d}`,x),this.config.enableFallback&&n!=="jpg"){console.log(`🔄 回退到JPEG格式: ${h}`);try{const g=await this._loadSingleTexture(h,o);return console.log(`✅ 回退加载成功: ${h}`),g}catch(g){throw console.error(`❌ 回退也失败: ${h}`,g),g}}else throw x}}_loadSingleTexture(e,o){return new Promise((t,a)=>{const n=setTimeout(()=>{a(new Error(`纹理加载超时: ${e}`))},this.config.timeout);this.loader.load(e,d=>{clearTimeout(n),this._applyTextureSettings(d,o),t(d)},void 0,d=>{clearTimeout(n),a(d)})})}_applyTextureSettings(e,o={}){const t={...this.defaultTextureSettings,...o};return Object.keys(t).forEach(a=>{e[a]!==void 0&&(e[a]=t[a])}),e.needsUpdate=!0,e}async loadTextures(e,o={}){const{onProgress:t,onError:a}=o;console.log(`🎯 开始批量加载 ${e.length} 个纹理...`);let n=0;const d=[],h=e.map(async(g,m)=>{try{const b=await this.loadTexture(g,o);return d[m]=b,n++,t&&t(n/e.length,n,e.length),b}catch(b){return console.error(`纹理加载失败: ${g}`,b),a&&a(b,g),d[m]=null,n++,t&&t(n/e.length,n,e.length),null}});await Promise.allSettled(h);const x=d.filter(g=>g!==null).length;return console.log(`✨ 批量加载完成: ${x}/${e.length} 成功`),d}async preloadTextures(e,o={}){console.log(`⚡ 预加载 ${e.length} 个纹理...`);const t=e.map(d=>this.loadTexture(d,o).catch(h=>(console.warn(`预加载失败: ${d}`,h),null))),n=(await Promise.allSettled(t)).filter(d=>d.status==="fulfilled"&&d.value).length;return console.log(`⚡ 预加载完成: ${n}/${e.length} 成功`),n}getCachedTexture(e,o={}){const t=`${e}_${JSON.stringify(o)}`;return this.cache.get(t)}clearCache(){this.cache.forEach(e=>{e&&e.dispose&&e.dispose()}),this.cache.clear(),console.log("🧹 纹理缓存已清理")}getCacheStats(){return{total:this.cache.size,loading:this.loadingPromises.size,memory:this._estimateMemoryUsage()}}_estimateMemoryUsage(){let e=0;return this.cache.forEach(o=>{if(o&&o.image){const t=o.image.width||0,a=o.image.height||0;e+=t*a*4}}),{bytes:e,mb:Math.round(e/(1024*1024)*100)/100}}}const q=new Re;class Ke{constructor(e={}){this.textureLoader=new Re(e),this.preloadQueue=new Map,this.loadingQueue=[],this.memoryThreshold=e.memoryThreshold||256,this.maxConcurrentLoads=e.maxConcurrentLoads||6,this.activeLoads=0,this.stats={totalLoads:0,successfulLoads:0,failedLoads:0,cacheHits:0,totalLoadTime:0},this._setupMemoryMonitoring()}async preloadByPriority(e){console.log("🚀 开始智能预加载...");const o=Object.entries(e).sort(([,t],[,a])=>(a.priority||0)-(t.priority||0));for(const[t,a]of o){console.log(`📦 预加载组: ${t} (优先级: ${a.priority||0})`);try{await this._preloadGroup(a)}catch(n){console.warn(`预加载组失败: ${t}`,n)}await this._checkMemoryUsage()}}async _preloadGroup(e){const{textures:o,lazy:t=!1,timeout:a=5e3}=e;if(t){o.forEach(n=>{this.preloadQueue.set(n,{timestamp:Date.now(),group:e})});return}return this.textureLoader.preloadTextures(o,{timeout:a})}async loadOnDemand(e,o="normal"){const t=performance.now();this.stats.totalLoads++;try{this.preloadQueue.has(e)&&this.preloadQueue.delete(e);const a=await this._throttledLoad(e,o);return this.stats.successfulLoads++,this.stats.totalLoadTime+=performance.now()-t,a}catch(a){throw this.stats.failedLoads++,a}}async _throttledLoad(e,o){return new Promise((t,a)=>{const n={textureName:e,priority:o,resolve:t,reject:a,timestamp:Date.now()};this.loadingQueue.push(n),this._processQueue()})}async _processQueue(){for(;this.loadingQueue.length>0&&this.activeLoads<this.maxConcurrentLoads;){this.loadingQueue.sort((o,t)=>{const a={high:3,normal:2,low:1};return(a[t.priority]||2)-(a[o.priority]||2)});const e=this.loadingQueue.shift();this.activeLoads++,this._executeLoad(e)}}async _executeLoad(e){const{textureName:o,resolve:t,reject:a}=e;try{const n=await this.textureLoader.loadTexture(o);t(n)}catch(n){a(n)}finally{this.activeLoads--,this._processQueue()}}async loadCubeTextures(e,o={}){const{onProgress:t,onComplete:a,enableOptimization:n=!0}=o;console.log(`🎯 开始加载Cube纹理集合: ${e.length}个`);const d=await V.getCompressionInfo();console.log(`📊 使用格式: ${d.format} (节省: ${d.savings}%)`);let h=0;const x=[],g=e.map(async(m,b)=>{try{const S=await this.loadOnDemand(m,"high");return n&&this._optimizeForCube(S),x[b]=S,h++,t&&t(h/e.length,h,e.length),S}catch(S){return console.error(`Cube纹理加载失败: ${m}`,S),x[b]=this._createFallbackTexture(),h++,t&&t(h/e.length,h,e.length),null}});return await Promise.allSettled(g),a&&a(x.filter(m=>m!==null)),console.log(`✨ Cube纹理集合加载完成: ${x.filter(m=>m!==null).length}/${e.length}`),x}_optimizeForCube(e){return e.wrapS=N,e.wrapT=N,e.minFilter=H,e.magFilter=H,e.generateMipmaps=!1,e.flipY=!1,e}_createFallbackTexture(){const e=document.createElement("canvas");e.width=256,e.height=256;const o=e.getContext("2d"),t=o.createLinearGradient(0,0,256,256);t.addColorStop(0,"#1a1a2e"),t.addColorStop(1,"#16213e"),o.fillStyle=t,o.fillRect(0,0,256,256),o.strokeStyle="#ffffff10",o.lineWidth=1;for(let n=0;n<256;n+=32)o.beginPath(),o.moveTo(n,0),o.lineTo(n,256),o.moveTo(0,n),o.lineTo(256,n),o.stroke();const a=new ie(e);return this._optimizeForCube(a),a}_setupMemoryMonitoring(){setInterval(()=>{this._checkMemoryUsage()},3e4)}async _checkMemoryUsage(){const e=this.textureLoader.getCacheStats();e.memory.mb>this.memoryThreshold&&(console.warn(`⚠️ 纹理内存使用超限: ${e.memory.mb}MB > ${this.memoryThreshold}MB`),await this._performMemoryCleanup())}async _performMemoryCleanup(){console.log("🧹 开始纹理内存清理...");const e=Date.now(),o=300*1e3;for(const[t,a]of this.preloadQueue)e-a.timestamp>o&&this.preloadQueue.delete(t);console.log("🧹 内存清理完成")}getPerformanceStats(){const e=this.textureLoader.getCacheStats();return{...this.stats,cache:e,queue:{preload:this.preloadQueue.size,loading:this.loadingQueue.length,activeLoads:this.activeLoads},averageLoadTime:this.stats.totalLoads>0?Math.round(this.stats.totalLoadTime/this.stats.totalLoads):0,successRate:this.stats.totalLoads>0?Math.round(this.stats.successfulLoads/this.stats.totalLoads*100):100}}resetStats(){this.stats={totalLoads:0,successfulLoads:0,failedLoads:0,cacheHits:0,totalLoadTime:0}}dispose(){this.textureLoader.clearCache(),this.preloadQueue.clear(),this.loadingQueue.length=0,this.resetStats()}}const re=new Ke,ne={formatDetector:V,textureLoader:q,textureManager:re,async getBestFormat(){return V.getBestFormat()},async getCompressionInfo(){return V.getCompressionInfo()},async loadTexture(T,e){return q.loadTexture(T,e)},async loadCubeTextures(T,e){return re.loadCubeTextures(T,e)},async preloadTextures(T,e){return q.preloadTextures(T,e)},getStats(){return re.getPerformanceStats()},clearCache(){q.clearCache()}},Me=({enableOpeningAnimation:T=!1,onAnimationComplete:e,onReady:o})=>{const t=u.useRef(),a=u.useRef(),n=u.useRef(),d=u.useRef({x:0,y:0}),h=u.useRef({x:0,y:0}),x=u.useRef({x:0,y:0}),g=u.useRef({x:0,y:0,z:0}),m=u.useRef({x:0,y:0,z:0}),b=u.useRef(performance.now()),S=u.useRef(!1),{getContent:G}=Ce(),$=G(),{getThemeColors:Y}=Te(),_=Y(),I=u.useCallback(()=>Math.max(window.innerWidth,window.innerHeight),[]),[v,z]=u.useState(!1),R=u.useMemo(()=>{var j,C,l,i,E,W;return[{name:"home",label:((j=$.navigation)==null?void 0:j.home)||"Home",color:"#afcc8f",effect:"effectchaos",video:"/cube-textures/home.mp4"},{name:"about",label:((C=$.navigation)==null?void 0:C.about)||"About",color:"#7ca65c",effect:"effectlorenz",texture:"about"},{name:"projects",label:((l=$.navigation)==null?void 0:l.projects)||"Projects",color:"#5d7d4b",effect:"effectmonjori",texture:"projects"},{name:"gallery",label:((i=$.navigation)==null?void 0:i.gallery)||"Gallery",color:"#768e90",effect:"effectheartbeats",texture:"gallery"},{name:"education",label:((E=$.navigation)==null?void 0:E.education)||"Education",color:"#4a636a",effect:"effectfuse",texture:"education"},{name:"contact",label:((W=$.navigation)==null?void 0:W.contact)||"Contact",color:"#3a4e55",effect:"effectpixeldistortion",texture:"contact"}]},[$.navigation]);u.useEffect(()=>{(async()=>{try{const C=await ne.getCompressionInfo();console.log(`🎯 智能纹理系统: ${C.format} (${C.description})`);const l=R.filter(i=>i.texture).map(i=>i.texture);l.length>0&&await ne.preloadTextures(l,{onProgress:(i,E,W)=>{console.log(`📦 纹理预加载进度: ${E}/${W} (${Math.round(i*100)}%)`)}}),z(!0)}catch(C){console.warn("纹理预加载部分失败，继续渲染:",C),z(!0)}})()},[R]),u.useEffect(()=>{const j=()=>{var E;if((E=t.current)!=null&&E.firstChild){const W=t.current.firstChild;W.style.width="100vw",W.style.height="100vh"}},C=()=>{X.isPageVisible&&X.refreshActiveResources()},l=["mousedown","mousemove","keydown","scroll","touchstart"];window.addEventListener("resize",j);const i=xe.debounce(C,3e4);return l.forEach(E=>{document.addEventListener(E,i)}),()=>{window.removeEventListener("resize",j),l.forEach(E=>{document.removeEventListener(E,i)})}},[I]);const y=u.useRef(_),Q=u.useRef(e),O=u.useRef(o);return u.useEffect(()=>{y.current=_},[_]),u.useEffect(()=>{Q.current=e},[e]),u.useEffect(()=>{O.current=o},[o]),u.useEffect(()=>{if(!v)return;const j=t.current;if(!j)return;const C=new Fe,l=new Ie(50,1,.1,1e3);l.position.z=10;const i=new Qe({alpha:!0,antialias:!0,powerPreference:"high-performance",precision:"mediump",stencil:!1,depth:!0,premultipliedAlpha:!1});i.setClearColor(0,0),i.setSize(window.innerWidth,window.innerHeight),i.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),i.shadowMap.enabled=!1,i.physicallyCorrectLights=!1,i.toneMapping=we,i.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),i.domElement.style.position="fixed",i.domElement.style.top="0",i.domElement.style.left="0",i.domElement.style.width="100vw",i.domElement.style.height="100vh",i.domElement.style.display="block",i.domElement.style.zIndex="10",i.domElement.style.pointerEvents="none",i.domElement.setAttribute("data-no-custom-cursor","true"),i.domElement.setAttribute("data-hero-cube-canvas","true"),i.domElement.classList.add("hero-cube-canvas"),i.setSize(window.innerWidth,window.innerHeight),l.aspect=window.innerWidth/window.innerHeight,l.updateProjectionMatrix(),i.shadowMap.enabled=!1,i.physicallyCorrectLights=!1,i.toneMapping=we,i.toneMappingExposure=1,i.outputColorSpace=se,j.appendChild(i.domElement);const E=xe.debounce(()=>{if(i&&l){const s=window.innerWidth,A=window.innerHeight;i.setSize(s,A),l.aspect=s/A,l.updateProjectionMatrix()}},100);window.addEventListener("resize",E);const W=new We(16777215,.8);C.add(W);const Z=new oe(16777215,1.2);Z.position.set(5,5,5),Z.castShadow=!0,C.add(Z);const ce=new oe(1096065,.6);ce.position.set(-5,2,-3),C.add(ce);const ue=new oe(3462041,.5);ue.position.set(3,-4,5),C.add(ue);const de=new ye(14742240,1.5,15);de.position.set(0,0,8),C.add(de);const he=new ye(65416,.8,20);he.position.set(0,0,-10),C.add(he);const J=2.8,K=new _e(J,J,J,8,.1),me=(s=256)=>{const A=document.createElement("canvas");A.width=s,A.height=s;const c=A.getContext("2d"),p=s/8;for(let L=0;L<8;L++)for(let M=0;M<8;M++)c.fillStyle=(L+M)%2===0?y.current.surface:y.current.muted,c.fillRect(L*p,M*p,p,p);c.fillStyle=y.current.primary,c.font=`bold ${s/16}px Arial`,c.textAlign="center",c.textBaseline="middle",c.fillText("VIDEO",s/2,s/2-s/32),c.fillText("ERROR",s/2,s/2+s/32);const P=new ie(A);return P.needsUpdate=!0,P},ee=[R.find(s=>s.name==="about"),R.find(s=>s.name==="gallery"),R.find(s=>s.name==="contact"),R.find(s=>s.name==="education"),R.find(s=>s.name==="home"),R.find(s=>s.name==="projects")].map(s=>{if(s.video){const D=me(256),k=new ae({map:D,transparent:!0,opacity:.9,side:be}),w=document.createElement("video");w.src=s.video,w.crossOrigin="anonymous",w.loop=!0,w.muted=!0,w.autoplay=!0,w.playsInline=!0,w.preload="metadata";const Ae=()=>{try{const B=new Ye(w);B.minFilter=H,B.magFilter=H,B.format=Ve,B.generateMipmaps=!1,B.flipY=!1,B.colorSpace=se,k.map&&k.map!==D&&k.map.dispose(),k.map=B,k.needsUpdate=!0,w.play().catch(ke=>{console.warn("Video autoplay failed:",ke)})}catch(B){console.warn("Failed to create video texture:",B)}};return w.addEventListener("loadeddata",()=>{Ae()}),w.addEventListener("canplay",()=>{Ae()}),w.addEventListener("loadedmetadata",()=>{w.play().catch(()=>{})}),w.addEventListener("error",B=>{console.warn("Video loading error, using fallback texture:",B)}),w.load(),k}if(s.texture){const D=me(256),k=new ae({map:D,transparent:!0,opacity:.9,side:be});return(async()=>{try{const w=await ne.loadTexture(s.texture);k.map=w,k.needsUpdate=!0}catch(w){console.warn(`加载纹理失败: ${s.texture}`,w)}})(),k}const A=document.createElement("canvas"),c=256;A.width=c,A.height=c;const p=A.getContext("2d");p.clearRect(0,0,c,c);const P=p.createRadialGradient(c/2,c/2,0,c/2,c/2,c/2);P.addColorStop(0,`${s.color}25`),P.addColorStop(.6,`${s.color}15`),P.addColorStop(1,`${s.color}08`),p.fillStyle=P,p.fillRect(0,0,c,c),p.strokeStyle=`${s.color}60`,p.lineWidth=2;const L=c*.05;p.strokeRect(L,L,c-L*2,c-L*2);const M=p.createLinearGradient(0,0,c,c);M.addColorStop(0,"rgba(255, 255, 255, 0.15)"),M.addColorStop(.5,"rgba(255, 255, 255, 0.08)"),M.addColorStop(1,"rgba(255, 255, 255, 0)"),p.fillStyle=M,p.fillRect(0,0,c/3,c),p.shadowColor="rgba(0, 0, 0, 0.8)",p.shadowBlur=6;const te=36;p.font=`bold ${te}px "Helvetica Neue", Arial`,p.fillStyle=y.current.text||"#ffffff",p.textAlign="center",p.textBaseline="middle",p.fillText(s.label,c/2,c/2),p.shadowColor="transparent",p.shadowBlur=0,p.shadowOffsetX=0,p.shadowOffsetY=0;const U=new ie(A);return U.needsUpdate=!0,U.generateMipmaps=!0,U.minFilter=Se,U.magFilter=H,new ae({map:U,transparent:!0,opacity:.9,side:Ue})}),r=new Ge(K,ee);C.add(r),a.current=r;const Ee=new Oe(K),Le=new De({color:16777215,opacity:.3,transparent:!0,linewidth:2}),ze=new He(Ee,Le);r.add(ze),T?(r.position.set(0,0,-80),r.scale.set(.05,.05,.05),r.rotation.set(0,0,0),n.current=Xe.timeline({onComplete:()=>{Q.current&&Q.current(),window.dispatchEvent(new CustomEvent("cubeAnimationComplete"))}}).to(r.position,{z:0,duration:2,ease:"power3.out",delay:.5}).to(r.scale,{x:1.5,y:1.5,z:1.5,duration:2,ease:"back.out(1.7)"},.5).to(r.rotation,{x:0,y:0,z:0,duration:1.5,ease:"power2.inOut"},2.5).to(l.position,{x:0,y:0,z:4,duration:.8,ease:"power2.out",onUpdate:()=>l.lookAt(r.position)},3.2).to(r.rotation,{x:0,y:-Math.PI*.5,z:0,duration:1.5,ease:"power2.inOut"},4.5).to(l.position,{x:4,y:0,z:0,duration:.8,ease:"power2.out",onUpdate:()=>l.lookAt(r.position)},5.3).to(r.rotation,{x:0,y:-Math.PI,z:0,duration:1.5,ease:"power2.inOut"},6.5).to(l.position,{x:0,y:0,z:-4,duration:.8,ease:"power2.out",onUpdate:()=>l.lookAt(r.position)},7.3).to(r.rotation,{x:0,y:Math.PI*.5,z:0,duration:1.5,ease:"power2.inOut"},8.5).to(l.position,{x:-4,y:0,z:0,duration:.8,ease:"power2.out",onUpdate:()=>l.lookAt(r.position)},9.3).to(r.rotation,{x:Math.PI*.5,y:Math.PI*.5,z:0,duration:1.5,ease:"power2.inOut"},10.5).to(l.position,{x:0,y:-4,z:0,duration:.8,ease:"power2.out",onUpdate:()=>l.lookAt(r.position)},11.3).to(r.rotation,{x:-Math.PI*.5,y:Math.PI*.5,z:0,duration:1.5,ease:"power2.inOut"},12.5).to(l.position,{x:0,y:4,z:0,duration:.8,ease:"power2.out",onUpdate:()=>l.lookAt(r.position)},13.3).to(l.position,{x:0,y:2,z:6,duration:.7,ease:"power2.inOut",onUpdate:()=>l.lookAt(r.position)},13.3).to(l.position,{x:0,y:0,z:10,duration:.8,ease:"power2.out",onUpdate:()=>l.lookAt(r.position)},14).to(r.scale,{x:3,y:3,z:3,duration:1.7,ease:"power3.in"},14.8).to(l.position,{z:2,duration:1.7,ease:"power3.in",onUpdate:()=>l.lookAt(r.position)},14.8).to(r.rotation,{x:r.rotation.x+Math.PI*4,y:r.rotation.y+Math.PI*6,z:r.rotation.z+Math.PI*3,duration:1.7,ease:"power2.out"},14.8).to(r.scale,{x:1.2,y:1.2,z:1.2,duration:2.5,ease:"power3.out"},16.5).to(l.position,{z:10,duration:2.5,ease:"power2.out",onUpdate:()=>l.lookAt(r.position)},16.5).to(r.rotation,{x:r.rotation.x+Math.PI*1.5,y:r.rotation.y+Math.PI*1.8,z:r.rotation.z+Math.PI*1.2,duration:2.5,ease:"sine.inOut"},16.5).to(r.scale,{x:1.05,y:1.05,z:1.05,duration:2,ease:"power2.out"},19).to(r.rotation,{x:-Math.PI*.81,y:Math.PI*.25,z:0,duration:2,ease:"power1.inOut"},19).to(r.scale,{x:1,y:1,z:1,duration:.4,ease:"power2.out"},21).to(r.scale,{x:1.08,y:1.08,z:1.08,duration:.15,ease:"power2.out"},21.4).to(r.scale,{x:1,y:1,z:1,duration:.2,ease:"bounce.out"},21.55).to(r.scale,{x:1.06,y:1.06,z:1.06,duration:.12,ease:"power2.out"},21.8).to(r.scale,{x:1,y:1,z:1,duration:.18,ease:"bounce.out"},21.92).to(r.scale,{x:1.04,y:1.04,z:1.04,duration:.1,ease:"power2.out"},22.15).to(r.scale,{x:1,y:1,z:1,duration:.25,ease:"elastic.out(1.2, 0.4)"},22.25)):r.rotation.set(-Math.PI*.81,Math.PI*.25,0);const pe=s=>{const A=s.clientX/window.innerWidth*2-1,c=-(s.clientY/window.innerHeight)*2+1,p=performance.now(),P=Math.max(p-b.current,1),L=A-x.current.x,M=c-x.current.y;h.current.x=L/(P*.001),h.current.y=M/(P*.001),d.current.x=A,d.current.y=c,x.current={x:A,y:c},b.current=p};window.addEventListener("mousemove",pe);const fe=()=>{requestAnimationFrame(fe);const s=performance.now(),A=Math.min((s-b.current)*.001,.02);if(b.current=s,!S.current){const c=d.current.x*.1+Math.PI*.25,P=d.current.y*.05-Math.PI*.81+m.current.x,L=c+m.current.y,M=m.current.z;r.rotation.x+=(P-r.rotation.x)*.02,r.rotation.y+=(L-r.rotation.y)*.02,r.rotation.z+=(M-r.rotation.z)*.02,r.rotation.y+=.001}if(A>0){const M=h.current.y*2.5,te=-h.current.x*2.5,U=(h.current.x+h.current.y)*2.5*.4,ge=-m.current.x*12,D=-m.current.y*12,k=-m.current.z*12;g.current.x+=(M+ge)*A,g.current.y+=(te+D)*A,g.current.z+=(U+k)*A,g.current.x*=.88,g.current.y*=.88,g.current.z*=.88,m.current.x+=g.current.x*A,m.current.y+=g.current.y*A,m.current.z+=g.current.z*A,m.current.x=Math.max(-1.2,Math.min(1.2,m.current.x)),m.current.y=Math.max(-1.2,Math.min(1.2,m.current.y)),m.current.z=Math.max(-1.2,Math.min(1.2,m.current.z));const w=Math.sin(s*.001)*.05;r.position.set(0,w,0),h.current.x*=.92,h.current.y*=.92}i.render(C,l)};O.current&&setTimeout(()=>{O.current()},100);const Pe=X.registerResources("HeroCube",{renderer:i,scene:C,geometry:K,materials:ee,textures:ee.map(s=>s.map).filter(Boolean)},{persistent:!0});return fe(),()=>{n.current&&n.current.kill(),j&&i.domElement&&j.removeChild(i.domElement),window.removeEventListener("mousemove",pe),window.removeEventListener("resize",E),X.cleanup(Pe)}},[R,v,T]),f.jsx("div",{className:"relative",children:f.jsx("div",{ref:t,className:"fixed inset-0 w-full h-full overflow-hidden",style:{pointerEvents:"none",zIndex:5,filter:"drop-shadow(0 0 20px rgba(16, 185, 129, 0.3)) drop-shadow(0 0 40px rgba(0, 255, 136, 0.2))"}})})};Me.propTypes={enableOpeningAnimation:F.bool,onAnimationComplete:F.func,onReady:F.func};const le=({children:T,content:e,placement:o="top",className:t,delay:a=300,...n})=>{const[d,h]=u.useState(!1),[x,g]=u.useState(o),m=u.useRef(null),b=u.useRef(null),S=u.useRef(null),G=()=>{S.current&&clearTimeout(S.current),S.current=setTimeout(()=>{h(!0)},a)},$=()=>{S.current&&clearTimeout(S.current),h(!1)};u.useEffect(()=>{if(d){const I=()=>{if(!m.current||!b.current)return;const v=m.current.getBoundingClientRect(),z=b.current.getBoundingClientRect(),R={width:window.innerWidth,height:window.innerHeight};let y=o;const Q={top:v.top-z.height-8,bottom:v.bottom+8,left:v.left-z.width-8,right:v.right+8};switch(o){case"top":Q.top<0&&(y="bottom");break;case"bottom":Q.bottom+z.height>R.height&&(y="top");break;case"left":Q.left<0&&(y="right");break;case"right":Q.right+z.width>R.width&&(y="left");break}if(y==="left"||y==="right"){const O=v.top+v.height/2;(O-z.height/2<0||O+z.height/2>R.height)&&(y=Q.top>=0?"top":"bottom")}g(y)};requestAnimationFrame(()=>{I()})}},[d,e,o]),u.useEffect(()=>()=>{S.current&&clearTimeout(S.current)},[]);const Y=()=>{const I="absolute z-[9999] px-3 py-2 text-xs font-medium transition-all duration-200 transform",v="bg-black/90 text-theme-primary border border-theme-primary/30 rounded-lg backdrop-blur-sm",z="shadow-lg shadow-theme-primary/20",R=d?"opacity-100 scale-100 pointer-events-auto":"opacity-0 scale-95 pointer-events-none";let y="";switch(x){case"top":y="bottom-full left-1/2 -translate-x-1/2 mb-2";break;case"bottom":y="top-full left-1/2 -translate-x-1/2 mt-2";break;case"left":y="right-full top-1/2 -translate-y-1/2 mr-2";break;case"right":y="left-full top-1/2 -translate-y-1/2 ml-2";break}return ve(I,v,z,R,y,t)},_=()=>{const I="absolute w-2 h-2 bg-black/90 border border-theme-primary/30 transform rotate-45";let v="";switch(x){case"top":v="top-full left-1/2 -translate-x-1/2 -mt-1 border-t-0 border-l-0";break;case"bottom":v="bottom-full left-1/2 -translate-x-1/2 -mb-1 border-b-0 border-r-0";break;case"left":v="left-full top-1/2 -translate-y-1/2 -ml-1 border-l-0 border-b-0";break;case"right":v="right-full top-1/2 -translate-y-1/2 -mr-1 border-r-0 border-t-0";break}return ve(I,v)};return f.jsxs("div",{className:"relative inline-block",ref:m,onMouseEnter:G,onMouseLeave:$,...n,children:[T,f.jsxs("div",{ref:b,className:Y(),style:{maxWidth:"200px",whiteSpace:"nowrap",zIndex:9999},children:[e,f.jsx("div",{className:_()})]})]})};le.propTypes={children:F.node.isRequired,content:F.node.isRequired,placement:F.oneOf(["top","bottom","left","right"]),className:F.string,delay:F.number};const et=({language:T,enableOpeningAnimation:e=!1})=>{const{getContent:o,toggleLanguage:t}=Ce(),a=o(),{toggleTheme:n,getCurrentTheme:d}=Te(),h=d(),[x,g]=u.useState(!1),[m,b]=u.useState(!1),[S,G]=u.useState(!1),[$,Y]=u.useState(!1);u.useEffect(()=>{const I=setTimeout(()=>{G(!0)},400),v=setTimeout(()=>{b(!0)},600),z=setTimeout(()=>{g(!0)},2e3);return()=>{clearTimeout(I),clearTimeout(v),clearTimeout(z)}},[]);const _=u.useCallback(()=>{Y(!0),G(!1)},[]);return f.jsxs("div",{className:"w-screen overflow-hidden",style:{margin:0,padding:0,background:"transparent",height:"100vh",minHeight:"100dvh"},children:[f.jsx("div",{className:`absolute top-8 left-1/2 transform -translate-x-1/2 text-center text-white z-50 w-full px-4 ${e?"grand-title-entrance":""}`,style:e?{}:{animation:"movieTitleEntrance 4s ease-out forwards 1s",animationFillMode:"both"},children:f.jsxs("div",{className:"flex flex-col items-center justify-center w-full relative",children:[f.jsx(Ne,{level:1,className:`text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold font-beauRivage hover:text-theme-primary transition-colors duration-300 mb-2 sm:mb-4 leading-tight text-center w-full mt-12 ${e?"shimmer-text":""}`,children:a.home.name}),f.jsx(Ze,{className:`text-lg sm:text-xl md:text-2xl lg:text-3xl font-mono text-theme-accent mt-48 ${e?"grand-subtitle-entrance":""}`,style:{position:"absolute",left:"50%",transform:"translateX(-50%)",width:"max-content",whiteSpace:"nowrap"},children:a.home.title})]})}),f.jsx("div",{className:`absolute left-1/2 transform -translate-x-1/2 text-center z-50 w-full px-4 ${e?"grand-slogan-entrance":""}`,style:{bottom:"max(4rem, env(safe-area-inset-bottom) + 3rem)",...e?{}:{animation:"sloganEntrance 3s ease-out forwards 5s",animationFillMode:"both"}},children:f.jsx("div",{className:"text-center",children:f.jsx("p",{className:"text-base sm:text-lg md:text-xl lg:text-2xl font-light text-theme-primary tracking-wider leading-relaxed transition-colors duration-300",children:a.home.slogan})})}),S&&!$&&f.jsx(qe,{size:160,strokeWidth:12,showMask:!0}),m&&f.jsx(Me,{enableOpeningAnimation:e,onReady:_}),x&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"absolute z-50 transition-opacity duration-1000 opacity-100",style:{bottom:"max(1.5rem, env(safe-area-inset-bottom) + 1rem)",left:"max(1.5rem, env(safe-area-inset-left) + 1rem)"},children:f.jsx(le,{content:T==="en"?"English":"中文",placement:"top",delay:200,children:f.jsx("button",{onClick:t,className:"w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 group hover:scale-110",title:`${a.ui.language}: ${T==="en"?"English":"中文"}`,children:f.jsx($e,{className:"text-theme-primary text-xl group-hover:rotate-180 transition-transform duration-300"})})})}),f.jsx("div",{className:"absolute z-50 transition-opacity duration-1000 opacity-100",style:{bottom:"max(1.5rem, env(safe-area-inset-bottom) + 1rem)",right:"max(1.5rem, env(safe-area-inset-right) + 1rem)"},children:f.jsx(le,{content:h.name[T]||h.name.en,placement:"left",delay:200,children:f.jsx("button",{onClick:n,className:"w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 group hover:scale-110",title:`${a.ui.toggleTheme}: ${h.name[T]||h.name.en}`,children:f.jsx(je,{className:"text-theme-primary text-xl group-hover:rotate-180 transition-transform duration-300"})})})}),f.jsx("div",{className:`absolute z-50 transition-opacity duration-1000 md:hidden ${x?"opacity-100":"opacity-0"}`,style:{bottom:"max(1.5rem, env(safe-area-inset-bottom) + 1rem)",left:"50%",transform:"translateX(-50%)"},children:f.jsx("p",{className:"text-white/70 text-sm font-medium whitespace-nowrap animate-pulse",children:a.ui.mobileScrollHint})})]})]})};et.propTypes={language:F.string.isRequired,enableOpeningAnimation:F.bool};export{et as default};
