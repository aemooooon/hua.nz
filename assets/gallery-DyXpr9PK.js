const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/three-Br820KFa.js","assets/vendor-RxfllKF0.js","assets/d3-BbFmVfHF.js","assets/vendor-DSulWsr7.css"])))=>i.map(i=>d[i]);
import{r as M,j as i}from"./react-N-_5-tx-.js";import{P as Se}from"./vendor-RxfllKF0.js";import{C as ot,R as ei,a as ti,b as _t,c as me,T as ii,d as si,M as oe,P as Yt,D as Ze,e as Je,f as $e,S as lt,g as gt,L as ni,h as oi,i as ai,O as ri,W as li,j as ci,k as ct,l as hi,m as ht,B as de,n as dt,o as Xe,p as Ne,F as st,V as Kt,q as nt,r as di,G as Ut,s as Vt,t as mt,u as qt}from"./three-Br820KFa.js";import{u as We,_ as mi}from"./about--wHcT9wa.js";import{t as ze}from"./texture-system-BOq70UEh.js";const gi=M.createContext(),ui=()=>{const l=M.useContext(gi);if(!l)throw new Error("usePhotoSwipe must be used within a PhotoSwipeProvider");return l},Xt=({size:l=120,strokeWidth:t=8,showMask:e=!0,maskColor:n="black-glass",className:h="",onMaskClick:m=null})=>{const p=(l-t)/2,Z=2*Math.PI*p,F=0,ge=()=>{switch(n){case"black-solid":return"absolute inset-0 bg-black";case"black-glass":return"absolute inset-0 bg-black/80 backdrop-blur-sm";case"default":default:return"absolute inset-0 bg-black/40 backdrop-blur-lg backdrop-saturate-150"}},te=({className:ke=""})=>i.jsxs("div",{className:`relative ${ke}`,style:{width:l,height:l,overflow:"visible"},children:[i.jsx("div",{className:"absolute pointer-events-none",style:{width:l+80,height:l+80,top:-40,left:-40,borderRadius:"50%",background:`radial-gradient(circle, 
                            transparent 60%, 
                            rgba(var(--theme-primary-rgb), 0.25) 75%, 
                            rgba(var(--theme-primary-rgb), 0.15) 85%, 
                            rgba(var(--theme-primary-rgb), 0.08) 92%, 
                            transparent 100%
                        )`,boxShadow:`
                            0 0 ${Math.max(l*.1,15)}px rgba(var(--theme-primary-rgb), 0.4),
                            0 0 ${Math.max(l*.2,25)}px rgba(var(--theme-primary-rgb), 0.2),
                            inset 0 0 ${Math.max(l*.05,6)}px rgba(var(--theme-primary-rgb), 0.15)
                        `,animation:"breathing-glow 3s ease-in-out infinite",zIndex:2}}),i.jsx("div",{className:"absolute",style:{width:l,height:l,borderRadius:"50%",boxShadow:`
                            0 0 ${Math.max(l*.03,4)}px var(--theme-primary),
                            0 0 ${Math.max(l*.06,8)}px rgba(var(--theme-primary-rgb), 0.6),
                            0 0 ${Math.max(l*.09,12)}px rgba(var(--theme-primary-rgb), 0.4),
                            inset 0 0 ${Math.max(l*.02,3)}px rgba(var(--theme-primary-rgb), 0.2)
                        `,animation:"avatar-glow 3s ease-in-out infinite",zIndex:9}}),i.jsxs("svg",{width:l,height:l,className:"transform -rotate-90 relative",style:{zIndex:10},children:[i.jsx("circle",{cx:l/2,cy:l/2,r:p,fill:"none",stroke:"rgba(255, 255, 255, 0.2)",strokeWidth:t}),i.jsx("circle",{cx:l/2,cy:l/2,r:p,fill:"none",stroke:"var(--theme-primary)",strokeWidth:t,strokeLinecap:"round",strokeDasharray:Z,strokeDashoffset:F,className:"transition-all duration-300 ease-out",style:{transformOrigin:"center"}})]}),i.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",style:{zIndex:20},children:i.jsx("span",{className:"text-white/90 text-lg font-medium drop-shadow-md",children:"Loading..."})})]});return e?i.jsxs("div",{className:`fixed inset-0 z-50 flex items-center justify-center ${h}`,onClick:m,style:{overflow:"visible"},children:[i.jsx("div",{className:ge()}),i.jsx("div",{className:"relative z-10",children:i.jsx(te,{})})]}):i.jsx(te,{className:h})};Xt.propTypes={size:Se.number,strokeWidth:Se.number,showMask:Se.bool,maskColor:Se.oneOf(["black-glass","black-solid","default"]),className:Se.string,onMaskClick:Se.func};const Zt=({language:l="zh"})=>{var se,J,ae,ne,Me,Y,we,re,le,pe,$,Le,Qe,Re,Te,He,De,be,ve,Pe,ue,et,tt,Ge,Fe,Be,Oe,_e,Ke,Ue;const t=We(k=>k.getAllGalleryItems()),e=We(k=>k.texts),{openPhotoSwipe:n}=ui(),h=M.useRef(null),[m,p]=M.useState(new Map),[I,Z]=M.useState(9),F=M.useMemo(()=>Array.isArray(t)?t.filter(k=>k.type!=="video"):[],[t]),ge=async k=>{try{if(!k||k.match(/\.(mp4|webm|mov|avi|mkv)$/i)||!k.match(/\.(jpg|jpeg|png|webp|avif)$/i))return k;const _=k.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,"");return await ze.getOptimalPath(_,"gallery")}catch(_){return console.warn("ç§»åŠ¨ç«¯å›¾ç‰‡æ ¼å¼ä¼˜åŒ–å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹è·¯å¾„:",_),k}};M.useEffect(()=>{(async()=>{if(F.length===0)return;const _=F.slice(0,I),z=new Map;for(const K of _)if(K.src&&!m.has(K.id)){const Q=await ge(K.src),je=K.thumbnail?await ge(K.thumbnail):Q;z.set(K.id,{src:Q,thumbnail:je})}z.size>0&&p(K=>new Map([...K,...z]))})()},[F,I,m]),M.useEffect(()=>{const k=()=>{const z=h.current;if(!z)return;const{scrollTop:K,scrollHeight:Q,clientHeight:je}=z;K+je>=Q-200&&I<F.length&&Z(it=>Math.min(it+6,F.length))},_=h.current;if(_)return _.addEventListener("scroll",k,{passive:!0}),()=>_.removeEventListener("scroll",k)},[I,F.length]);const te=F.slice(0,I).map((k,_)=>{const z=m.get(k.id);return{id:k.id||_,src:(z==null?void 0:z.src)||k.src,thumbnail:(z==null?void 0:z.thumbnail)||k.thumbnail||k.src,title:k.title||"",description:k.description||""}}),ke=k=>{const _=F.map((z,K)=>{const Q=m.get(z.id);return{id:z.id||K,src:(Q==null?void 0:Q.src)||z.src,thumbnail:(Q==null?void 0:Q.thumbnail)||z.thumbnail||z.src,title:z.title||"",description:z.description||""}});n(_,k)};return i.jsxs(i.Fragment,{children:[i.jsx("style",{children:`
        .gallery-mobile-container {
          min-height: 100vh;
          max-height: 100vh;
          overflow-y: auto;
          overflow-x: hidden;
          overscroll-behavior: none;
          
          /* iOS å®‰å…¨åŒºåŸŸæ”¯æŒ */
          padding-top: max(1rem, env(safe-area-inset-top));
          padding-bottom: max(1.5rem, env(safe-area-inset-bottom));
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
          
          /* ç¡®ä¿åœ¨iOSä¸Šå¹³æ»‘æ»šåŠ¨ */
          -webkit-overflow-scrolling: touch;
          
          /* é˜²æ­¢é€‰æ‹©æ–‡æœ¬ */
          -webkit-user-select: none;
          user-select: none;
          
          /* ç¡®ä¿è§¦æ‘¸æ»šåŠ¨æ­£å¸¸å·¥ä½œ */
          touch-action: pan-y;
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        .gallery-mobile-container::-webkit-scrollbar {
          width: 4px;
        }
        .gallery-mobile-container::-webkit-scrollbar-track {
          background: transparent;
        }
        .gallery-mobile-container::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.2);
          border-radius: 2px;
        }
        .gallery-mobile-container::-webkit-scrollbar-thumb:hover {
          background: rgba(255, 255, 255, 0.3);
        }
        
        /* ç§»åŠ¨ç«¯ç‰¹æ®Šå¤„ç† */
        @media (max-width: 768px) {
          .gallery-mobile-container {
            /* åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šéšè—æ»šåŠ¨æ¡ */
            scrollbar-width: none;
            -ms-overflow-style: none;
          }
          
          .gallery-mobile-container::-webkit-scrollbar {
            display: none;
          }
          
          /* ç¡®ä¿å›¾ç‰‡ç‚¹å‡»åŒºåŸŸå¯ç”¨ */
          .gallery-image-item {
            touch-action: manipulation;
          }
        }
      `}),i.jsxs("div",{ref:h,className:"gallery-mobile-container w-full",children:[i.jsxs("div",{className:"text-center mb-8 px-4",children:[i.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-theme-text-primary mb-4",children:((ae=(J=(se=e[l])==null?void 0:se.gallery)==null?void 0:J.mobile)==null?void 0:ae.title)||(l==="zh"?"ä½œå“é›†":"Gallery")}),i.jsx("p",{className:"text-theme-text-secondary max-w-2xl mx-auto leading-relaxed",children:((Y=(Me=(ne=e[l])==null?void 0:ne.gallery)==null?void 0:Me.mobile)==null?void 0:Y.subtitle)||(l==="zh"?"è®°å½•ç”Ÿæ´»ä¸­çš„ç¾å¥½ç¬é—´ï¼Œæ¯ä¸€å¼ ç…§ç‰‡éƒ½æ‰¿è½½ç€ç‹¬ç‰¹çš„æ•…äº‹ä¸å›å¿†ã€‚":"Capturing beautiful moments in life, each photo carries unique stories and memories.")}),i.jsx("p",{className:"text-theme-text-secondary/60 text-sm mt-2",children:((le=(re=(we=e[l])==null?void 0:we.gallery)==null?void 0:re.mobile)==null?void 0:le.tapHint)||(l==="zh"?"ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹å¤§å›¾":"Tap images to view full size")})]}),i.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[i.jsx("div",{className:"grid grid-cols-3 gap-2 sm:gap-3 md:gap-4 pb-16",children:te.map((k,_)=>{const z=m.get(k.id),K=(z==null?void 0:z.thumbnail)||(z==null?void 0:z.src);return i.jsx("div",{onClick:()=>ke(_),className:"group project-card cursor-pointer transform transition-all duration-300 active:scale-95",children:i.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-theme-surface/10",children:[K?i.jsx("img",{src:K,alt:`Gallery item ${_+1}`,className:"w-full h-full object-cover",loading:"lazy",onError:Q=>{console.warn(`ğŸ“± ä¼˜åŒ–å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå›é€€åˆ°åŸå§‹å›¾ç‰‡: ${k.id}`),Q.target.src=k.thumbnail||k.src}}):i.jsx("div",{className:"w-full h-full flex items-center justify-center bg-theme-surface/20",children:i.jsx("div",{className:"w-8 h-8 border-2 border-theme-text-secondary/30 border-t-theme-text-secondary rounded-full animate-spin"})}),i.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-active:opacity-100 transition-opacity duration-200 flex items-center justify-center",children:i.jsx("div",{className:"w-8 h-8 border-2 border-white rounded-full flex items-center justify-center",children:i.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})})]})},k.id)})}),I<F.length&&i.jsxs("div",{className:"text-center py-8",children:[i.jsxs("div",{className:"inline-flex items-center justify-center space-x-2 text-theme-text-secondary",children:[i.jsx("div",{className:"w-4 h-4 border-2 border-theme-text-secondary/30 border-t-theme-text-secondary rounded-full animate-spin"}),i.jsx("span",{className:"text-sm",children:((Le=($=(pe=e[l])==null?void 0:pe.gallery)==null?void 0:$.mobile)==null?void 0:Le.loadingMore)||(l==="zh"?"åŠ è½½æ›´å¤šå›¾ç‰‡...":"Loading more images...")})]}),i.jsxs("div",{className:"text-xs text-theme-text-secondary/60 mt-2",children:[((Te=(Re=(Qe=e[l])==null?void 0:Qe.gallery)==null?void 0:Re.mobile)==null?void 0:Te.showing)||(l==="zh"?"å·²æ˜¾ç¤º":"Showing")," ",I," / ",F.length," ",((be=(De=(He=e[l])==null?void 0:He.gallery)==null?void 0:De.mobile)==null?void 0:be.images)||(l==="zh"?"å¼ å›¾ç‰‡":"images")]})]}),te.length===0&&i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"w-16 h-16 bg-theme-surface/20 rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx("svg",{className:"w-8 h-8 text-theme-text-secondary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),i.jsx("div",{className:"text-theme-text-secondary text-lg mb-2",children:((ue=(Pe=(ve=e[l])==null?void 0:ve.gallery)==null?void 0:Pe.mobile)==null?void 0:ue.noContent)||(l==="zh"?"æš‚æ— å›¾ç‰‡å†…å®¹":"No gallery items available")}),i.jsx("div",{className:"text-theme-text-secondary/60 text-sm",children:((Ge=(tt=(et=e[l])==null?void 0:et.gallery)==null?void 0:tt.mobile)==null?void 0:Ge.tryAgain)||(l==="zh"?"è¯·ç¨åå†è¯•":"Please try again later")})]}),te.length>0&&i.jsxs("div",{className:"text-center mt-8 pb-16 mb-8",children:[i.jsx("p",{className:"text-theme-text-secondary/60 text-sm",children:`${te.length} ${((Oe=(Be=(Fe=e[l])==null?void 0:Fe.gallery)==null?void 0:Be.mobile)==null?void 0:Oe.images)||(l==="zh"?"å¼ å›¾ç‰‡":"images")} â€¢ ${((Ue=(Ke=(_e=e[l])==null?void 0:_e.gallery)==null?void 0:Ke.mobile)==null?void 0:Ue.tapToView)||(l==="zh"?"ç‚¹å‡»æŸ¥çœ‹å¤§å›¾":"Tap to view full size")}`}),i.jsx("div",{className:"h-20"})]})]})]})]})};Zt.propTypes={language:Se.string};class pi{constructor(t,e={}){this.scene=t,this.rectLights=[],this.helpers=[],this.animationId=null,this.config={intensity:e.intensity||5,colors:e.colors||[16739179,5164484,4569041,16370212],showHelpers:e.showHelpers||!1,enableAnimation:e.enableAnimation!==!1,animationSpeed:e.animationSpeed||.001,lightWidth:e.lightWidth||6,lightHeight:e.lightHeight||8,positions:e.positions||[{x:-18,y:8,z:15,rx:0,ry:0,rz:0},{x:18,y:8,z:15,rx:0,ry:Math.PI,rz:0},{x:0,y:10,z:35,rx:-Math.PI/2,ry:0,rz:0},{x:0,y:10,z:-15,rx:-Math.PI/2,ry:Math.PI,rz:0}]},this.clock=new ot,this.init()}init(){ei.init(),this.createRectAreaLights(),this.config.enableAnimation&&this.startAnimation()}createRectAreaLights(){this.config.positions.forEach((t,e)=>{const n=this.config.colors[e%this.config.colors.length],h=new ti(n,this.config.intensity,this.config.lightWidth,this.config.lightHeight);if(h.position.set(t.x,t.y,t.z),h.rotation.set(t.rx,t.ry,t.rz),this.scene.add(h),this.rectLights.push(h),this.config.showHelpers){const m=new _t(h);this.scene.add(m),this.helpers.push(m)}h.userData={originalIntensity:this.config.intensity,originalColor:new me(n),animationPhase:e/this.config.positions.length*Math.PI*2,index:e}})}startAnimation(){const t=()=>{this.animationId=requestAnimationFrame(t),this.updateAnimation()};t()}updateAnimation(){const t=this.clock.getElapsedTime();this.rectLights.forEach((e,n)=>{const h=e.userData,m=Math.sin(t*this.config.animationSpeed*1e3+h.animationPhase);e.intensity=h.originalIntensity+m*2;const p=Math.sin(t*this.config.animationSpeed*500+h.animationPhase*2)*.1;switch(e.color.copy(h.originalColor),n){case 0:e.color.r=Math.max(.3,e.color.r+p);break;case 1:e.color.g=Math.max(.3,e.color.g+p),e.color.b=Math.max(.3,e.color.b+p);break;case 2:e.color.b=Math.max(.3,e.color.b+p);break;case 3:e.color.r=Math.max(.3,e.color.r+p),e.color.g=Math.max(.3,e.color.g+p);break}})}setIntensity(t){this.config.intensity=t,this.rectLights.forEach(e=>{e.userData.originalIntensity=t})}setAnimationSpeed(t){this.config.animationSpeed=t}toggleHelpers(){this.config.showHelpers=!this.config.showHelpers,this.config.showHelpers?this.rectLights.forEach(t=>{const e=new _t(t);this.scene.add(e),this.helpers.push(e)}):(this.helpers.forEach(t=>{this.scene.remove(t)}),this.helpers=[])}setPreset(t){switch(t){case"warm":this.config.colors=[16739179,16370212,16752627,15620644],this.setIntensity(6),this.setAnimationSpeed(8e-4);break;case"cool":this.config.colors=[5164484,4569041,10837738,2547329],this.setIntensity(5),this.setAnimationSpeed(.0012);break;case"dramatic":this.config.colors=[16726072,3093826,16737096,8121759],this.setIntensity(8),this.setAnimationSpeed(.002);break;case"soft":this.config.colors=[16771751,14524637,10016968,16243823],this.setIntensity(3),this.setAnimationSpeed(5e-4);break}this.rectLights.forEach((e,n)=>{const h=this.config.colors[n%this.config.colors.length];e.userData.originalColor=new me(h)})}toggleAnimation(){this.config.enableAnimation=!this.config.enableAnimation,this.config.enableAnimation?this.startAnimation():(this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.rectLights.forEach(t=>{t.intensity=t.userData.originalIntensity,t.color.copy(t.userData.originalColor)}))}getStatus(){return{intensity:this.config.intensity,animationSpeed:this.config.animationSpeed,enableAnimation:this.config.enableAnimation,showHelpers:this.config.showHelpers,lightCount:this.rectLights.length}}dispose(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.rectLights.forEach(t=>{this.scene.remove(t)}),this.rectLights=[],this.helpers.forEach(t=>{this.scene.remove(t)}),this.helpers=[]}}class fi{generatePositionsFromGallery(){return null}extractBaseName(t){return t?t.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,""):null}constructor(t,e={},n=[]){this.scene=t,this.galleryData=n,this.lightCylinders=[],this.animationId=null,this.textureLoader=new ii,this.roomConfig={floorY:-2,ceilingY:8,height:10},this.config={radius:e.radius||.5,height:this.roomConfig.height,radialSegments:e.radialSegments||32,heightSegments:e.heightSegments||1,cubeWidth:e.cubeWidth||1,cubeHeight:e.cubeHeight||8,cubeDepth:e.cubeDepth||1,cubeCount:e.cubeCount||3,enableTexture:e.enableTexture!==!1,textureUrl:e.textureUrl||null,textureDelay:e.textureDelay||1e3,baseColor:e.baseColor||16711744,enableGlow:e.enableGlow!==!1,glowIntensity:e.glowIntensity||.7,emissiveIntensity:e.emissiveIntensity||.3,positions:[{x:-5,z:18,color:65535,textureBaseName:null},{x:5,z:18,color:16711744,textureBaseName:null},{x:0,z:-18,color:65416,textureBaseName:"gallery-horizontal-11",radius:1.618,rotationY:Math.PI/1.5}],intensity:e.intensity||20,lightIntensity:e.lightIntensity||20,lightDistance:e.lightDistance||80,enableAnimation:e.enableAnimation!==!1,animationSpeed:e.animationSpeed||.001,colors:[65535,16711744,65416]},this.clock=new ot,this.lightCubes=this.lightCylinders}async init(){console.log("ğŸ›ï¸ åˆå§‹åŒ–å‘å…‰åœ†æŸ±ä½“ç³»ç»Ÿï¼ˆä»åœ°æ¿åˆ°å¤©èŠ±æ¿ï¼‰..."),await this.preloadTextures(),this.createLightCylinders(),this.config.enableAnimation&&this.startAnimation()}async preloadTextures(){try{console.log("â© è·³è¿‡çº¹ç†é¢„åŠ è½½ï¼Œä½¿ç”¨æŒ‰éœ€åŠ è½½ç­–ç•¥")}catch(t){console.warn("âš ï¸ çº¹ç†é¢„åŠ è½½å¤±è´¥ï¼Œå°†ä½¿ç”¨åŸå§‹è·¯å¾„:",t)}}createLightCubes(){this.createLightCylinders()}createLightCylinders(){this.config.positions.forEach((t,e)=>{this.createSingleLightCylinder(t,e)}),console.log(`âœ… æ‰€æœ‰ ${this.config.positions.length} ä¸ªå‘å…‰åœ†æŸ±ä½“åˆ›å»ºå®Œæˆï¼ˆçº¹ç†å°†å»¶è¿ŸåŠ è½½ï¼‰`)}createSingleLightCube(t,e,n,h){const m={x:t,z:n,color:this.config.colors[h]||this.config.baseColor,textureBaseName:null};this.createSingleLightCylinder(m,h)}createSingleLightCylinder(t,e){const n={position:{x:t.x,y:2,z:t.z},mesh:null,light:null,index:e,config:t},h=t.radius||this.config.radius,m=this.config.height-.05,p=new si(h,h,m,this.config.radialSegments,this.config.heightSegments),I=this.createCylinderMaterial(t,e),Z=new oe(p,I),F=(this.roomConfig.floorY+this.roomConfig.ceilingY)/2;if(Z.position.set(t.x,F,t.z),t.rotationY!==void 0&&(Z.rotation.y=t.rotationY,console.log(`ğŸ”„ æŸ±å­ç»•Yè½´æ—‹è½¬: ${(t.rotationY*180/Math.PI).toFixed(1)}åº¦`)),this.scene.add(Z),n.mesh=Z,n.position.y=F,this.config.enableGlow){const te=new Yt(t.color,this.config.lightIntensity,this.config.lightDistance);te.position.set(t.x,F,t.z),this.scene.add(te),n.light=te}n.originalColor=new me(t.color),n.originalIntensity=this.config.lightIntensity,n.animationPhase=e*Math.PI*.6,this.lightCylinders.push(n);const ge=["Lightboxå‰å·¦ä¾§æŸ±å­(32ç±³å¢™çš„1/3ä½ç½®ï¼Œçº¦-10.67ç±³) - é’è‰²ä¸»é¢˜","Lightboxå‰å³ä¾§æŸ±å­(32ç±³å¢™çš„2/3ä½ç½®ï¼Œçº¦10.67ç±³) - çº¢è‰²ä¸»é¢˜","æ‘„åƒæœºèƒŒåç»¿è‰²æŸ±å­(ä»åœ°æ¿åˆ°å¤©èŠ±æ¿ï¼Œé»„é‡‘æ¯”ä¾‹ç›´å¾„) - ç»¿è‰²ä¸»é¢˜"];console.log(`ğŸ›ï¸ åˆ›å»ºå‘å…‰åœ†æŸ±ä½“ ${e+1}: ${ge[e]} ä½ç½®(${t.x}, ${F}, ${t.z}), é«˜åº¦${this.config.height}ç±³, åŠå¾„${h}ç±³, ç›´å¾„${(h*2).toFixed(3)}ç±³`),t.textureUrl&&console.log(`ğŸ–¼ï¸ åœ†æŸ±ä½“ ${e+1} åº”ç”¨è´´å›¾: ${t.textureUrl}`)}createCylinderMaterial(t,e){const n=t.color||this.config.baseColor,h=t.textureBaseName||this.config.textureBaseName;let m={transparent:!0,opacity:.9,side:Ze};m={...m,color:n,emissive:new me(n).multiplyScalar(this.config.emissiveIntensity)};const p=new Je(m);return h&&this.config.enableTexture&&setTimeout(async()=>{try{console.log(`ğŸ–¼ï¸ å»¶è¿ŸåŠ è½½åœ†æŸ±ä½“ ${e+1} çš„çº¹ç†: ${h}`);const I=await this.loadGalleryTexture(h);I.repeat.set(1,1),p.map=I,p.color=new me(1,1,1),p.needsUpdate=!0,console.log(`âœ… åœ†æŸ±ä½“ ${e+1} çº¹ç†åŠ è½½å®Œæˆ: ${h}`)}catch(I){console.warn(`âŒ åœ†æŸ±ä½“ ${e+1} çº¹ç†åŠ è½½å¤±è´¥: ${h}`,I)}},this.config.textureDelay||2e3),p}setTexture(t,e){if(t>=0&&t<this.lightCylinders.length){const n=this.lightCylinders[t];if(e){console.log(`ğŸ–¼ï¸ ä¸ºåœ†æŸ±ä½“ ${t+1} è®¾ç½®æ–°è´´å›¾: ${e}`);const h=this.textureLoader.load(e);h.wrapS=$e,h.wrapT=$e,h.repeat.set(1,1);const m=new Je({map:h,transparent:!0,opacity:.9,emissive:new me(n.config.color).multiplyScalar(this.config.emissiveIntensity),side:Ze});n.mesh&&n.mesh.material&&(n.mesh.material.dispose(),n.mesh.material=m),console.log(`âœ… åœ†æŸ±ä½“ ${t+1} è´´å›¾å·²åº”ç”¨ï¼Œç…§æ˜åŠŸèƒ½ä¿æŒæ­£å¸¸`)}else{console.log(`ğŸ”„ ç§»é™¤åœ†æŸ±ä½“ ${t+1} çš„è´´å›¾ï¼Œæ¢å¤å‘å…‰æ•ˆæœ`);const h=new Je({color:n.config.color,transparent:!0,opacity:.9,emissive:new me(n.config.color).multiplyScalar(this.config.emissiveIntensity),side:Ze});n.mesh&&n.mesh.material&&(n.mesh.material.dispose(),n.mesh.material=h)}}}startAnimation(){const t=()=>{this.config.enableAnimation&&(this.updateAnimation(),this.animationId=requestAnimationFrame(t))};t()}updateAnimation(){const t=this.clock.getElapsedTime();this.lightCylinders.forEach(e=>{if(e.light){const n=Math.sin(t*this.config.animationSpeed*1e3+e.animationPhase)*.3+.7;e.light.intensity=e.originalIntensity*n;const h=Math.sin(t*this.config.animationSpeed*500+e.animationPhase)*.1,m={};e.originalColor.getHSL(m),m.h=(m.h+h)%1;const p=new me().setHSL(m.h,m.s,m.l);e.light.color.copy(p),e.mesh&&e.mesh.material&&(e.mesh.material.map||(e.mesh.material.color.copy(p),e.mesh.material.emissive&&e.mesh.material.emissive.copy(p.clone().multiplyScalar(this.config.emissiveIntensity))))}})}stopAnimation(){this.config.enableAnimation=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}setIntensity(t){this.setLightIntensity(t)}setLightIntensity(t){this.config.lightIntensity=t,this.config.intensity=t,this.lightCylinders.forEach(e=>{e.originalIntensity=t,e.light&&(e.light.intensity=t)})}toggleAnimation(){this.config.enableAnimation=!this.config.enableAnimation,this.config.enableAnimation?this.startAnimation():this.stopAnimation()}getStatus(){return{cylinderCount:this.lightCylinders.length,cubeCount:this.lightCylinders.length,lightIntensity:this.config.lightIntensity,intensity:this.config.intensity,enableAnimation:this.config.enableAnimation,enableTexture:this.config.enableTexture,radius:this.config.radius,height:this.config.height}}dispose(){this.stopAnimation(),this.lightCylinders.forEach(t=>{t.mesh&&(this.scene.remove(t.mesh),t.mesh.geometry&&t.mesh.geometry.dispose(),t.mesh.material&&t.mesh.material.dispose()),t.light&&this.scene.remove(t.light)}),this.lightCylinders=[],console.log("ğŸ›ï¸ å‘å…‰åœ†æŸ±ä½“ç³»ç»Ÿå·²æ¸…ç†")}getBestTexturePath(t){return!t||!t.startsWith("/gallery/")?t:t.split("/").pop().replace(".jpg","")}async loadGalleryTexture(t){if(!t)throw new Error("åŸºç¡€åç§°ä¸èƒ½ä¸ºç©º");try{console.log(`ğŸ–¼ï¸ ä½¿ç”¨textureSystemåŠ è½½Galleryçº¹ç†: ${t}`);const e=await ze.getCompressionInfo();console.log(`ğŸ¯ å½“å‰æµè§ˆå™¨æ”¯æŒæ ¼å¼: ${e.format} (${e.description})`);const n=await ze.loadTexture(t);return console.log(`âœ… Galleryçº¹ç†åŠ è½½æˆåŠŸ: ${t}`),n}catch(e){throw console.error(`âŒ Galleryçº¹ç†åŠ è½½å¤±è´¥: ${t}`,e),e}}}class yi{constructor(t,e,n={}){this.scene=t,this.renderer=e,this.spotlights=[],this.animationId=null,this.config={lightCount:n.lightCount||4,ceilingHeight:n.ceilingHeight||10,positions:[{x:-36,y:10,z:0},{x:36,y:10,z:0},{x:0,y:10,z:-24}],targets:[{x:-32,y:1,z:0},{x:32,y:1,z:0},{x:0,y:1,z:-20}],intensity:n.intensity||3500,distance:n.distance||70,angle:n.angle||Math.PI/2,penumbra:n.penumbra||.3,colors:[16711744,65416,65535],enableAnimation:n.enableAnimation!==!1,animationSpeed:n.animationSpeed||.5,showHelpers:n.showHelpers||!1},this.clock=new ot,this.init()}async init(){try{await this.createSpotlights(),this.config.enableAnimation&&this.startAnimation(),console.log("âœ¨ IESèšå…‰ç¯ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ")}catch(t){console.warn("âš ï¸ IESèšå…‰ç¯åˆå§‹åŒ–å¤±è´¥ï¼Œä½¿ç”¨æ ‡å‡†èšå…‰ç¯:",t),this.createStandardSpotlights()}}async createSpotlights(){let t=null;try{t=(await mi(()=>import("./three-Br820KFa.js").then(n=>n.ab),__vite__mapDeps([0,1,2,3]))).IESSpotLight}catch(e){console.log("ğŸ¯ IESSpotLightä¸å¯ç”¨:",e.message)}t&&this.renderer.isWebGPURenderer?(console.log("ğŸ¯ ä½¿ç”¨IESèšå…‰ç¯ (WebGPU)"),await this.createIESSpotlights(t)):(console.log("ğŸ¯ ä½¿ç”¨æ ‡å‡†èšå…‰ç¯ï¼ˆé™çº§æ–¹æ¡ˆï¼‰"),this.createStandardSpotlights())}async createIESSpotlights(t){for(let e=0;e<this.config.lightCount;e++){const n=this.config.positions[e],h=this.config.targets[e],m=this.config.colors[e%this.config.colors.length],p=new t(m,this.config.intensity);if(p.position.set(n.x,n.y,n.z),p.angle=this.config.angle,p.penumbra=this.config.penumbra,p.distance=this.config.distance,p.castShadow=!0,p.shadow.mapSize.width=2048,p.shadow.mapSize.height=2048,p.shadow.camera.near=.5,p.shadow.camera.far=this.config.distance,p.shadow.bias=-1e-4,p.shadow.normalBias=.02,p.target.position.set(h.x,h.y,h.z),this.scene.add(p),this.scene.add(p.target),this.config.showHelpers){const Z=new lt(p);p.userData.helper=Z,this.scene.add(Z)}const I={light:p,originalPosition:{...n},originalTarget:{...h},originalIntensity:this.config.intensity,originalColor:new me(m),animationPhase:e*Math.PI*.5,index:e};this.spotlights.push(I),console.log(`ğŸ’¡ åˆ›å»ºIESèšå…‰ç¯ ${e+1}: ä½ç½®(${n.x}, ${n.y}, ${n.z}) -> ç›®æ ‡(${h.x}, ${h.y}, ${h.z})`)}}createStandardSpotlights(){for(let t=0;t<this.config.lightCount;t++){const e=this.config.positions[t],n=this.config.targets[t],h=this.config.colors[t%this.config.colors.length],m=new gt(h,this.config.intensity,this.config.distance,this.config.angle,this.config.penumbra);if(m.position.set(e.x,e.y,e.z),m.castShadow=!0,m.shadow.mapSize.width=2048,m.shadow.mapSize.height=2048,m.shadow.camera.near=.5,m.shadow.camera.far=this.config.distance,m.shadow.bias=-1e-4,m.shadow.normalBias=.02,m.target.position.set(n.x,n.y,n.z),this.scene.add(m),this.scene.add(m.target),this.config.showHelpers){const I=new lt(m);m.userData.helper=I,this.scene.add(I)}const p={light:m,originalPosition:{...e},originalTarget:{...n},originalIntensity:this.config.intensity,originalColor:new me(h),animationPhase:t*Math.PI*.5,index:t};this.spotlights.push(p),console.log(`ğŸ’¡ åˆ›å»ºæ ‡å‡†èšå…‰ç¯ ${t+1}: ä½ç½®(${e.x}, ${e.y}, ${e.z}) -> ç›®æ ‡(${n.x}, ${n.y}, ${n.z})`)}}startAnimation(){const t=()=>{this.config.enableAnimation&&(this.updateAnimation(),this.animationId=requestAnimationFrame(t))};t()}updateAnimation(){const t=this.clock.getElapsedTime()*this.config.animationSpeed;this.spotlights.forEach((e,n)=>{const{light:h,originalTarget:m,animationPhase:p}=e,I=t+p,Z=2,F=m.x+Math.sin(I*.8)*Z*.3,ge=m.z+Math.cos(I*.6)*Z*.3,te=m.y+Math.sin(I*.4)*.5;h.target.position.x=F,h.target.position.y=te,h.target.position.z=ge;const ke=.9,se=Math.sin(I*1.2+n*.5)*.2;h.intensity=e.originalIntensity*(ke+se);const J=Math.sin(I*.8+n*.6)*.3,ae={};e.originalColor.getHSL(ae);const ne=(ae.h+J+t*.1)%1,Me=Math.max(.7,ae.s+Math.sin(I*1.5)*.3),Y=Math.max(.4,Math.min(.8,ae.l+Math.sin(I*2)*.2)),we=new me().setHSL(ne,Me,Y);h.color.copy(we);const re=Math.sin(I*.5+n*.3)*.02;h.angle=this.config.angle+re,h.userData.helper&&h.userData.helper.update()})}setIntensity(t){this.config.intensity=t,this.spotlights.forEach(e=>{e.originalIntensity=t,e.light.intensity=t})}setAnimationSpeed(t){this.config.animationSpeed=t}toggleHelpers(){this.config.showHelpers=!this.config.showHelpers,this.spotlights.forEach(t=>{const{light:e}=t;if(this.config.showHelpers){if(!e.userData.helper){const n=new lt(e);e.userData.helper=n,this.scene.add(n)}e.userData.helper.visible=!0}else e.userData.helper&&(e.userData.helper.visible=!1)})}toggleAnimation(){this.config.enableAnimation=!this.config.enableAnimation,this.config.enableAnimation?this.startAnimation():this.stopAnimation()}stopAnimation(){this.config.enableAnimation=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}getStatus(){return{lightCount:this.config.lightCount,intensity:this.config.intensity,enableAnimation:this.config.enableAnimation,showHelpers:this.config.showHelpers,animationSpeed:this.config.animationSpeed}}dispose(){this.stopAnimation(),this.spotlights.forEach(t=>{const{light:e}=t;e&&(this.scene.remove(e),this.scene.remove(e.target),e.userData.helper&&this.scene.remove(e.userData.helper))}),this.spotlights=[],console.log("ğŸ§¹ IESèšå…‰ç¯ç³»ç»Ÿå·²æ¸…ç†")}}const Jt=({language:l="en"})=>{var Ge,Fe,Be,Oe,_e,Ke,Ue,k,_,z,K,Q,je,at,it,ut,pt,ft,yt,xt,wt,bt,vt,St,kt,Mt,Lt,Pt,It,At,zt,jt,Ct,Et,Nt,$t,Wt,Rt,Tt,Ht,Dt,Gt,Ft;const[t,e]=M.useState(!0),[n,h]=M.useState(!1),[m,p]=M.useState(!1),[I,Z]=M.useState(!1),[F,ge]=M.useState(!1),[te,ke]=M.useState(!1),se=We(C=>C.getAllGalleryItems()),J=We(C=>C.texts),ae=We(C=>C.isPointerLocked),ne=We(C=>C.setIsPointerLocked),Me=M.useRef(new Map),Y=M.useRef({w:!1,a:!1,s:!1,d:!1,ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1});M.useEffect(()=>{const C=()=>{const fe=window.innerWidth<=768||"ontouchstart"in window;Z(fe),fe&&ge(!0)};return C(),window.addEventListener("resize",C),()=>window.removeEventListener("resize",C)},[]);const we=M.useRef(null),re=M.useRef(null),le=M.useRef(null),pe=M.useRef(null),$=M.useRef(null),Le=M.useRef(null),Qe=M.useRef(new ot),Re=M.useRef(null),Te=M.useRef([]),He=M.useRef(null),De=M.useRef([]),be=M.useRef(null),ve=M.useRef(null),Pe=M.useRef(null),ue=M.useRef(null),et=M.useRef(null),tt=M.useRef(null);return M.useEffect(()=>{if(!we.current)return;const C=we.current,fe=f=>{const d=new Ut;f.add(d),Re.current=d;const y=32,j=72,T=new Xe(y,j),g=(()=>{const w=document.createElement("canvas"),a=1024;w.width=a,w.height=a;const s=w.getContext("2d"),P="#1a1a1a",D=["#262626","#2a2a2a","#1e1e1e","#333333","#2d2d2d"];s.fillStyle=P,s.fillRect(0,0,a,a);for(let E=0;E<2e3;E++){const R=Math.random()*a,xe=Math.random()*a,ie=Math.random()*8+2,ce=Math.random()*.3+.1;s.globalAlpha=ce,s.fillStyle=D[Math.floor(Math.random()*D.length)],s.beginPath(),s.arc(R,xe,ie,0,Math.PI*2),s.fill()}s.globalAlpha=.15,s.strokeStyle="#404040",s.lineWidth=1;for(let E=0;E<50;E++){const R=Math.random()*a,xe=Math.random()*a,ie=Math.random()*100+50,ce=Math.random()*Math.PI*2;s.beginPath(),s.moveTo(R,xe),s.lineTo(R+Math.cos(ce)*ie,xe+Math.sin(ce)*ie),s.stroke()}const V=s.createRadialGradient(a/2,a/2,0,a/2,a/2,a/2);V.addColorStop(0,"rgba(80, 80, 80, 0.15)"),V.addColorStop(.5,"rgba(60, 60, 60, 0.08)"),V.addColorStop(1,"rgba(40, 40, 40, 0.02)"),s.globalAlpha=1,s.fillStyle=V,s.fillRect(0,0,a,a),s.globalAlpha=.06;for(let E=0;E<15;E++){const R=Math.random()*a,xe=Math.random()*a,ie=Math.random()*2+1;s.fillStyle="#00ffaa",s.beginPath(),s.arc(R,xe,ie,0,Math.PI*2),s.fill()}s.globalAlpha=1;const O=new Vt(w);return O.wrapS=$e,O.wrapT=$e,O.repeat.set(6,6),O})(),ee=new Je({map:g,color:1710618,metalness:.05,roughness:.3,envMapIntensity:1.2}),B=new oe(T,ee);B.rotation.x=-Math.PI/2,B.position.y=-2,B.receiveShadow=!0,f.add(B);const ye=(()=>{const w=document.createElement("canvas"),a=1024;w.width=a,w.height=a;const s=w.getContext("2d");s.fillStyle="#f8f8f8",s.fillRect(0,0,a,a);const P=64,D=2;s.strokeStyle="#e0e0e0",s.lineWidth=D;for(let O=0;O<=a;O+=P)s.beginPath(),s.moveTo(O,0),s.lineTo(O,a),s.stroke();for(let O=0;O<=a;O+=P)s.beginPath(),s.moveTo(0,O),s.lineTo(a,O),s.stroke();const V=new Vt(w);return V.wrapS=$e,V.wrapT=$e,V.repeat.set(4,4),V})(),W=new oe(new Xe(y,j),new Ne({map:ye,color:16777215,transparent:!1,side:Ze}));W.rotation.x=Math.PI/2,W.position.y=8,W.receiveShadow=!0,f.add(W);const G=new Ne({color:16316664,side:st,transparent:!1}),U=32,Ce=72,v=12,u=.5,x=new oe(new de(U,v,u),G);x.position.set(0,3,-36),x.receiveShadow=!0,x.castShadow=!1,d.add(x),f.add(x);const b=new oe(new de(10,v,u),G);b.position.set(-11,3,36),b.receiveShadow=!0,b.castShadow=!1,d.add(b),f.add(b);const o=new oe(new de(10,v,u),G);o.position.set(11,3,36),o.receiveShadow=!0,o.castShadow=!1,d.add(o),f.add(o);const r=new oe(new de(u,v,Ce),G);r.position.set(-16,3,0),r.receiveShadow=!0,r.castShadow=!1,d.add(r),f.add(r);const c=new oe(new de(u,v,Ce),G);c.position.set(16,3,0),c.receiveShadow=!0,c.castShadow=!1,d.add(c),f.add(c)},H=(f,d=null)=>{if(!se||se.length===0){for(let v=0;v<6;v++){const u=new Xe(3,2),x=new Ne({color:6710886}),b=new oe(u,x);v<3?(b.position.set(-6+v*6,3,-14.9),b.rotation.y=0):(b.position.set(-14.9,3,-6+(v-3)*6),b.rotation.y=Math.PI/2),f.add(b)}return}const y=Math.min(se.length,22),j=2.2,T=4,A=async()=>{const v=[];for(let b=0;b<Math.min(se.length,y);b++){const o=se[b];if(o.src||o.thumbnail)try{let r,c;o.aspectRatio&&o.dimensions?(r=o.aspectRatio,c=o.dimensions,console.log(`âœ… ä½¿ç”¨é¢„è®¡ç®—å°ºå¯¸: ${o.id} - ${c.width}x${c.height} (${r.toFixed(2)})`)):(console.log(`âš ï¸ ç¼ºå°‘é¢„è®¡ç®—å°ºå¯¸ï¼ŒåŠ¨æ€æ£€æµ‹: ${o.id}`),c=await B(o.src||o.thumbnail),r=c.width/c.height),v.push({index:b,item:o,aspectRatio:r,isPortrait:r<.8,isLandscape:r>1.3,isSquare:r>=.8&&r<=1.3,dimensions:c,isPrecomputed:!!(o.aspectRatio&&o.dimensions)})}catch(r){console.warn(`âŒ å›¾ç‰‡å°ºå¯¸åˆ†æå¤±è´¥: ${o.id}`,r),v.push({index:b,item:o,aspectRatio:1,isPortrait:!1,isLandscape:!1,isSquare:!0,dimensions:{width:300,height:200},isPrecomputed:!1})}}const u=v.filter(b=>b.isPrecomputed).length,x=v.length;return console.log(`ğŸ“Š å°ºå¯¸åˆ†æå®Œæˆ: ${u}/${x} ä½¿ç”¨é¢„è®¡ç®—æ•°æ® (${Math.round(u/x*100)}%)`),v},g=v=>{const u={backWall:[],rightWall:[],leftWall:[],frontWall:[]},x=v.filter(w=>w.item.position!=="lightbox"),b=x.filter(w=>w.item.wall==="vertical_wall_32m"),o=x.filter(w=>w.item.wall==="horizontal_wall_64m"),r=o.filter(w=>w.item.layer==="upper"),c=o.filter(w=>w.item.layer==="lower");return u.backWall=b.slice(0,3),u.frontWall=b.slice(3,5),u.rightWall=[...r.slice(0,4),...c.slice(0,4)],u.leftWall=[...r.slice(4,8),...c.slice(4,8)],u},ee=async()=>{if(f.children.some(r=>r.name&&r.name.startsWith("painting_"))){console.log("â­ï¸ è·³è¿‡é‡å¤åˆ›å»ºç”»ä½œï¼ˆç”»ä½œå·²å­˜åœ¨ï¼‰");return}console.log("ğŸ¨ å¼€å§‹åˆ›å»ºç”»å»Šç”»ä½œ...");const v=await A(),u=g(v),x=new Map,b=async(r,c,w)=>{var Ee,qe,Ye,he;const a=r.item,s=r.aspectRatio;let P,D;s>1.5?(P=Math.min(T,j*s*.8),D=P/s):s<.7?(D=j,P=D*s):(D=j*.9,P=D*s);const V=new Xe(P,D),O=new dt({color:16777215,metalness:0,roughness:.15,clearcoat:.1,clearcoatRoughness:.1,reflectivity:.3,emissive:1052688,emissiveIntensity:.02,side:Ze}),E=new oe(V,O),R=Ce(E,P,D),xe=35.5;switch(c){case"backWall":R.position.set(-10+w*10,2.4,-35.5),R.rotation.y=0;break;case"rightWall":{const{x:L,y:S,z:X}=N(r.item,u.rightWall);R.position.set(L,S,X),R.rotation.y=-Math.PI/2;break}case"leftWall":{const{x:L,y:S,z:X}=ye(r.item,u.leftWall);R.position.set(L,S,X),R.rotation.y=Math.PI/2;break}case"frontWall":w===0?R.position.set(-10,2.4,xe):R.position.set(10,2.4,xe),R.rotation.y=Math.PI;break}R.castShadow=!1,R.receiveShadow=!1,R.name=`painting_${c}_${w}`,f.add(R),De.current.push({mesh:R,position:R.position.clone(),painting:E}),Me.current.set(a.id,{position:R.position.clone(),item:a,mesh:R}),setTimeout(()=>{(c==="frontWall"||c==="rightWall"&&r.item.layer==="lower"||c==="leftWall"&&r.item.layer==="lower")&&W(R)},100);const ie=a.src||a.thumbnail,ce=ie.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,"");if(console.log(`ğŸ” æŸ¥æ‰¾çº¹ç† - item.id: ${a.id}, é¢„åŠ è½½çº¹ç†æ•°é‡: ${((Ee=ue.current)==null?void 0:Ee.textures.size)||0}`),console.log("ğŸ” é¢„åŠ è½½çº¹ç†keys:",Array.from(((qe=ue.current)==null?void 0:qe.textures.keys())||[])),(Ye=ue.current)!=null&&Ye.textures.has(a.id)){const L=ue.current.textures.get(a.id);E.material.map=L,E.material.color.setHex(16777215),E.material.needsUpdate=!0,console.log(`âœ… ä½¿ç”¨é¢„åŠ è½½Galleryçº¹ç†: ${a.id}`)}else if((he=ue.current)!=null&&he.videos.has(a.id)){const L=ue.current.videos.get(a.id);if(E.material.map=L,E.material.color.setHex(16777215),E.material.needsUpdate=!0,console.log(`âœ… ä½¿ç”¨é¢„åŠ è½½è§†é¢‘çº¹ç†: ${a.id}`),L.image){const S=L.image;S.paused&&S.play().catch(X=>{console.warn("Galleryè§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œæ·»åŠ ç”¨æˆ·äº¤äº’ç›‘å¬:",X);const q=()=>{S.paused&&S.play().then(()=>{console.log(`ğŸ¬ Galleryè§†é¢‘ç”¨æˆ·äº¤äº’åå¼€å§‹æ’­æ”¾: ${a.id}`)}).catch(rt=>console.warn("ç”¨æˆ·äº¤äº’åæ’­æ”¾å¤±è´¥:",rt))};document.addEventListener("click",q,{once:!0}),document.addEventListener("touchstart",q,{once:!0})})}}else if(x.has(ie))E.material.map=x.get(ie),E.material.color.setHex(16777215),E.material.needsUpdate=!0;else try{if(a.type==="video"){const L=document.createElement("video");L.src=ie,L.autoplay=a.autoplay||!0,L.loop=a.loop||!0,L.muted=a.muted||!0,L.controls=a.controls||!1,L.crossOrigin="anonymous",L.playsInline=!0,await new Promise((X,q)=>{L.oncanplay=X,L.onerror=q,L.load()});const S=new Kt(L);S.generateMipmaps=!1,S.minFilter=nt,S.magFilter=nt,S.flipY=!0,S.colorSpace=ct,x.set(ie,S),E.material.map=S,E.material.color.setHex(16777215),E.material.needsUpdate=!0,L.play().catch(X=>{console.warn("è§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’:",X)}),console.log(`ğŸ¬ åŠ è½½è§†é¢‘çº¹ç†: ${a.title.zh||a.title.en}`)}else{let L;a.id==="gallery_lightbox"?L=a.src.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,""):L=a.id.replace(/_/g,"-"),console.log(`âš ï¸ é¢„åŠ è½½çº¹ç†ä¸å¯ç”¨ï¼Œå°è¯•å•ç‹¬åŠ è½½: ${a.id} -> ${L}`);const S=await ze.loadSceneTextures("gallery",{images:[L],folder:"gallery"});if(S.textures.has(L)){const X=S.textures.get(L);x.set(ie,X),E.material.map=X,E.material.color.setHex(16777215),E.material.needsUpdate=!0,console.log(`âœ… å•ç‹¬åŠ è½½Galleryçº¹ç†æˆåŠŸ: ${L}`)}else throw new Error(`çº¹ç†åŠ è½½å¤±è´¥: ${L}`)}}catch(L){console.warn(`Galleryçº¹ç†åŠ è½½å¤±è´¥: ${ce}`,L),E.material.color.setHex(6710886),E.material.needsUpdate=!0}},o=[...u.backWall.map((r,c)=>({data:r,wallType:"backWall",index:c})),...u.rightWall.map((r,c)=>({data:r,wallType:"rightWall",index:c})),...u.leftWall.map((r,c)=>({data:r,wallType:"leftWall",index:c})),...u.frontWall.map((r,c)=>({data:r,wallType:"frontWall",index:c}))];for(let r=0;r<o.length;r+=4){const c=o.slice(r,r+4);await Promise.all(c.map(({data:w,wallType:a,index:s})=>b(w,a,s))),r+4<o.length&&await new Promise(w=>setTimeout(w,100))}console.log("ğŸ¨ æ‰€æœ‰ç”»ä½œçº¹ç†åŠ è½½å®Œæˆï¼Œè§¦å‘åŠ è½½ç®¡ç†å™¨å›è°ƒ"),d&&d.onLoad&&setTimeout(()=>{d.onLoad()},200)},B=async v=>{try{const u=v.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,""),x=await ze.getOptimalPath(u,"gallery");return new Promise(b=>{const o=new Image;o.onload=()=>{b({width:o.width,height:o.height})},o.onerror=()=>{const r=new Image;r.onload=()=>{b({width:r.width,height:r.height})},r.onerror=()=>{b({width:300,height:200})},r.src=v},o.src=x})}catch{return new Promise(u=>{const x=new Image;x.onload=()=>{u({width:x.width,height:x.height})},x.onerror=()=>{u({width:300,height:200})},x.src=v})}},N=(v,u)=>{const c=[-28,-12,4,20],w=[-20,-4,12,28];if(v.layer==="upper"){const a=u.filter(s=>s.item.layer==="upper").findIndex(s=>s.item.id===v.id);return{x:15.5,y:1.8+1.2,z:w[a]||0}}else{const a=u.filter(s=>s.item.layer==="lower").findIndex(s=>s.item.id===v.id);return{x:15.5,y:1.8,z:c[a]||0}}},ye=(v,u)=>{const b=N(v,u);return{x:-15.5,y:b.y,z:-b.z}},W=v=>{const u=v.position,x=v.rotation,b=Math.abs(x.y)<.1||Math.abs(x.y-Math.PI)<.1;let o,r,c,w;b?(o=Math.PI/9,r=.08,c=12,w=6):(o=Math.PI/6,r=.15,c=15,w=3.5);const a=new gt(16775393,1.5,c,o,r,1);let s=new qt;const P=Math.max(7,u.y+w),D=1.8;return Math.abs(x.y)<.1?s.set(u.x,P,u.z+D):Math.abs(x.y-Math.PI)<.1?s.set(u.x,P,u.z-D):Math.abs(x.y+Math.PI/2)<.1?s.set(u.x-D,P,u.z):Math.abs(x.y-Math.PI/2)<.1&&s.set(u.x+D,P,u.z),a.position.copy(s),a.target=v,a.castShadow=!1,a.userData={paintingPosition:u.clone(),baseIntensity:1,maxIntensity:8,activationDistance:6,optimalDistance:2},f.add(a),f.add(a.target),Te.current.push(a),a},G=.05,U=.1,Ce=(v,u=2.5,x=2)=>{const b=new Ut,o=new dt({color:1710618,metalness:.8,roughness:.2,clearcoat:.3,clearcoatRoughness:.1,emissive:657930,emissiveIntensity:.05}),r=[new de(u+U*2,U,G),new de(u+U*2,U,G),new de(U,x,G),new de(U,x,G)],c=[{x:0,y:(x+U)/2,z:G/2},{x:0,y:-(x+U)/2,z:G/2},{x:-(u+U)/2,y:0,z:G/2},{x:(u+U)/2,y:0,z:G/2}];return r.forEach((w,a)=>{const s=new oe(w,o);s.position.set(c[a].x,c[a].y,c[a].z),s.castShadow=!1,s.receiveShadow=!1,b.add(s)}),b.add(v),b};ee()},Ie=(f,d)=>{const y=6*f,j=pe.current,T=j.position.clone();(Y.current.w||Y.current.ArrowUp)&&d.moveForward(y),(Y.current.s||Y.current.ArrowDown)&&d.moveForward(-y),(Y.current.d||Y.current.ArrowRight)&&d.moveRight(y),(Y.current.a||Y.current.ArrowLeft)&&d.moveRight(-y),Ae(j)&&j.position.copy(T),((g,ee)=>{if(!ee.isLocked)return;let B=null,N=1/0;const ye=4;if(Me.current.forEach(W=>{const G=g.position.distanceTo(W.position);G<ye&&G<N&&(N=G,B=W)}),B){const W=B.position.y,G=g.position.y,U=W-G;g.position.y+=U*.15}else{const U=2.4-g.position.y;g.position.y+=U*.08}g.position.y=Math.max(1.2,Math.min(3.5,g.position.y))})(j,d),d.isLocked||(j.position.y=2.4),Ve(j.position)},Ae=f=>{const d=f.position,y=14.5,j=34.5;if(d.x>y||d.x<-y||d.z>j||d.z<-j)return!0;const T=[{x:-5,z:18,radius:.5},{x:5,z:18,radius:.5},{x:0,z:-18,radius:1.618/2}],A=.5;for(const g of T)if(Math.sqrt(Math.pow(d.x-g.x,2)+Math.pow(d.z-g.z,2))<g.radius+A)return!0;return!1},Ve=f=>{Te.current.forEach(d=>{const y=d.userData;if(!y||!y.paintingPosition)return;const j=f.distanceTo(y.paintingPosition);let T=y.baseIntensity;if(j<=y.activationDistance){const A=Math.max(0,(y.activationDistance-j)/y.activationDistance),g=y.maxIntensity-y.baseIntensity,ee=Math.pow(A,1.5);T=y.baseIntensity+g*ee,j<=y.optimalDistance&&(T=y.maxIntensity)}d.intensity=mt.lerp(d.intensity,T,.12)}),Bt(f)},Bt=f=>{const d=He.current;if(!d)return;let y=1/0;De.current.forEach(T=>{const A=f.distanceTo(T.position);A<y&&(y=A)});const j=pe.current;if(j){const T=new qt;j.getWorldDirection(T);const A=j.position.clone().add(T.multiplyScalar(10));d.target.position.copy(A),d.target.updateMatrixWorld()}if(y<=6){const A=3+Math.max(0,(6-y)/6)*12;d.intensity=mt.lerp(d.intensity,A,.1)}else d.intensity=mt.lerp(d.intensity,1.5,.1)},Ot=()=>{const f=pe.current;if(!f)return;const d={phase1:{duration:2500,startPos:{x:0,y:2.4,z:15},endPos:{x:0,y:2.4,z:12},startLookAt:{x:0,y:8,z:0},endLookAt:{x:0,y:8,z:0}},phase2:{duration:3e3,startPos:{x:0,y:2.4,z:12},endPos:{x:0,y:2.4,z:5},startLookAt:{x:0,y:8,z:0},endLookAt:{x:0,y:4,z:0}},phase3:{duration:2e3,startPos:{x:0,y:2.4,z:5},endPos:{x:0,y:2.4,z:0},startLookAt:{x:0,y:4,z:0},endLookAt:{x:0,y:2.4,z:-1}}};f.position.set(d.phase1.startPos.x,d.phase1.startPos.y,d.phase1.startPos.z),f.lookAt(d.phase1.startLookAt.x,d.phase1.startLookAt.y,d.phase1.startLookAt.z);let y=1,j=Date.now();const T=g=>{const ee=Date.now()-j,B=Math.min(ee/g.duration,1),N=B<.5?4*B*B*B:1-Math.pow(-2*B+2,3)/2;f.position.x=g.startPos.x+(g.endPos.x-g.startPos.x)*N,f.position.y=g.startPos.y+(g.endPos.y-g.startPos.y)*N,f.position.z=g.startPos.z+(g.endPos.z-g.startPos.z)*N;const ye={x:g.startLookAt.x+(g.endLookAt.x-g.startLookAt.x)*N,y:g.startLookAt.y+(g.endLookAt.y-g.startLookAt.y)*N,z:g.startLookAt.z+(g.endLookAt.z-g.startLookAt.z)*N};return f.lookAt(ye.x,ye.y,ye.z),B>=1},A=()=>{let g=!1;switch(y){case 1:g=T(d.phase1),g&&(y=2,j=Date.now());break;case 2:g=T(d.phase2),g&&(y=3,j=Date.now());break;case 3:if(g=T(d.phase3),g){h(!0),e(!1),setTimeout(()=>{p(!0)},9e3),$.current&&($.current.getObject().position.copy(f.position),$.current.connect=$.current.connect.__original||$.current.connect);return}break}et.current=requestAnimationFrame(A)};A()};return(async()=>{try{if(re.current||le.current)return;const f=new ni;tt.current=f;let d=!1;const y=async()=>{try{const o=[],r=[];se.slice(0,12).forEach(s=>{let P;s.id==="gallery_lightbox"?P=s.src.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,""):P=s.id.replace(/_/g,"-"),s.type==="video"?r.push({id:s.id,fileName:P,src:s.src}):o.push({id:s.id,fileName:P})}),console.log("ğŸ¨ å¼€å§‹é¢„åŠ è½½Galleryçº¹ç†...",{images:o.length,videos:r.length});const c=await ze.loadSceneTextures("gallery",{images:o.map(s=>s.fileName),videos:r.map(s=>({name:s.fileName,src:s.src})),folder:"gallery",onProgress:(s,P,D)=>{console.log(`ğŸ“¦ Galleryçº¹ç†åŠ è½½è¿›åº¦: ${P}/${D} (${Math.round(s*100)}%)`)}}),w=new Map,a=new Map;o.forEach(({id:s,fileName:P})=>{c.textures.has(P)&&w.set(s,c.textures.get(P))}),r.forEach(({id:s,fileName:P})=>{c.videos.has(P)&&a.set(s,c.videos.get(P))}),ue.current={textures:w,videos:a,errors:c.errors},console.log(`âœ… Galleryçº¹ç†é¢„åŠ è½½å®Œæˆ: ${c.textures.size}å¼ å›¾ç‰‡, ${c.videos.size}ä¸ªè§†é¢‘`),c.errors.length>0&&console.warn("âš ï¸ éƒ¨åˆ†Galleryçº¹ç†åŠ è½½å¤±è´¥:",c.errors),d=!0,j&&d&&T()}catch(o){console.warn("Galleryçº¹ç†é¢„åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨fallback:",o),ue.current={textures:new Map,videos:new Map,errors:[]},d=!0,j&&T()}};let j=!1;const T=()=>{requestAnimationFrame(()=>{le.current&&re.current&&pe.current?(le.current.render(re.current,pe.current),requestAnimationFrame(()=>{setTimeout(()=>{Ot()},300)})):setTimeout(()=>{Ot()},500)})};f.onLoad=()=>{console.log("ğŸ­ THREE.jsåœºæ™¯åŠ è½½å®Œæˆ"),j=!0,d&&T()},f.onError=()=>{},y();const A=new oi;A.background=new me(1710618),re.current=A;const g=new ai(75,C.clientWidth/C.clientHeight,.1,1e3);g.position.set(0,2.4,0),pe.current=g;const ee=new gt(16774374,6,15,Math.PI/5,.15,1.2);ee.position.set(0,0,0),ee.castShadow=!1;const B=new ri;ee.target=B,g.add(ee),A.add(B),A.add(g),He.current=ee;const N=new li({antialias:!0,alpha:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1});if(N.setSize(C.clientWidth,C.clientHeight),N.setClearColor(15790320,1),N.shadowMap.enabled=!0,N.shadowMap.type=ci,N.outputColorSpace=ct,N.toneMapping=hi,N.toneMappingExposure=1,!N.getContext())throw new Error("WebGL context creation failed");C.appendChild(N.domElement),le.current=N;let W;try{document&&document.body&&document.documentElement&&window.self===window.top&&"requestPointerLock"in document.body?W=new ht(g,document.body):(W=new ht(g,N.domElement),console.warn("Pointer Lock API not available, using fallback mode"))}catch(o){console.warn("PointerLockControls initialization failed:",o),W=new ht(g,N.domElement)}A.add(W.getObject()),$.current=W;try{W.addEventListener("lock",()=>{ne(!0)}),W.addEventListener("unlock",()=>{ne(!1)})}catch(o){console.warn("PointerLockControls event setup failed:",o)}try{const o=W.connect;o&&(W.connect.__original=o,W.connect=()=>{if(n)try{o.call(W)}catch(r){console.warn("PointerLockControls connect failed:",r)}})}catch(o){console.warn("PointerLockControls connect override failed:",o)}const G=o=>{const c=(()=>{const P=new de(12,12,.4),D=new dt({color:1710618,metalness:.9,roughness:.1,clearcoat:.5,clearcoatRoughness:.05,emissive:3355443,emissiveIntensity:.15}),V=new oe(P,D);V.position.set(0,3,35.8),o.add(V);const E=(()=>{const ie=new Xe(11,9),ce={useVideo:!0,videoPath:"/ui-test.mp4",imagePath:"/gallery/gallery-vertical-0.jpg"},Ee=se.find(S=>S.position==="lightbox"),qe=Ee?Ee.src||Ee.thumbnail:ce.imagePath;let Ye;ce.useVideo&&(Ye=new Ne({color:0,emissive:0,emissiveIntensity:0,transparent:!0,opacity:.95,side:st}));const he=new oe(ie,Ye);if(he.position.set(0,3,36-.4-.02),he.rotation.y=Math.PI,he.name="LightboxGallery",o.add(he),ce.useVideo){console.log(`ğŸ¬ Lightboxè§†é¢‘åŠ è½½: ${ce.videoPath}`);const S=document.createElement("video");S.src=ce.videoPath,S.crossOrigin="anonymous",S.loop=!0,S.muted=!0,S.autoplay=!0,S.playsInline=!0,S.preload="auto";const X=()=>{try{const q=new Kt(S);q.minFilter=nt,q.magFilter=nt,q.format=di,q.generateMipmaps=!1,q.flipY=!0,q.colorSpace=ct;const rt=new Ne({map:q,emissive:0,emissiveIntensity:0,transparent:!1,side:st});he.material.dispose(),he.material=rt,console.log("âœ… Lightboxè§†é¢‘çº¹ç†è®¾ç½®å®Œæˆ"),S.play().catch(Qt=>{console.warn("Lightboxè§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥:",Qt)})}catch(q){console.warn("Lightboxè§†é¢‘çº¹ç†åˆ›å»ºå¤±è´¥:",q)}};S.addEventListener("loadeddata",X),S.addEventListener("canplay",X),S.addEventListener("loadedmetadata",()=>{S.play().catch(()=>{console.warn("Lightboxè§†é¢‘å…ƒæ•°æ®åŠ è½½åæ’­æ”¾å¤±è´¥")})}),S.addEventListener("error",q=>{console.warn("Lightboxè§†é¢‘åŠ è½½é”™è¯¯:",q),L()}),S.load()}function L(){console.log(`ğŸ–¼ï¸ Lightboxå›¾ç‰‡åŠ è½½: ${qe}`);const S=qe.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,"");ze.loadTexture(S).then(X=>{const q=new Ne({map:X,emissive:0,emissiveIntensity:0,transparent:!0,opacity:.61,side:st});he.material.dispose(),he.material=q,console.log("âœ… Lightboxå›¾ç‰‡çº¹ç†è®¾ç½®å®Œæˆ")}).catch(()=>{console.warn("Lightboxå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œä¿æŒå ä½æè´¨")})}return{screen:he}})();return console.log("ğŸ–¼ï¸ Lightboxå±å¹•åˆ›å»ºå®Œæˆ",E),{lightBox:V,lightboxDisplay:E}})();return{wallLightBox:c.lightBox,lightboxDisplay:c.lightboxDisplay.screen,ledFrame:c.lightboxDisplay.frame}},U=()=>{const o=[];return[{start:{x:-3,z:2.25},end:{x:3,z:2.25},name:"ç‹-ä¸Šæ¨ª"},{start:{x:-2.5,z:0},end:{x:2.5,z:0},name:"ç‹-ä¸­æ¨ª"},{start:{x:-3.5,z:-2.25},end:{x:3.5,z:-2.25},name:"ç‹-ä¸‹æ¨ª"},{start:{x:0,z:2.25},end:{x:0,z:-2.25},name:"ç‹-ç«–çº¿"}].forEach(c=>{const w=Math.sqrt(Math.pow(c.end.x-c.start.x,2)+Math.pow(c.end.z-c.start.z,2));let a;c.name.includes("ç«–")?a=new de(.4,.2,w):a=new de(w,.2,.4);const s=new Je({color:16777215,emissive:16777215,emissiveIntensity:2,transparent:!1}),P=new oe(a,s),D=(c.start.x+c.end.x)/2,V=(c.start.z+c.end.z)/2;P.position.set(D,6,V),A.add(P);const O=new Yt(16777215,7,45);O.position.set(D,5.5,V),A.add(O),o.push({tube:P,name:c.name})}),o},Ce=G(A);console.log("ğŸ¨ è‰ºæœ¯å…ƒç´ åˆ›å»ºå®Œæˆ:",Ce),U(),fe(A),H(A,f);const v=()=>{try{const o={intensity:4,colors:[16739179,5164484,4569041,16370212],showHelpers:!1,enableAnimation:!0,animationSpeed:8e-4,lightWidth:8,lightHeight:6,positions:[{x:-30,y:10,z:0,rx:0,ry:Math.PI/2,rz:0},{x:30,y:10,z:0,rx:0,ry:-Math.PI/2,rz:0},{x:0,y:11.5,z:30,rx:-Math.PI/3,ry:0,rz:0},{x:0,y:11.5,z:-10,rx:-Math.PI/3,ry:Math.PI,rz:0}]};be.current=new pi(A,o),be.current.setPreset("soft"),console.log("RectAreaLightingç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ")}catch(o){console.warn("RectAreaLightingåˆå§‹åŒ–å¤±è´¥:",o)}},u=async()=>{try{const o={cubeSize:2.5,cubeCount:3,spacing:10,height:6,intensity:2.5,lightSize:2,enableAnimation:!0,animationSpeed:.001,showCubeMesh:!0,cubeOpacity:.05,showHelpers:!1};ve.current=new fi(A,o,se),await ve.current.init(),console.log("å…‰æŸ±ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ")}catch(o){console.warn("å…‰æŸ±ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:",o)}},x=()=>{try{const o={lightCount:3,intensity:4200,distance:80,angle:Math.PI/1.8,penumbra:.4,enableAnimation:!0,animationSpeed:.3,showHelpers:!1};Pe.current=new yi(A,N,o),console.log("âœ¨ 3ç¯ä½IESèšå…‰ç¯ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ - é¿å¼€lightboxå¢™é¢")}catch(o){console.warn("âš ï¸ IESèšå…‰ç¯ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:",o)}};setTimeout(()=>{v(),setTimeout(async()=>{await u(),setTimeout(()=>{x()},200)},100)},300);const b=()=>{Le.current=requestAnimationFrame(b);const o=Qe.current.getDelta();W.isLocked&&Ie(o,W),A.traverse(r=>{r.material&&r.material.map&&r.material.map.isVideoTexture&&(r.material.map.needsUpdate=!0)}),N.render(A,g)};b(),e(!1)}catch(f){throw e(!1),f}})().catch(f=>{console.error("Galleryåœºæ™¯åˆå§‹åŒ–å¤±è´¥:",f),e(!1)}),()=>{var f;(f=$.current)!=null&&f.isLocked&&(console.log("ğŸ”“ Galleryç»„ä»¶å¸è½½æ—¶å¼ºåˆ¶è§£é”æŒ‡é’ˆ"),$.current.unlock()),ne(!1),be.current&&(be.current.dispose(),be.current=null,console.log(" ğŸ§¹ RectAreaLightingç³»ç»Ÿå·²æ¸…ç†")),ve.current&&(ve.current.dispose(),ve.current=null,console.log(" ğŸ›ï¸ å‘å…‰åœ†æŸ±ä½“ç³»ç»Ÿå·²æ¸…ç†")),Pe.current&&(Pe.current.dispose(),Pe.current=null,console.log(" ğŸ§¹ IESèšå…‰ç¯ç³»ç»Ÿå·²æ¸…ç†")),Le.current&&(cancelAnimationFrame(Le.current),Le.current=null),$.current&&($.current.isLocked&&$.current.unlock(),$.current.dispose(),$.current=null,console.log(" ğŸ® Galleryæ§åˆ¶å™¨å·²æ¸…ç†")),re.current&&(re.current.traverse(d=>{d.geometry&&d.geometry.dispose(),d.material&&(Array.isArray(d.material)?d.material.forEach(y=>{y.map&&y.map.dispose(),y.normalMap&&y.normalMap.dispose(),y.roughnessMap&&y.roughnessMap.dispose(),y.dispose()}):(d.material.map&&d.material.map.dispose(),d.material.normalMap&&d.material.normalMap.dispose(),d.material.roughnessMap&&d.material.roughnessMap.dispose(),d.material.dispose()))}),re.current.clear(),re.current=null),le.current&&(C&&C.contains(le.current.domElement)&&C.removeChild(le.current.domElement),le.current.dispose(),le.current=null),pe.current=null,Re.current=null,console.log("ğŸ§¹ Gallery ç»„ä»¶æ¸…ç†å®Œæˆ")}},[se,n,ne]),M.useEffect(()=>{const C=()=>{var H;!(document.pointerLockElement!==null)&&((H=$.current)!=null&&H.isLocked)&&(console.log("ğŸ”“ æ£€æµ‹åˆ°æŒ‡é’ˆé”å®šçŠ¶æ€ä¸ä¸€è‡´ï¼Œå¼ºåˆ¶åŒæ­¥çŠ¶æ€"),$.current&&($.current.disconnect(),setTimeout(()=>{$.current&&$.current.connect()},100)),ne(!1))};return document.addEventListener("pointerlockchange",C),document.addEventListener("pointerlockerror",C),()=>{document.removeEventListener("pointerlockchange",C),document.removeEventListener("pointerlockerror",C)}},[ne]),M.useEffect(()=>{const C=H=>{var Ae,Ve;if((Ae=$.current)!=null&&Ae.isLocked&&!["KeyW","KeyA","KeyS","KeyD","Escape"].includes(H.code)&&H.key!=="Escape"){H.preventDefault(),H.stopPropagation(),console.log("ğŸ”’ ç”»å»Šå¯¼èˆªæ¨¡å¼ï¼šåªå…è®¸WASDç§»åŠ¨å’ŒESCé€€å‡º");return}const Ie=H.code==="KeyW"?"w":H.code==="KeyA"?"a":H.code==="KeyS"?"s":H.code==="KeyD"?"d":H.key.toLowerCase();Ie in Y.current&&(Y.current[Ie]=!0),H.key==="Escape"&&((Ve=$.current)!=null&&Ve.isLocked)&&(console.log("ğŸ”“ ESCé”®è§£é”æŒ‡é’ˆ"),$.current.unlock())},fe=H=>{var Ae;if((Ae=$.current)!=null&&Ae.isLocked&&!["KeyW","KeyA","KeyS","KeyD"].includes(H.code)){H.preventDefault(),H.stopPropagation();return}const Ie=H.code==="KeyW"?"w":H.code==="KeyA"?"a":H.code==="KeyS"?"s":H.code==="KeyD"?"d":H.key;Ie in Y.current&&(Y.current[Ie]=!1)};return document.addEventListener("keydown",C),document.addEventListener("keyup",fe),()=>{document.removeEventListener("keydown",C),document.removeEventListener("keyup",fe)}},[]),i.jsxs(i.Fragment,{children:[I&&F&&i.jsx("div",{className:"fixed inset-0 z-[99999] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4",children:i.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center max-w-md border border-white/20",children:[i.jsxs("div",{className:"mb-6",children:[i.jsx("svg",{className:"w-16 h-16 text-yellow-400 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})}),i.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:((Oe=(Be=(Fe=(Ge=J[l])==null?void 0:Ge.gallery)==null?void 0:Fe.mobile)==null?void 0:Be.mobileNotice)==null?void 0:Oe.title)||(l==="zh"?"ç§»åŠ¨ç«¯ä½“éªŒæç¤º":"Mobile Experience Notice")}),i.jsx("p",{className:"text-white/80 leading-relaxed",children:((k=(Ue=(Ke=(_e=J[l])==null?void 0:_e.gallery)==null?void 0:Ke.mobile)==null?void 0:Ue.mobileNotice)==null?void 0:k.description)||(l==="zh"?"3D ç”»å»Šé‡‡ç”¨ç¬¬ä¸€äººç§°æ¼«æ¸¸æŠ€æœ¯ï¼Œéœ€è¦é”®ç›˜å’Œé¼ æ ‡æ“ä½œï¼Œç§»åŠ¨ç«¯ä½“éªŒå¯èƒ½ä¸ä½³ã€‚å»ºè®®ä½¿ç”¨æ¡Œé¢è®¾å¤‡ä»¥è·å¾—æœ€ä½³æµè§ˆæ•ˆæœã€‚":"The 3D gallery uses first-person navigation technology requiring keyboard and mouse controls. For the best experience, Hua recommend using a desktop device.")})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("button",{onClick:()=>{ge(!1),ke(!0)},className:"w-full bg-theme-primary/20 hover:bg-theme-primary/30 text-theme-primary border border-theme-primary/30 hover:border-theme-primary/50 py-3 px-6 rounded-lg transition-all duration-300",children:((Q=(K=(z=(_=J[l])==null?void 0:_.gallery)==null?void 0:z.mobile)==null?void 0:K.mobileNotice)==null?void 0:Q.viewGallery)||(l==="zh"?"ç»§ç»­æµè§ˆå›¾ç‰‡é›†":"View Image Gallery")}),i.jsx("p",{className:"text-white/60 text-sm",children:((ut=(it=(at=(je=J[l])==null?void 0:je.gallery)==null?void 0:at.mobile)==null?void 0:it.mobileNotice)==null?void 0:ut.desktopHint)||(l==="zh"?"æˆ–åœ¨æ¡Œé¢è®¾å¤‡ä¸Šä½“éªŒå®Œæ•´çš„ 3D ç”»å»Š":"Or visit on desktop for the full 3D gallery experience")})]})]})}),I&&te&&i.jsx(Zt,{language:l}),!I&&i.jsxs("section",{id:"gallery",className:"min-h-screen flex flex-col justify-center items-center bg-gray-100 relative overflow-hidden",children:[(t||!n)&&i.jsx(Xt,{size:160,strokeWidth:12,showMask:!0,maskColor:"black-solid"}),i.jsx("div",{ref:we,className:`w-full h-screen relative bg-gray-200 ${t||!n?"invisible":"visible"}`,style:{minHeight:"100vh"}}),i.jsxs("div",{className:`absolute bottom-6 left-6 bg-black/50 backdrop-blur-md rounded-xl p-4 text-white z-20 max-w-sm transition-all duration-1000 ${!t&&n&&m&&!ae?"opacity-100 translate-y-0":"opacity-0 translate-y-4 pointer-events-none"}`,children:[i.jsx("p",{className:"text-lg font-medium mb-3",children:((xt=(yt=(ft=(pt=J[l])==null?void 0:pt.gallery)==null?void 0:ft.gallery3D)==null?void 0:yt.instructions)==null?void 0:xt.howToPlay)||(l==="zh"?"å¦‚ä½•æ“ä½œï¼Ÿ":"How to Play?")}),i.jsxs("div",{className:"space-y-3 text-sm",children:[i.jsxs("p",{className:"flex items-center",children:[i.jsx("span",{className:"w-2"}),((St=(vt=(bt=(wt=J[l])==null?void 0:wt.gallery)==null?void 0:bt.gallery3D)==null?void 0:vt.instructions)==null?void 0:St.clickToEnter)||(l==="zh"?"ç‚¹å‡»è¿›å…¥é•¿å»Š":"Click to enter the gallery")]}),i.jsxs("p",{className:"flex items-center",children:[i.jsx("span",{className:"w-2"}),((Pt=(Lt=(Mt=(kt=J[l])==null?void 0:kt.gallery)==null?void 0:Mt.gallery3D)==null?void 0:Lt.instructions)==null?void 0:Pt.mouseControl)||(l==="zh"?"é¼ æ ‡ - ç¯è§†å‘¨å›´ï¼Œæ¢ç´¢ç”»ä½œ":"Mouse - Look around and explore")]}),i.jsxs("p",{className:"flex items-center",children:[i.jsx("span",{className:"w-2"}),i.jsxs("span",{className:"inline-flex items-center gap-1 mr-2",children:[i.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"W"}),i.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"A"}),i.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"S"}),i.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"D"})]}),i.jsx("span",{children:((jt=(zt=(At=(It=J[l])==null?void 0:It.gallery)==null?void 0:At.gallery3D)==null?void 0:zt.instructions)==null?void 0:jt.keyboardControl)||(l==="zh"?"ç§»åŠ¨ç©¿è¡Œé•¿å»Š":"Move through the gallery")})]}),i.jsxs("p",{className:"flex items-center",children:[i.jsx("span",{className:"w-2"}),i.jsx("span",{className:"inline-flex items-center px-2 py-0.5 mr-2 bg-white/20 rounded text-xs font-mono border border-white/30",children:"ESC"}),i.jsx("span",{children:(($t=(Nt=(Et=(Ct=J[l])==null?void 0:Ct.gallery)==null?void 0:Et.gallery3D)==null?void 0:Nt.instructions)==null?void 0:$t.escapeControl)||(l==="zh"?"é€€å‡ºæŒ‡é’ˆé”å®šæ¨¡å¼":"Exit pointer lock mode")})]})]})]}),i.jsx("div",{className:`absolute inset-0 flex items-center justify-center cursor-pointer z-10 transition-all duration-1000 ${!t&&n&&m&&!ae?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,onClick:()=>{var C;if(!t&&n&&m&&!ae)if((C=$.current)!=null&&C.lock)try{$.current.lock(),setTimeout(()=>{ae||(console.log("Fallback: manually setting pointer locked state"),ne(!0))},100)}catch(fe){console.log("Pointer lock failed, using fallback:",fe.message),ne(!0)}else ne(!0)},children:i.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center transition-all duration-300 border border-white/20 hover:bg-white/20 hover:scale-105",children:[i.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:((Tt=(Rt=(Wt=J[l])==null?void 0:Wt.gallery)==null?void 0:Rt.gallery3D)==null?void 0:Tt.title)||"æµ®ç”Ÿé•¿å»Š"}),i.jsx("p",{className:"text-white/80 mb-6",children:((Ft=(Gt=(Dt=(Ht=J[l])==null?void 0:Ht.gallery)==null?void 0:Dt.gallery3D)==null?void 0:Gt.instructions)==null?void 0:Ft.clickToStart)||"ç‚¹å‡»è¿›å…¥"}),i.jsx("div",{className:"animate-bounce",children:i.jsxs("svg",{className:"w-8 h-8 text-white mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})}),ae&&i.jsx(i.Fragment,{children:i.jsxs("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-20",children:[i.jsx("div",{className:"w-2 h-2 bg-white rounded-full shadow-lg border border-white/30"}),i.jsx("div",{className:"absolute w-6 h-0.5 bg-white/60 rounded shadow-sm"}),i.jsx("div",{className:"absolute w-0.5 h-6 bg-white/60 rounded shadow-sm"}),i.jsx("div",{className:"absolute w-8 h-8 border border-white/20 rounded-full"})]})})]})]})};Jt.propTypes={language:Se.string};const Mi=Object.freeze(Object.defineProperty({__proto__:null,default:Jt},Symbol.toStringTag,{value:"Module"}));export{Xt as C,Mi as G,gi as P,ui as u};
