import{r as y,j as e}from"./react-CWzj3BDS.js";import{P as _e}from"./vendor-Cvb3KN6q.js";import{J as at,K as st,S as nt,C as ot,b as rt,X as Te,Y as it,W as lt,Z as ct,r as Ce,_ as dt,$ as ht,f as mt,D as Ee,a0 as H,a1 as ge,M as C,P as re,T as Ge,v as ie,w as ye,g as Fe,a2 as He,q as Be,k as Oe,a3 as he,a4 as be,a5 as qe,L as Ke,j as Ue}from"./three-0lp-BYGx.js";import{u as le,b as ut}from"./index-CRvbLJQa.js";import{C as pt}from"./CircularLoadingIndicator-D3HatvoA.js";import"./leaflet-BD0kuunB.js";const $e=({language:M="zh"})=>{const q=le(L=>L.getAllGalleryItems()),{openPhotoSwipe:ne}=ut(),K=y.useRef(null),B=y.useMemo(()=>Array.isArray(q)?q:[],[q]).map((L,J)=>({id:L.id||J,src:L.src,thumbnail:L.thumbnail||L.src,title:L.title||"",description:L.description||""})),me=L=>{ne(B,L)};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        .gallery-mobile-container {
          min-height: 100vh;
          max-height: 100vh;
          overflow-y: auto;
          overflow-x: hidden;
          overscroll-behavior: none;
          
          /* iOS 安全区域支持 */
          padding-top: max(1rem, env(safe-area-inset-top));
          padding-bottom: max(1.5rem, env(safe-area-inset-bottom));
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
          
          /* 确保在iOS上平滑滚动 */
          -webkit-overflow-scrolling: touch;
          
          /* 防止选择文本 */
          -webkit-user-select: none;
          user-select: none;
          
          /* 确保触摸滚动正常工作 */
          touch-action: pan-y;
        }
        
        /* 自定义滚动条样式 */
        .gallery-mobile-container::-webkit-scrollbar {
          width: 4px;
        }
        .gallery-mobile-container::-webkit-scrollbar-track {
          background: transparent;
        }
        .gallery-mobile-container::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.2);
          border-radius: 2px;
        }
        .gallery-mobile-container::-webkit-scrollbar-thumb:hover {
          background: rgba(255, 255, 255, 0.3);
        }
        
        /* 移动端特殊处理 */
        @media (max-width: 768px) {
          .gallery-mobile-container {
            /* 在移动设备上隐藏滚动条 */
            scrollbar-width: none;
            -ms-overflow-style: none;
          }
          
          .gallery-mobile-container::-webkit-scrollbar {
            display: none;
          }
          
          /* 确保图片点击区域可用 */
          .gallery-image-item {
            touch-action: manipulation;
          }
        }
      `}),e.jsxs("div",{ref:K,className:"gallery-mobile-container w-full",children:[e.jsxs("div",{className:"text-center mb-8 px-4",children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-theme-text-primary mb-4",children:M==="zh"?"作品集":"Gallery"}),e.jsx("p",{className:"text-theme-text-secondary max-w-2xl mx-auto leading-relaxed",children:M==="zh"?"记录生活中的美好瞬间，每一张照片都承载着独特的故事与回忆。":"Capturing beautiful moments in life, each photo carries unique stories and memories."}),e.jsx("p",{className:"text-theme-text-secondary/60 text-sm mt-2",children:M==="zh"?"点击图片查看大图":"Tap images to view full size"})]}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[e.jsx("div",{className:"grid grid-cols-3 gap-2 sm:gap-3 md:gap-4 pb-8",children:B.map((L,J)=>e.jsx("div",{onClick:()=>me(J),className:"group project-card cursor-pointer transform transition-all duration-300 active:scale-95",children:e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-theme-surface/10",children:[e.jsx("img",{src:L.thumbnail||L.src,alt:`Gallery item ${J+1}`,className:"w-full h-full object-cover",loading:"lazy",onError:ue=>{ue.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjMzMzIj48L3JlY3Q+PC9zdmc+"}}),e.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-active:opacity-100 transition-opacity duration-200 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-white rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})}),e.jsx("div",{className:"absolute top-2 right-2 bg-black/50 backdrop-blur-sm rounded-full w-6 h-6 flex items-center justify-center text-white text-xs font-medium",children:J+1})]})},L.id))}),B.length===0&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-theme-surface/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-theme-text-secondary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("div",{className:"text-theme-text-secondary text-lg mb-2",children:M==="zh"?"暂无图片内容":"No gallery items available"}),e.jsx("div",{className:"text-theme-text-secondary/60 text-sm",children:M==="zh"?"请稍后再试":"Please try again later"})]}),B.length>0&&e.jsx("div",{className:"text-center mt-8 py-6",children:e.jsx("p",{className:"text-theme-text-secondary/60 text-sm",children:M==="zh"?`共 ${B.length} 张图片 • 点击查看大图`:`${B.length} images • Tap to view full size`})})]})]})]})};$e.propTypes={language:_e.string};const ft=({language:M="en"})=>{var Se,je,We,Ie,Ne,Ae,Re;const[q,ne]=y.useState(!0),[K,ve]=y.useState(!1),[B,me]=y.useState(!1),[L,J]=y.useState(!1),[ue,ke]=y.useState(!1),[Ze,Qe]=y.useState(!1),X=le(x=>x.getAllGalleryItems()),pe=le(x=>x.texts),oe=le(x=>x.isPointerLocked),ae=le(x=>x.setIsPointerLocked),E=y.useRef({w:!1,a:!1,s:!1,d:!1,ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1});y.useEffect(()=>{const x=()=>{const U=window.innerWidth<=768||"ontouchstart"in window;J(U),U&&ke(!0)};return x(),window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)},[]);const fe=y.useRef(null),Y=y.useRef(null),Z=y.useRef(null),V=y.useRef(null),T=y.useRef(null),ce=y.useRef(null),Je=y.useRef(new at),Me=y.useRef(null),Pe=y.useRef([]),ze=y.useRef(null),Le=y.useRef([]),Xe=y.useRef(null),Ye=y.useRef(null);return y.useEffect(()=>{if(!fe.current)return;const x=fe.current,U=o=>{const t=new He;o.add(t),Me.current=t;const c=32,m=72,v=new re(c,m),u=(()=>{const d=document.createElement("canvas"),l=1024;d.width=l,d.height=l;const n=d.getContext("2d"),W="#e8e8e8",N=["#f0f0f0","#e0e0e0","#dcdcdc","#f5f5f5","#efefef"];n.fillStyle=W,n.fillRect(0,0,l,l);for(let F=0;F<2e3;F++){const z=Math.random()*l,b=Math.random()*l,A=Math.random()*8+2,D=Math.random()*.3+.1;n.globalAlpha=D,n.fillStyle=N[Math.floor(Math.random()*N.length)],n.beginPath(),n.arc(z,b,A,0,Math.PI*2),n.fill()}n.globalAlpha=.15,n.strokeStyle="#d0d0d0",n.lineWidth=1;for(let F=0;F<50;F++){const z=Math.random()*l,b=Math.random()*l,A=Math.random()*100+50,D=Math.random()*Math.PI*2;n.beginPath(),n.moveTo(z,b),n.lineTo(z+Math.cos(D)*A,b+Math.sin(D)*A),n.stroke()}const P=n.createRadialGradient(l/2,l/2,0,l/2,l/2,l/2);P.addColorStop(0,"rgba(255, 255, 255, 0.1)"),P.addColorStop(.5,"rgba(255, 255, 255, 0.05)"),P.addColorStop(1,"rgba(255, 255, 255, 0)"),n.globalAlpha=1,n.fillStyle=P,n.fillRect(0,0,l,l),n.globalAlpha=.08;for(let F=0;F<20;F++){const z=Math.random()*l,b=Math.random()*l,A=Math.random()*3+1;n.fillStyle="#00ffaa",n.beginPath(),n.arc(z,b,A,0,Math.PI*2),n.fill()}n.globalAlpha=1;const k=new Oe(d);return k.wrapS=he,k.wrapT=he,k.repeat.set(6,6),k})(),S=new ge({map:u,color:16777215,metalness:.1,roughness:.6,envMapIntensity:.8}),I=new C(v,S);I.rotation.x=-Math.PI/2,I.position.y=-2,I.receiveShadow=!0,o.add(I);const _=(()=>{const d=document.createElement("canvas"),l=1024;d.width=l,d.height=l;const n=d.getContext("2d");n.fillStyle="#f8f8f8",n.fillRect(0,0,l,l);const W=64,N=2;n.strokeStyle="#e0e0e0",n.lineWidth=N;for(let k=0;k<=l;k+=W)n.beginPath(),n.moveTo(k,0),n.lineTo(k,l),n.stroke();for(let k=0;k<=l;k+=W)n.beginPath(),n.moveTo(0,k),n.lineTo(l,k),n.stroke();const P=new Oe(d);return P.wrapS=he,P.wrapT=he,P.repeat.set(4,4),P})(),Q=new C(new re(c,m),new ie({map:_,color:16777215,transparent:!1,side:Be}));Q.rotation.x=Math.PI/2,Q.position.y=8,Q.receiveShadow=!0,o.add(Q);const j=new ie({color:16316664,side:ye,transparent:!1}),w=32,$=72,a=12,s=.5,r=new C(new H(w,a,s),j);r.position.set(0,3,-36),r.receiveShadow=!0,r.castShadow=!1,t.add(r),o.add(r);const h=new C(new H(10,a,s),j);h.position.set(-11,3,36),h.receiveShadow=!0,h.castShadow=!1,t.add(h),o.add(h);const p=new C(new H(10,a,s),j);p.position.set(11,3,36),p.receiveShadow=!0,p.castShadow=!1,t.add(p),o.add(p);const g=new C(new H(s,a,$),j);g.position.set(-16,3,0),g.receiveShadow=!0,g.castShadow=!1,t.add(g),o.add(g);const i=new C(new H(s,a,$),j);i.position.set(16,3,0),i.receiveShadow=!0,i.castShadow=!1,t.add(i),o.add(i)},R=(o,t=null)=>{if(!X||X.length===0){for(let a=0;a<6;a++){const s=new re(3,2),r=new ie({color:6710886}),h=new C(s,r);a<3?(h.position.set(-6+a*6,3,-14.9),h.rotation.y=0):(h.position.set(-14.9,3,-6+(a-3)*6),h.rotation.y=Math.PI/2),o.add(h)}return}const c=Math.min(X.length,22),m=2.2,v=4,f=async()=>{const a=[];for(let s=0;s<Math.min(X.length,c);s++){const r=X[s];if(r.src||r.thumbnail)try{const h=await I(r.src||r.thumbnail),p=h.width/h.height;a.push({index:s,item:r,aspectRatio:p,isPortrait:p<.8,isLandscape:p>1.3,isSquare:p>=.8&&p<=1.3})}catch{a.push({index:s,item:r,aspectRatio:1,isPortrait:!1,isLandscape:!1,isSquare:!0})}}return a},u=a=>{const s={backWall:[],rightWall:[],leftWall:[],frontWall:[]},r=a.filter(d=>d.item.position!=="lightbox"),h=r.filter(d=>d.item.wall==="vertical_wall_32m"),p=r.filter(d=>d.item.wall==="horizontal_wall_64m"),g=p.filter(d=>d.item.layer==="upper"),i=p.filter(d=>d.item.layer==="lower");return s.backWall=h.slice(0,3),s.frontWall=h.slice(3,5),s.rightWall=[...g.slice(0,4),...i.slice(0,4)],s.leftWall=[...g.slice(4,8),...i.slice(4,8)],s},S=async()=>{const a=await f(),s=u(a),r=new Ge(t||void 0),h=new Map,p=async(i,d,l)=>{const n=i.item,W=i.aspectRatio;let N,P;W>1.5?(N=Math.min(v,m*W*.8),P=N/W):W<.7?(P=m,N=P*W):(P=m*.9,N=P*W);const k=new re(N,P),F=new qe({color:16777215,metalness:0,roughness:.15,clearcoat:.1,clearcoatRoughness:.1,reflectivity:.3,emissive:1052688,emissiveIntensity:.02,side:Be}),z=new C(k,F),b=$(z,N,P),A=35.5;switch(d){case"backWall":b.position.set(-10+l*10,2.4,-35.5),b.rotation.y=0;break;case"rightWall":{const{x:se,y:O,z:te}=G(i.item,s.rightWall);b.position.set(se,O,te),b.rotation.y=-Math.PI/2;break}case"leftWall":{const{x:se,y:O,z:te}=_(i.item,s.leftWall);b.position.set(se,O,te),b.rotation.y=Math.PI/2;break}case"frontWall":l===0?b.position.set(-10,2.4,A):b.position.set(10,2.4,A),b.rotation.y=Math.PI;break}b.castShadow=!1,b.receiveShadow=!1,o.add(b),Le.current.push({mesh:b,position:b.position.clone(),painting:z}),setTimeout(()=>{Q(b)},100);const D=n.src||n.thumbnail;if(h.has(D))z.material.map=h.get(D),z.material.color.setHex(16777215),z.material.needsUpdate=!0;else try{await(te=>new Promise((xe,tt)=>{const we=new Image;we.onload=()=>xe(!0),we.onerror=()=>tt(!1),we.src=te}))(D);const O=await new Promise((te,xe)=>{r.load(D,te,void 0,xe)});O.generateMipmaps=!1,O.minFilter=Ke,O.magFilter=Ke,O.colorSpace=Ce,h.set(D,O),z.material.map=O,z.material.color.setHex(16777215),z.material.needsUpdate=!0}catch{z.material.color.setHex(6710886),z.material.needsUpdate=!0}},g=[...s.backWall.map((i,d)=>({data:i,wallType:"backWall",index:d})),...s.rightWall.map((i,d)=>({data:i,wallType:"rightWall",index:d})),...s.leftWall.map((i,d)=>({data:i,wallType:"leftWall",index:d})),...s.frontWall.map((i,d)=>({data:i,wallType:"frontWall",index:d}))];for(let i=0;i<g.length;i+=4){const d=g.slice(i,i+4);await Promise.all(d.map(({data:l,wallType:n,index:W})=>p(l,n,W))),i+4<g.length&&await new Promise(l=>setTimeout(l,100))}},I=a=>new Promise(s=>{const r=new Image;r.onload=()=>{s({width:r.width,height:r.height})},r.onerror=()=>{s({width:300,height:200})},r.src=a}),G=(a,s)=>{const i=[-28,-12,4,20],d=[-20,-4,12,28];if(a.layer==="upper"){const l=s.filter(n=>n.item.layer==="upper").findIndex(n=>n.item.id===a.id);return{x:15.5,y:1.6+1.6,z:d[l]||0}}else{const l=s.filter(n=>n.item.layer==="lower").findIndex(n=>n.item.id===a.id);return{x:15.5,y:1.6,z:i[l]||0}}},_=(a,s)=>{const h=G(a,s);return{x:-15.5,y:h.y,z:-h.z}},Q=a=>{const s=new Te(16775393,1.5,15,Math.PI/6,.15,1),r=a.position,h=a.rotation;let p=new Ue;const g=Math.max(7,r.y+3.5),i=1.8;return Math.abs(h.y)<.1?p.set(r.x,g,r.z+i):Math.abs(h.y-Math.PI)<.1?p.set(r.x,g,r.z-i):Math.abs(h.y+Math.PI/2)<.1?p.set(r.x-i,g,r.z):Math.abs(h.y-Math.PI/2)<.1&&p.set(r.x+i,g,r.z),s.position.copy(p),s.target=a,s.castShadow=!1,s.userData={paintingPosition:r.clone(),baseIntensity:1,maxIntensity:8,activationDistance:6,optimalDistance:2},o.add(s),o.add(s.target),Pe.current.push(s),s},j=.05,w=.1,$=(a,s=2.5,r=2)=>{const h=new He,p=new qe({color:1710618,metalness:.8,roughness:.2,clearcoat:.3,clearcoatRoughness:.1,emissive:657930,emissiveIntensity:.05}),g=[new H(s+w*2,w,j),new H(s+w*2,w,j),new H(w,r,j),new H(w,r,j)],i=[{x:0,y:(r+w)/2,z:j/2},{x:0,y:-(r+w)/2,z:j/2},{x:-(s+w)/2,y:0,z:j/2},{x:(s+w)/2,y:0,z:j/2}];return g.forEach((d,l)=>{const n=new C(d,p);n.position.set(i[l].x,i[l].y,i[l].z),n.castShadow=!1,n.receiveShadow=!1,h.add(n)}),h.add(a),h};S()},ee=(o,t)=>{const c=6*o,m=V.current,v=m.position.clone();(E.current.w||E.current.ArrowUp)&&t.moveForward(c),(E.current.s||E.current.ArrowDown)&&t.moveForward(-c),(E.current.d||E.current.ArrowRight)&&t.moveRight(c),(E.current.a||E.current.ArrowLeft)&&t.moveRight(-c),de(m)&&m.position.copy(v),m.position.y=2.4,Ve(m.position)},de=o=>{const t=o.position,c=14.5,m=34.5;return t.x>c||t.x<-c||t.z>m||t.z<-m},Ve=o=>{Pe.current.forEach(t=>{const c=t.userData;if(!c||!c.paintingPosition)return;const m=o.distanceTo(c.paintingPosition);let v=c.baseIntensity;if(m<=c.activationDistance){const f=Math.max(0,(c.activationDistance-m)/c.activationDistance),u=c.maxIntensity-c.baseIntensity,S=Math.pow(f,1.5);v=c.baseIntensity+u*S,m<=c.optimalDistance&&(v=c.maxIntensity)}t.intensity=be.lerp(t.intensity,v,.12)}),et(o)},et=o=>{const t=ze.current;if(!t)return;let c=1/0;Le.current.forEach(v=>{const f=o.distanceTo(v.position);f<c&&(c=f)});const m=V.current;if(m){const v=new Ue;m.getWorldDirection(v);const f=m.position.clone().add(v.multiplyScalar(10));t.target.position.copy(f),t.target.updateMatrixWorld()}if(c<=6){const f=3+Math.max(0,(6-c)/6)*12;t.intensity=be.lerp(t.intensity,f,.1)}else t.intensity=be.lerp(t.intensity,1.5,.1)},De=()=>{const o=V.current;if(!o)return;const t={phase1:{duration:2500,startPos:{x:0,y:2.4,z:15},endPos:{x:0,y:2.4,z:12},startLookAt:{x:0,y:8,z:0},endLookAt:{x:0,y:8,z:0}},phase2:{duration:3e3,startPos:{x:0,y:2.4,z:12},endPos:{x:0,y:2.4,z:5},startLookAt:{x:0,y:8,z:0},endLookAt:{x:0,y:4,z:0}},phase3:{duration:2e3,startPos:{x:0,y:2.4,z:5},endPos:{x:0,y:2.4,z:0},startLookAt:{x:0,y:4,z:0},endLookAt:{x:0,y:2.4,z:-1}}};o.position.set(t.phase1.startPos.x,t.phase1.startPos.y,t.phase1.startPos.z),o.lookAt(t.phase1.startLookAt.x,t.phase1.startLookAt.y,t.phase1.startLookAt.z);let c=1,m=Date.now();const v=u=>{const S=Date.now()-m,I=Math.min(S/u.duration,1),G=I<.5?4*I*I*I:1-Math.pow(-2*I+2,3)/2;o.position.x=u.startPos.x+(u.endPos.x-u.startPos.x)*G,o.position.y=u.startPos.y+(u.endPos.y-u.startPos.y)*G,o.position.z=u.startPos.z+(u.endPos.z-u.startPos.z)*G;const _={x:u.startLookAt.x+(u.endLookAt.x-u.startLookAt.x)*G,y:u.startLookAt.y+(u.endLookAt.y-u.startLookAt.y)*G,z:u.startLookAt.z+(u.endLookAt.z-u.startLookAt.z)*G};return o.lookAt(_.x,_.y,_.z),I>=1},f=()=>{let u=!1;switch(c){case 1:u=v(t.phase1),u&&(c=2,m=Date.now());break;case 2:u=v(t.phase2),u&&(c=3,m=Date.now());break;case 3:if(u=v(t.phase3),u){ve(!0),ne(!1),setTimeout(()=>{me(!0)},9e3),T.current&&(T.current.getObject().position.copy(o.position),T.current.connect=T.current.connect.__original||T.current.connect);return}break}Xe.current=requestAnimationFrame(f)};f()};return(()=>{try{const o=new st;Ye.current=o,o.onLoad=()=>{requestAnimationFrame(()=>{Z.current&&Y.current&&V.current?(Z.current.render(Y.current,V.current),requestAnimationFrame(()=>{setTimeout(()=>{De()},300)})):setTimeout(()=>{De()},500)})},o.onError=()=>{};const t=new nt;t.background=new ot(1710618),Y.current=t;const c=new rt(75,x.clientWidth/x.clientHeight,.1,1e3);c.position.set(0,2.4,0),V.current=c;const m=new Te(16774374,6,15,Math.PI/5,.15,1.2);m.position.set(0,0,0),m.castShadow=!1;const v=new it;m.target=v,c.add(m),t.add(v),t.add(c),ze.current=m;const f=new lt({antialias:!0,alpha:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1});if(f.setSize(x.clientWidth,x.clientHeight),f.setClearColor(15790320,1),f.shadowMap.enabled=!0,f.shadowMap.type=ct,f.outputColorSpace=Ce,f.toneMapping=dt,f.toneMappingExposure=1,!f.getContext())throw new Error("WebGL context creation failed");x.appendChild(f.domElement),Z.current=f;const S=new ht(c,f.domElement);t.add(S.getObject()),T.current=S,S.addEventListener("lock",()=>{ae(!0)}),S.addEventListener("unlock",()=>{ae(!1)});const I=S.connect;S.connect.__original=I,S.connect=()=>{K&&I.call(S)};const G=w=>{const $=new mt(6316128,1.2);w.add($);const a=new Ee(16777215,.9);a.position.set(0,12,5),a.castShadow=!0,a.shadow.mapSize.width=1024,a.shadow.mapSize.height=1024,a.shadow.camera.near=.5,a.shadow.camera.far=25,a.shadow.camera.left=-25,a.shadow.camera.right=25,a.shadow.camera.top=25,a.shadow.camera.bottom=-25,w.add(a);const s=new Ee(16777215,.2);return s.position.set(-10,8,-10),w.add(s),[$,a,s]},_=w=>{const a=(()=>{const p=new H(12,12,.4),g=new ge({color:16777215,emissive:16777215,emissiveIntensity:2}),i=new C(p,g);i.position.set(0,3,35.8),w.add(i);const l=(()=>{const P=new re(11,9),k=X.find(D=>D.position==="lightbox"),F=k?k.src||k.thumbnail:"/gallery/gallery-vertical-0.jpg",z=new Ge,b=new ie({color:4474111,emissive:2236996,emissiveIntensity:.3,transparent:!1,opacity:1,side:ye}),A=new C(P,b);return A.position.set(0,3,36-.4-.02),A.rotation.y=Math.PI,A.name="LightboxGallery",w.add(A),z.load(F,D=>{const se=new ie({map:D,emissive:2236962,emissiveIntensity:.25,transparent:!1,opacity:1,side:ye});A.material=se},()=>{},()=>{}),A})();return[{pos:[0,3,36-.4-.8],intensity:1.8}].forEach(W=>{const N=new Fe(16777198,W.intensity,12);N.position.set(...W.pos),N.decay=1.8,w.add(N)}),{lightBox:i,lightboxDisplay:l}})();return{wallLightBox:a.lightBox,lightboxDisplay:a.lightboxDisplay}},Q=()=>{const w=[];return[{start:{x:-3,z:2.25},end:{x:3,z:2.25},name:"王-上横"},{start:{x:-2.5,z:0},end:{x:2.5,z:0},name:"王-中横"},{start:{x:-3.5,z:-2.25},end:{x:3.5,z:-2.25},name:"王-下横"},{start:{x:0,z:2.25},end:{x:0,z:-2.25},name:"王-竖线"}].forEach(a=>{const s=Math.sqrt(Math.pow(a.end.x-a.start.x,2)+Math.pow(a.end.z-a.start.z,2));let r;a.name.includes("竖")?r=new H(.4,.2,s):r=new H(s,.2,.4);const h=new ge({color:16777215,emissive:16777215,emissiveIntensity:2,transparent:!1}),p=new C(r,h),g=(a.start.x+a.end.x)/2,i=(a.start.z+a.end.z)/2;p.position.set(g,6,i),t.add(p);const d=new Fe(16777215,7,45);d.position.set(g,5.5,i),t.add(d),w.push({tube:p,name:a.name})}),w};G(t),_(t),Q(),U(t),R(t,o);const j=()=>{ce.current=requestAnimationFrame(j);const w=Je.current.getDelta();S.isLocked&&ee(w,S),f.render(t,c)};j(),ne(!1)}catch(o){throw ne(!1),o}})(),()=>{ce.current&&(cancelAnimationFrame(ce.current),ce.current=null),T.current&&(T.current.dispose(),T.current=null),Y.current&&(Y.current.traverse(o=>{o.geometry&&o.geometry.dispose(),o.material&&(Array.isArray(o.material)?o.material.forEach(t=>{t.map&&t.map.dispose(),t.normalMap&&t.normalMap.dispose(),t.roughnessMap&&t.roughnessMap.dispose(),t.dispose()}):(o.material.map&&o.material.map.dispose(),o.material.normalMap&&o.material.normalMap.dispose(),o.material.roughnessMap&&o.material.roughnessMap.dispose(),o.material.dispose()))}),Y.current.clear(),Y.current=null),Z.current&&(x&&x.contains(Z.current.domElement)&&x.removeChild(Z.current.domElement),Z.current.dispose(),Z.current=null),V.current=null,Me.current=null}},[X,K,ae]),y.useEffect(()=>{const x=R=>{var de;const ee=R.code==="KeyW"?"w":R.code==="KeyA"?"a":R.code==="KeyS"?"s":R.code==="KeyD"?"d":R.key.toLowerCase();ee in E.current&&(E.current[ee]=!0),R.key==="Escape"&&((de=T.current)!=null&&de.isLocked)&&T.current.unlock()},U=R=>{const ee=R.code==="KeyW"?"w":R.code==="KeyA"?"a":R.code==="KeyS"?"s":R.code==="KeyD"?"d":R.key;ee in E.current&&(E.current[ee]=!1)};return document.addEventListener("keydown",x),document.addEventListener("keyup",U),()=>{document.removeEventListener("keydown",x),document.removeEventListener("keyup",U)}},[]),e.jsxs(e.Fragment,{children:[L&&ue&&e.jsx("div",{className:"fixed inset-0 z-[99999] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center max-w-md border border-white/20",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("svg",{className:"w-16 h-16 text-yellow-400 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:M==="zh"?"移动端体验提示":"Mobile Experience Notice"}),e.jsx("p",{className:"text-white/80 leading-relaxed",children:M==="zh"?"3D 画廊采用第一人称漫游技术，需要键盘和鼠标操作，移动端体验可能不佳。建议使用桌面设备以获得最佳浏览效果。":"The 3D gallery uses first-person navigation technology requiring keyboard and mouse controls. For the best experience, Hua recommend using a desktop device."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{ke(!1),Qe(!0)},className:"w-full bg-theme-primary/20 hover:bg-theme-primary/30 text-theme-primary border border-theme-primary/30 hover:border-theme-primary/50 py-3 px-6 rounded-lg transition-all duration-300",children:M==="zh"?"继续浏览图片集":"View Image Gallery"}),e.jsx("p",{className:"text-white/60 text-sm",children:M==="zh"?"或在桌面设备上体验完整的 3D 画廊":"Or visit on desktop for the full 3D gallery experience"})]})]})}),L&&Ze&&e.jsx($e,{language:M,texts:pe}),!L&&e.jsxs("section",{id:"gallery",className:"min-h-screen flex flex-col justify-center items-center bg-gray-100 relative overflow-hidden",children:[(q||!K)&&e.jsx(pt,{size:160,strokeWidth:12,showMask:!0,maskColor:"black-solid"}),e.jsx("div",{ref:fe,className:`w-full h-screen relative bg-gray-200 ${q||!K?"invisible":"visible"}`,style:{minHeight:"100vh"}}),e.jsxs("div",{className:`absolute bottom-6 left-6 bg-black/50 backdrop-blur-md rounded-xl p-4 text-white z-20 max-w-sm transition-all duration-1000 ${!q&&K&&B&&!oe?"opacity-100 translate-y-0":"opacity-0 translate-y-4 pointer-events-none"}`,children:[e.jsx("p",{className:"text-lg font-medium mb-3",children:M==="zh"?"如何操作？":"How to Play?"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("p",{className:"flex items-center",children:[e.jsx("span",{className:"w-2"}),M==="zh"?"点击进入长廊":"Click to enter the gallery"]}),e.jsxs("p",{className:"flex items-center",children:[e.jsx("span",{className:"w-2"}),M==="zh"?"鼠标 - 环视周围，探索画作":"Mouse - Look around and explore"]}),e.jsxs("p",{className:"flex items-center",children:[e.jsx("span",{className:"w-2"}),e.jsxs("span",{className:"inline-flex items-center gap-1 mr-2",children:[e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"W"}),e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"A"}),e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"S"}),e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"D"})]}),e.jsx("span",{children:M==="zh"?"移动穿行长廊":"Move through the gallery"})]}),e.jsxs("p",{className:"flex items-center",children:[e.jsx("span",{className:"w-2"}),e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 mr-2 bg-white/20 rounded text-xs font-mono border border-white/30",children:"ESC"}),e.jsx("span",{children:M==="zh"?"退出指针锁定模式":"Exit pointer lock mode"})]})]})]}),e.jsx("div",{className:`absolute inset-0 flex items-center justify-center cursor-pointer z-10 transition-all duration-1000 ${!q&&K&&B&&!oe?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,onClick:()=>{var x;if(!q&&K&&B&&!oe)if((x=T.current)!=null&&x.lock)try{T.current.lock(),setTimeout(()=>{oe||(console.log("Fallback: manually setting pointer locked state"),ae(!0))},100)}catch(U){console.log("Pointer lock failed, using fallback:",U.message),ae(!0)}else ae(!0)},children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center transition-all duration-300 border border-white/20 hover:bg-white/20 hover:scale-105",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:((We=(je=(Se=pe[M])==null?void 0:Se.gallery)==null?void 0:je.gallery3D)==null?void 0:We.title)||"浮生长廊"}),e.jsx("p",{className:"text-white/80 mb-6",children:((Re=(Ae=(Ne=(Ie=pe[M])==null?void 0:Ie.gallery)==null?void 0:Ne.gallery3D)==null?void 0:Ae.instructions)==null?void 0:Re.clickToStart)||"点击进入"}),e.jsx("div",{className:"animate-bounce",children:e.jsxs("svg",{className:"w-8 h-8 text-white mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})}),oe&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-20",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full shadow-lg border border-white/30"}),e.jsx("div",{className:"absolute w-6 h-0.5 bg-white/60 rounded shadow-sm"}),e.jsx("div",{className:"absolute w-0.5 h-6 bg-white/60 rounded shadow-sm"}),e.jsx("div",{className:"absolute w-8 h-8 border border-white/20 rounded-full"})]})]})]})};ft.propTypes={language:_e.string};export{ft as default};
