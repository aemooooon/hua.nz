const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/three-Br820KFa.js","assets/vendor-RxfllKF0.js","assets/d3-BbFmVfHF.js","assets/vendor-DSulWsr7.css"])))=>i.map(i=>d[i]);
import{r as P,j as n}from"./react-N-_5-tx-.js";import{P as we}from"./vendor-RxfllKF0.js";import{C as Fe,R as ei,a as ti,b as Bt,c as ce,T as ii,d as ni,M as te,P as qt,D as Re,e as Te,f as Ae,S as Oe,g as Ve,L as si,h as oi,i as ai,O as ri,W as li,j as ci,k as _e,l as hi,m as Ke,B as le,n as Ue,o as Ne,p as Ie,F as De,V as Ot,q as Ge,r as di,G as _t,s as Kt,t as qe,u as Ut}from"./three-Br820KFa.js";import{u as ze,_ as mi}from"./about-D1qgbc-3.js";import{t as ke}from"./texture-system-B6vC1v2q.js";const gi=P.createContext(),ui=()=>{const d=P.useContext(gi);if(!d)throw new Error("usePhotoSwipe must be used within a PhotoSwipeProvider");return d},Vt=({size:d=120,strokeWidth:e=8,showMask:t=!0,maskColor:s="black-glass",className:h="",onMaskClick:g=null})=>{const f=(d-e)/2,K=2*Math.PI*f,J=0,he=()=>{switch(s){case"black-solid":return"absolute inset-0 bg-black";case"black-glass":return"absolute inset-0 bg-black/80 backdrop-blur-sm";case"default":default:return"absolute inset-0 bg-black/40 backdrop-blur-lg backdrop-saturate-150"}},ie=({className:pe=""})=>n.jsxs("div",{className:`relative ${pe}`,style:{width:d,height:d,overflow:"visible"},children:[n.jsx("div",{className:"absolute pointer-events-none",style:{width:d+80,height:d+80,top:-40,left:-40,borderRadius:"50%",background:`radial-gradient(circle, 
                            transparent 60%, 
                            rgba(var(--theme-primary-rgb), 0.25) 75%, 
                            rgba(var(--theme-primary-rgb), 0.15) 85%, 
                            rgba(var(--theme-primary-rgb), 0.08) 92%, 
                            transparent 100%
                        )`,boxShadow:`
                            0 0 ${Math.max(d*.1,15)}px rgba(var(--theme-primary-rgb), 0.4),
                            0 0 ${Math.max(d*.2,25)}px rgba(var(--theme-primary-rgb), 0.2),
                            inset 0 0 ${Math.max(d*.05,6)}px rgba(var(--theme-primary-rgb), 0.15)
                        `,animation:"breathing-glow 3s ease-in-out infinite",zIndex:2}}),n.jsx("div",{className:"absolute",style:{width:d,height:d,borderRadius:"50%",boxShadow:`
                            0 0 ${Math.max(d*.03,4)}px var(--theme-primary),
                            0 0 ${Math.max(d*.06,8)}px rgba(var(--theme-primary-rgb), 0.6),
                            0 0 ${Math.max(d*.09,12)}px rgba(var(--theme-primary-rgb), 0.4),
                            inset 0 0 ${Math.max(d*.02,3)}px rgba(var(--theme-primary-rgb), 0.2)
                        `,animation:"avatar-glow 3s ease-in-out infinite",zIndex:9}}),n.jsxs("svg",{width:d,height:d,className:"transform -rotate-90 relative",style:{zIndex:10},children:[n.jsx("circle",{cx:d/2,cy:d/2,r:f,fill:"none",stroke:"rgba(255, 255, 255, 0.2)",strokeWidth:e}),n.jsx("circle",{cx:d/2,cy:d/2,r:f,fill:"none",stroke:"var(--theme-primary)",strokeWidth:e,strokeLinecap:"round",strokeDasharray:K,strokeDashoffset:J,className:"transition-all duration-300 ease-out",style:{transformOrigin:"center"}})]}),n.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",style:{zIndex:20},children:n.jsx("span",{className:"text-white/90 text-lg font-medium drop-shadow-md",children:"Loading..."})})]});return t?n.jsxs("div",{className:`fixed inset-0 z-50 flex items-center justify-center ${h}`,onClick:g,style:{overflow:"visible"},children:[n.jsx("div",{className:he()}),n.jsx("div",{className:"relative z-10",children:n.jsx(ie,{})})]}):n.jsx(ie,{className:h})};Vt.propTypes={size:we.number,strokeWidth:we.number,showMask:we.bool,maskColor:we.oneOf(["black-glass","black-solid","default"]),className:we.string,onMaskClick:we.func};const Yt=({language:d="zh"})=>{var ie,pe,Q,Y,ne,ee,be,U,fe,se,oe,de;const e=ze(m=>m.getAllGalleryItems()),t=ze(m=>m.texts),{openPhotoSwipe:s}=ui(),h=P.useRef(null),[g,f]=P.useState(new Map),C=P.useMemo(()=>Array.isArray(e)?e.filter(m=>m.type!=="video"):[],[e]),K=async m=>{try{if(!m||m.match(/\.(mp4|webm|mov|avi|mkv)$/i)||!m.match(/\.(jpg|jpeg|png|webp|avif)$/i))return m;const q=m.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,"");return await ke.getOptimalPath(q,"gallery")}catch(q){return console.warn("ç§»åŠ¨ç«¯å›¾ç‰‡æ ¼å¼ä¼˜åŒ–å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹è·¯å¾„:",q),m}};P.useEffect(()=>{(async()=>{if(C.length===0)return;const q=new Map;for(const N of C)if(N.src&&!g.has(N.id)){const ye=await K(N.src),Me=N.thumbnail?await K(N.thumbnail):ye;q.set(N.id,{src:ye,thumbnail:Me})}q.size>0&&f(N=>new Map([...N,...q]))})()},[C,g]);const J=C.map((m,q)=>{const N=g.get(m.id);return{id:m.id||q,src:(N==null?void 0:N.src)||m.src,thumbnail:(N==null?void 0:N.thumbnail)||m.thumbnail||m.src,title:m.title||"",description:m.description||""}}),he=m=>{s(J,m)};return n.jsxs(n.Fragment,{children:[n.jsx("style",{children:`
        .gallery-mobile-container {
          min-height: 100vh;
          max-height: 100vh;
          overflow-y: auto;
          overflow-x: hidden;
          overscroll-behavior: none;
          
          /* iOS å®‰å…¨åŒºåŸŸæ”¯æŒ - ä¼˜åŒ–ç§»åŠ¨ç«¯å¸ƒå±€ */
          padding-top: max(1rem, env(safe-area-inset-top));
          padding-bottom: max(2rem, env(safe-area-inset-bottom));
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
          
          /* ç¡®ä¿åœ¨iOSä¸Šå¹³æ»‘æ»šåŠ¨ */
          -webkit-overflow-scrolling: touch;
          
          /* é˜²æ­¢é€‰æ‹©æ–‡æœ¬ */
          -webkit-user-select: none;
          user-select: none;
          
          /* ç¡®ä¿è§¦æ‘¸æ»šåŠ¨æ­£å¸¸å·¥ä½œ */
          touch-action: pan-y;
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        .gallery-mobile-container::-webkit-scrollbar {
          width: 4px;
        }
        .gallery-mobile-container::-webkit-scrollbar-track {
          background: transparent;
        }
        .gallery-mobile-container::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.2);
          border-radius: 2px;
        }
        .gallery-mobile-container::-webkit-scrollbar-thumb:hover {
          background: rgba(255, 255, 255, 0.3);
        }
        
        /* ç§»åŠ¨ç«¯ç‰¹æ®Šå¤„ç† */
        @media (max-width: 768px) {
          .gallery-mobile-container {
            /* åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šéšè—æ»šåŠ¨æ¡ */
            scrollbar-width: none;
            -ms-overflow-style: none;
          }
          
          .gallery-mobile-container::-webkit-scrollbar {
            display: none;
          }
          
          /* ç¡®ä¿å›¾ç‰‡ç‚¹å‡»åŒºåŸŸå¯ç”¨ */
          .gallery-image-item {
            touch-action: manipulation;
          }
        }
      `}),n.jsxs("div",{ref:h,className:"gallery-mobile-container w-full",children:[n.jsxs("div",{className:"text-center mb-8 px-4",children:[n.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-theme-text-primary mb-4",children:((Q=(pe=(ie=t[d])==null?void 0:ie.gallery)==null?void 0:pe.mobile)==null?void 0:Q.title)||(d==="zh"?"ä½œå“é›†":"Gallery")}),n.jsx("p",{className:"text-theme-text-secondary max-w-2xl mx-auto leading-relaxed",children:((ee=(ne=(Y=t[d])==null?void 0:Y.gallery)==null?void 0:ne.mobile)==null?void 0:ee.subtitle)||(d==="zh"?"è®°å½•ç”Ÿæ´»ä¸­çš„ç¾å¥½ç¬é—´ï¼Œæ¯ä¸€å¼ ç…§ç‰‡éƒ½æ‰¿è½½ç€ç‹¬ç‰¹çš„æ•…äº‹ä¸å›å¿†ã€‚":"Each photo carries unique stories.")})]}),n.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[n.jsx("div",{className:"grid grid-cols-3 gap-2 sm:gap-3 md:gap-4 pb-16",children:J.map((m,q)=>{const N=g.get(m.id),ye=(N==null?void 0:N.thumbnail)||(N==null?void 0:N.src);return n.jsx("div",{onClick:()=>he(q),className:"group project-card cursor-pointer transform transition-all duration-300 active:scale-95",children:n.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-theme-surface/10",children:[ye?n.jsx("img",{src:ye,alt:`Gallery item ${q+1}`,className:"w-full h-full object-cover",loading:"lazy",onError:Me=>{console.warn(`ğŸ“± ä¼˜åŒ–å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå›é€€åˆ°åŸå§‹å›¾ç‰‡: ${m.id}`),Me.target.src=m.thumbnail||m.src}}):n.jsx("div",{className:"w-full h-full flex items-center justify-center bg-theme-surface/20",children:n.jsx("div",{className:"w-8 h-8 border-2 border-theme-text-secondary/30 border-t-theme-text-secondary rounded-full animate-spin"})}),n.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-active:opacity-100 transition-opacity duration-200 flex items-center justify-center",children:n.jsx("div",{className:"w-8 h-8 border-2 border-white rounded-full flex items-center justify-center",children:n.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})})]})},m.id)})}),J.length===0&&n.jsxs("div",{className:"text-center py-16",children:[n.jsx("div",{className:"w-16 h-16 bg-theme-surface/20 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx("svg",{className:"w-8 h-8 text-theme-text-secondary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),n.jsx("div",{className:"text-theme-text-secondary text-lg mb-2",children:((fe=(U=(be=t[d])==null?void 0:be.gallery)==null?void 0:U.mobile)==null?void 0:fe.noContent)||(d==="zh"?"æš‚æ— å›¾ç‰‡å†…å®¹":"No gallery items available")}),n.jsx("div",{className:"text-theme-text-secondary/60 text-sm",children:((de=(oe=(se=t[d])==null?void 0:se.gallery)==null?void 0:oe.mobile)==null?void 0:de.tryAgain)||(d==="zh"?"è¯·ç¨åå†è¯•":"Please try again later")})]}),n.jsx("div",{className:"pb-safe-area-inset-bottom",style:{paddingBottom:"max(2rem, env(safe-area-inset-bottom))"}})]})]})]})};Yt.propTypes={language:we.string};class pi{constructor(e,t={}){this.scene=e,this.rectLights=[],this.helpers=[],this.animationId=null,this.config={intensity:t.intensity||5,colors:t.colors||[16739179,5164484,4569041,16370212],showHelpers:t.showHelpers||!1,enableAnimation:t.enableAnimation!==!1,animationSpeed:t.animationSpeed||.001,lightWidth:t.lightWidth||6,lightHeight:t.lightHeight||8,positions:t.positions||[{x:-18,y:8,z:15,rx:0,ry:0,rz:0},{x:18,y:8,z:15,rx:0,ry:Math.PI,rz:0},{x:0,y:10,z:35,rx:-Math.PI/2,ry:0,rz:0},{x:0,y:10,z:-15,rx:-Math.PI/2,ry:Math.PI,rz:0}]},this.clock=new Fe,this.init()}init(){ei.init(),this.createRectAreaLights(),this.config.enableAnimation&&this.startAnimation()}createRectAreaLights(){this.config.positions.forEach((e,t)=>{const s=this.config.colors[t%this.config.colors.length],h=new ti(s,this.config.intensity,this.config.lightWidth,this.config.lightHeight);if(h.position.set(e.x,e.y,e.z),h.rotation.set(e.rx,e.ry,e.rz),this.scene.add(h),this.rectLights.push(h),this.config.showHelpers){const g=new Bt(h);this.scene.add(g),this.helpers.push(g)}h.userData={originalIntensity:this.config.intensity,originalColor:new ce(s),animationPhase:t/this.config.positions.length*Math.PI*2,index:t}})}startAnimation(){const e=()=>{this.animationId=requestAnimationFrame(e),this.updateAnimation()};e()}updateAnimation(){const e=this.clock.getElapsedTime();this.rectLights.forEach((t,s)=>{const h=t.userData,g=Math.sin(e*this.config.animationSpeed*1e3+h.animationPhase);t.intensity=h.originalIntensity+g*2;const f=Math.sin(e*this.config.animationSpeed*500+h.animationPhase*2)*.1;switch(t.color.copy(h.originalColor),s){case 0:t.color.r=Math.max(.3,t.color.r+f);break;case 1:t.color.g=Math.max(.3,t.color.g+f),t.color.b=Math.max(.3,t.color.b+f);break;case 2:t.color.b=Math.max(.3,t.color.b+f);break;case 3:t.color.r=Math.max(.3,t.color.r+f),t.color.g=Math.max(.3,t.color.g+f);break}})}setIntensity(e){this.config.intensity=e,this.rectLights.forEach(t=>{t.userData.originalIntensity=e})}setAnimationSpeed(e){this.config.animationSpeed=e}toggleHelpers(){this.config.showHelpers=!this.config.showHelpers,this.config.showHelpers?this.rectLights.forEach(e=>{const t=new Bt(e);this.scene.add(t),this.helpers.push(t)}):(this.helpers.forEach(e=>{this.scene.remove(e)}),this.helpers=[])}setPreset(e){switch(e){case"warm":this.config.colors=[16739179,16370212,16752627,15620644],this.setIntensity(6),this.setAnimationSpeed(8e-4);break;case"cool":this.config.colors=[5164484,4569041,10837738,2547329],this.setIntensity(5),this.setAnimationSpeed(.0012);break;case"dramatic":this.config.colors=[16726072,3093826,16737096,8121759],this.setIntensity(8),this.setAnimationSpeed(.002);break;case"soft":this.config.colors=[16771751,14524637,10016968,16243823],this.setIntensity(3),this.setAnimationSpeed(5e-4);break}this.rectLights.forEach((t,s)=>{const h=this.config.colors[s%this.config.colors.length];t.userData.originalColor=new ce(h)})}toggleAnimation(){this.config.enableAnimation=!this.config.enableAnimation,this.config.enableAnimation?this.startAnimation():(this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.rectLights.forEach(e=>{e.intensity=e.userData.originalIntensity,e.color.copy(e.userData.originalColor)}))}getStatus(){return{intensity:this.config.intensity,animationSpeed:this.config.animationSpeed,enableAnimation:this.config.enableAnimation,showHelpers:this.config.showHelpers,lightCount:this.rectLights.length}}dispose(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.rectLights.forEach(e=>{this.scene.remove(e)}),this.rectLights=[],this.helpers.forEach(e=>{this.scene.remove(e)}),this.helpers=[]}}class fi{generatePositionsFromGallery(){return null}extractBaseName(e){return e?e.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,""):null}constructor(e,t={},s=[]){this.scene=e,this.galleryData=s,this.lightCylinders=[],this.animationId=null,this.textureLoader=new ii,this.roomConfig={floorY:-2,ceilingY:8,height:10},this.config={radius:t.radius||.5,height:this.roomConfig.height,radialSegments:t.radialSegments||32,heightSegments:t.heightSegments||1,cubeWidth:t.cubeWidth||1,cubeHeight:t.cubeHeight||8,cubeDepth:t.cubeDepth||1,cubeCount:t.cubeCount||3,enableTexture:t.enableTexture!==!1,textureUrl:t.textureUrl||null,textureDelay:t.textureDelay||1e3,baseColor:t.baseColor||16711744,enableGlow:t.enableGlow!==!1,glowIntensity:t.glowIntensity||.7,emissiveIntensity:t.emissiveIntensity||.3,positions:[{x:-5,z:18,color:65535,textureBaseName:null},{x:5,z:18,color:16711744,textureBaseName:null},{x:0,z:-18,color:65416,textureBaseName:"gallery-horizontal-11",radius:1.618,rotationY:Math.PI/1.5}],intensity:t.intensity||20,lightIntensity:t.lightIntensity||20,lightDistance:t.lightDistance||80,enableAnimation:t.enableAnimation!==!1,animationSpeed:t.animationSpeed||.001,colors:[65535,16711744,65416]},this.clock=new Fe,this.lightCubes=this.lightCylinders}async init(){console.log("ğŸ›ï¸ åˆå§‹åŒ–å‘å…‰åœ†æŸ±ä½“ç³»ç»Ÿï¼ˆä»åœ°æ¿åˆ°å¤©èŠ±æ¿ï¼‰..."),await this.preloadTextures(),this.createLightCylinders(),this.config.enableAnimation&&this.startAnimation()}async preloadTextures(){try{console.log("â© è·³è¿‡çº¹ç†é¢„åŠ è½½ï¼Œä½¿ç”¨æŒ‰éœ€åŠ è½½ç­–ç•¥")}catch(e){console.warn("âš ï¸ çº¹ç†é¢„åŠ è½½å¤±è´¥ï¼Œå°†ä½¿ç”¨åŸå§‹è·¯å¾„:",e)}}createLightCubes(){this.createLightCylinders()}createLightCylinders(){this.config.positions.forEach((e,t)=>{this.createSingleLightCylinder(e,t)}),console.log(`âœ… æ‰€æœ‰ ${this.config.positions.length} ä¸ªå‘å…‰åœ†æŸ±ä½“åˆ›å»ºå®Œæˆï¼ˆçº¹ç†å°†å»¶è¿ŸåŠ è½½ï¼‰`)}createSingleLightCube(e,t,s,h){const g={x:e,z:s,color:this.config.colors[h]||this.config.baseColor,textureBaseName:null};this.createSingleLightCylinder(g,h)}createSingleLightCylinder(e,t){const s={position:{x:e.x,y:2,z:e.z},mesh:null,light:null,index:t,config:e},h=e.radius||this.config.radius,g=this.config.height-.05,f=new ni(h,h,g,this.config.radialSegments,this.config.heightSegments),C=this.createCylinderMaterial(e,t),K=new te(f,C),J=(this.roomConfig.floorY+this.roomConfig.ceilingY)/2;if(K.position.set(e.x,J,e.z),e.rotationY!==void 0&&(K.rotation.y=e.rotationY,console.log(`ğŸ”„ æŸ±å­ç»•Yè½´æ—‹è½¬: ${(e.rotationY*180/Math.PI).toFixed(1)}åº¦`)),this.scene.add(K),s.mesh=K,s.position.y=J,this.config.enableGlow){const ie=new qt(e.color,this.config.lightIntensity,this.config.lightDistance);ie.position.set(e.x,J,e.z),this.scene.add(ie),s.light=ie}s.originalColor=new ce(e.color),s.originalIntensity=this.config.lightIntensity,s.animationPhase=t*Math.PI*.6,this.lightCylinders.push(s);const he=["Lightboxå‰å·¦ä¾§æŸ±å­(32ç±³å¢™çš„1/3ä½ç½®ï¼Œçº¦-10.67ç±³) - é’è‰²ä¸»é¢˜","Lightboxå‰å³ä¾§æŸ±å­(32ç±³å¢™çš„2/3ä½ç½®ï¼Œçº¦10.67ç±³) - çº¢è‰²ä¸»é¢˜","æ‘„åƒæœºèƒŒåç»¿è‰²æŸ±å­(ä»åœ°æ¿åˆ°å¤©èŠ±æ¿ï¼Œé»„é‡‘æ¯”ä¾‹ç›´å¾„) - ç»¿è‰²ä¸»é¢˜"];console.log(`ğŸ›ï¸ åˆ›å»ºå‘å…‰åœ†æŸ±ä½“ ${t+1}: ${he[t]} ä½ç½®(${e.x}, ${J}, ${e.z}), é«˜åº¦${this.config.height}ç±³, åŠå¾„${h}ç±³, ç›´å¾„${(h*2).toFixed(3)}ç±³`),e.textureUrl&&console.log(`ğŸ–¼ï¸ åœ†æŸ±ä½“ ${t+1} åº”ç”¨è´´å›¾: ${e.textureUrl}`)}createCylinderMaterial(e,t){const s=e.color||this.config.baseColor,h=e.textureBaseName||this.config.textureBaseName;let g={transparent:!0,opacity:.9,side:Re};g={...g,color:s,emissive:new ce(s).multiplyScalar(this.config.emissiveIntensity)};const f=new Te(g);return h&&this.config.enableTexture&&setTimeout(async()=>{try{console.log(`ğŸ–¼ï¸ å»¶è¿ŸåŠ è½½åœ†æŸ±ä½“ ${t+1} çš„çº¹ç†: ${h}`);const C=await this.loadGalleryTexture(h);C.repeat.set(1,1),f.map=C,f.color=new ce(1,1,1),f.needsUpdate=!0,console.log(`âœ… åœ†æŸ±ä½“ ${t+1} çº¹ç†åŠ è½½å®Œæˆ: ${h}`)}catch(C){console.warn(`âŒ åœ†æŸ±ä½“ ${t+1} çº¹ç†åŠ è½½å¤±è´¥: ${h}`,C)}},this.config.textureDelay||2e3),f}setTexture(e,t){if(e>=0&&e<this.lightCylinders.length){const s=this.lightCylinders[e];if(t){console.log(`ğŸ–¼ï¸ ä¸ºåœ†æŸ±ä½“ ${e+1} è®¾ç½®æ–°è´´å›¾: ${t}`);const h=this.textureLoader.load(t);h.wrapS=Ae,h.wrapT=Ae,h.repeat.set(1,1);const g=new Te({map:h,transparent:!0,opacity:.9,emissive:new ce(s.config.color).multiplyScalar(this.config.emissiveIntensity),side:Re});s.mesh&&s.mesh.material&&(s.mesh.material.dispose(),s.mesh.material=g),console.log(`âœ… åœ†æŸ±ä½“ ${e+1} è´´å›¾å·²åº”ç”¨ï¼Œç…§æ˜åŠŸèƒ½ä¿æŒæ­£å¸¸`)}else{console.log(`ğŸ”„ ç§»é™¤åœ†æŸ±ä½“ ${e+1} çš„è´´å›¾ï¼Œæ¢å¤å‘å…‰æ•ˆæœ`);const h=new Te({color:s.config.color,transparent:!0,opacity:.9,emissive:new ce(s.config.color).multiplyScalar(this.config.emissiveIntensity),side:Re});s.mesh&&s.mesh.material&&(s.mesh.material.dispose(),s.mesh.material=h)}}}startAnimation(){const e=()=>{this.config.enableAnimation&&(this.updateAnimation(),this.animationId=requestAnimationFrame(e))};e()}updateAnimation(){const e=this.clock.getElapsedTime();this.lightCylinders.forEach(t=>{if(t.light){const s=Math.sin(e*this.config.animationSpeed*1e3+t.animationPhase)*.3+.7;t.light.intensity=t.originalIntensity*s;const h=Math.sin(e*this.config.animationSpeed*500+t.animationPhase)*.1,g={};t.originalColor.getHSL(g),g.h=(g.h+h)%1;const f=new ce().setHSL(g.h,g.s,g.l);t.light.color.copy(f),t.mesh&&t.mesh.material&&(t.mesh.material.map||(t.mesh.material.color.copy(f),t.mesh.material.emissive&&t.mesh.material.emissive.copy(f.clone().multiplyScalar(this.config.emissiveIntensity))))}})}stopAnimation(){this.config.enableAnimation=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}setIntensity(e){this.setLightIntensity(e)}setLightIntensity(e){this.config.lightIntensity=e,this.config.intensity=e,this.lightCylinders.forEach(t=>{t.originalIntensity=e,t.light&&(t.light.intensity=e)})}toggleAnimation(){this.config.enableAnimation=!this.config.enableAnimation,this.config.enableAnimation?this.startAnimation():this.stopAnimation()}getStatus(){return{cylinderCount:this.lightCylinders.length,cubeCount:this.lightCylinders.length,lightIntensity:this.config.lightIntensity,intensity:this.config.intensity,enableAnimation:this.config.enableAnimation,enableTexture:this.config.enableTexture,radius:this.config.radius,height:this.config.height}}dispose(){this.stopAnimation(),this.lightCylinders.forEach(e=>{e.mesh&&(this.scene.remove(e.mesh),e.mesh.geometry&&e.mesh.geometry.dispose(),e.mesh.material&&e.mesh.material.dispose()),e.light&&this.scene.remove(e.light)}),this.lightCylinders=[],console.log("ğŸ›ï¸ å‘å…‰åœ†æŸ±ä½“ç³»ç»Ÿå·²æ¸…ç†")}getBestTexturePath(e){return!e||!e.startsWith("/gallery/")?e:e.split("/").pop().replace(".jpg","")}async loadGalleryTexture(e){if(!e)throw new Error("åŸºç¡€åç§°ä¸èƒ½ä¸ºç©º");try{console.log(`ğŸ–¼ï¸ ä½¿ç”¨textureSystemåŠ è½½Galleryçº¹ç†: ${e}`);const t=await ke.getCompressionInfo();console.log(`ğŸ¯ å½“å‰æµè§ˆå™¨æ”¯æŒæ ¼å¼: ${t.format} (${t.description})`);const s=await ke.loadTexture(e);return console.log(`âœ… Galleryçº¹ç†åŠ è½½æˆåŠŸ: ${e}`),s}catch(t){throw console.error(`âŒ Galleryçº¹ç†åŠ è½½å¤±è´¥: ${e}`,t),t}}}class yi{constructor(e,t,s={}){this.scene=e,this.renderer=t,this.spotlights=[],this.animationId=null,this.config={lightCount:s.lightCount||4,ceilingHeight:s.ceilingHeight||10,positions:[{x:-36,y:10,z:0},{x:36,y:10,z:0},{x:0,y:10,z:-24}],targets:[{x:-32,y:1,z:0},{x:32,y:1,z:0},{x:0,y:1,z:-20}],intensity:s.intensity||3500,distance:s.distance||70,angle:s.angle||Math.PI/2,penumbra:s.penumbra||.3,colors:[16711744,65416,65535],enableAnimation:s.enableAnimation!==!1,animationSpeed:s.animationSpeed||.5,showHelpers:s.showHelpers||!1},this.clock=new Fe,this.init()}async init(){try{await this.createSpotlights(),this.config.enableAnimation&&this.startAnimation(),console.log("âœ¨ IESèšå…‰ç¯ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ")}catch(e){console.warn("âš ï¸ IESèšå…‰ç¯åˆå§‹åŒ–å¤±è´¥ï¼Œä½¿ç”¨æ ‡å‡†èšå…‰ç¯:",e),this.createStandardSpotlights()}}async createSpotlights(){let e=null;try{e=(await mi(()=>import("./three-Br820KFa.js").then(s=>s.ab),__vite__mapDeps([0,1,2,3]))).IESSpotLight}catch(t){console.log("ğŸ¯ IESSpotLightä¸å¯ç”¨:",t.message)}e&&this.renderer.isWebGPURenderer?(console.log("ğŸ¯ ä½¿ç”¨IESèšå…‰ç¯ (WebGPU)"),await this.createIESSpotlights(e)):(console.log("ğŸ¯ ä½¿ç”¨æ ‡å‡†èšå…‰ç¯ï¼ˆé™çº§æ–¹æ¡ˆï¼‰"),this.createStandardSpotlights())}async createIESSpotlights(e){for(let t=0;t<this.config.lightCount;t++){const s=this.config.positions[t],h=this.config.targets[t],g=this.config.colors[t%this.config.colors.length],f=new e(g,this.config.intensity);if(f.position.set(s.x,s.y,s.z),f.angle=this.config.angle,f.penumbra=this.config.penumbra,f.distance=this.config.distance,f.castShadow=!0,f.shadow.mapSize.width=2048,f.shadow.mapSize.height=2048,f.shadow.camera.near=.5,f.shadow.camera.far=this.config.distance,f.shadow.bias=-1e-4,f.shadow.normalBias=.02,f.target.position.set(h.x,h.y,h.z),this.scene.add(f),this.scene.add(f.target),this.config.showHelpers){const K=new Oe(f);f.userData.helper=K,this.scene.add(K)}const C={light:f,originalPosition:{...s},originalTarget:{...h},originalIntensity:this.config.intensity,originalColor:new ce(g),animationPhase:t*Math.PI*.5,index:t};this.spotlights.push(C),console.log(`ğŸ’¡ åˆ›å»ºIESèšå…‰ç¯ ${t+1}: ä½ç½®(${s.x}, ${s.y}, ${s.z}) -> ç›®æ ‡(${h.x}, ${h.y}, ${h.z})`)}}createStandardSpotlights(){for(let e=0;e<this.config.lightCount;e++){const t=this.config.positions[e],s=this.config.targets[e],h=this.config.colors[e%this.config.colors.length],g=new Ve(h,this.config.intensity,this.config.distance,this.config.angle,this.config.penumbra);if(g.position.set(t.x,t.y,t.z),g.castShadow=!0,g.shadow.mapSize.width=2048,g.shadow.mapSize.height=2048,g.shadow.camera.near=.5,g.shadow.camera.far=this.config.distance,g.shadow.bias=-1e-4,g.shadow.normalBias=.02,g.target.position.set(s.x,s.y,s.z),this.scene.add(g),this.scene.add(g.target),this.config.showHelpers){const C=new Oe(g);g.userData.helper=C,this.scene.add(C)}const f={light:g,originalPosition:{...t},originalTarget:{...s},originalIntensity:this.config.intensity,originalColor:new ce(h),animationPhase:e*Math.PI*.5,index:e};this.spotlights.push(f),console.log(`ğŸ’¡ åˆ›å»ºæ ‡å‡†èšå…‰ç¯ ${e+1}: ä½ç½®(${t.x}, ${t.y}, ${t.z}) -> ç›®æ ‡(${s.x}, ${s.y}, ${s.z})`)}}startAnimation(){const e=()=>{this.config.enableAnimation&&(this.updateAnimation(),this.animationId=requestAnimationFrame(e))};e()}updateAnimation(){const e=this.clock.getElapsedTime()*this.config.animationSpeed;this.spotlights.forEach((t,s)=>{const{light:h,originalTarget:g,animationPhase:f}=t,C=e+f,K=2,J=g.x+Math.sin(C*.8)*K*.3,he=g.z+Math.cos(C*.6)*K*.3,ie=g.y+Math.sin(C*.4)*.5;h.target.position.x=J,h.target.position.y=ie,h.target.position.z=he;const pe=.9,Q=Math.sin(C*1.2+s*.5)*.2;h.intensity=t.originalIntensity*(pe+Q);const Y=Math.sin(C*.8+s*.6)*.3,ne={};t.originalColor.getHSL(ne);const ee=(ne.h+Y+e*.1)%1,be=Math.max(.7,ne.s+Math.sin(C*1.5)*.3),U=Math.max(.4,Math.min(.8,ne.l+Math.sin(C*2)*.2)),fe=new ce().setHSL(ee,be,U);h.color.copy(fe);const se=Math.sin(C*.5+s*.3)*.02;h.angle=this.config.angle+se,h.userData.helper&&h.userData.helper.update()})}setIntensity(e){this.config.intensity=e,this.spotlights.forEach(t=>{t.originalIntensity=e,t.light.intensity=e})}setAnimationSpeed(e){this.config.animationSpeed=e}toggleHelpers(){this.config.showHelpers=!this.config.showHelpers,this.spotlights.forEach(e=>{const{light:t}=e;if(this.config.showHelpers){if(!t.userData.helper){const s=new Oe(t);t.userData.helper=s,this.scene.add(s)}t.userData.helper.visible=!0}else t.userData.helper&&(t.userData.helper.visible=!1)})}toggleAnimation(){this.config.enableAnimation=!this.config.enableAnimation,this.config.enableAnimation?this.startAnimation():this.stopAnimation()}stopAnimation(){this.config.enableAnimation=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}getStatus(){return{lightCount:this.config.lightCount,intensity:this.config.intensity,enableAnimation:this.config.enableAnimation,showHelpers:this.config.showHelpers,animationSpeed:this.config.animationSpeed}}dispose(){this.stopAnimation(),this.spotlights.forEach(e=>{const{light:t}=e;t&&(this.scene.remove(t),this.scene.remove(t.target),t.userData.helper&&this.scene.remove(t.userData.helper))}),this.spotlights=[],console.log("ğŸ§¹ IESèšå…‰ç¯ç³»ç»Ÿå·²æ¸…ç†")}}const Xt=({language:d="en"})=>{var Ze,Je,Qe,et,tt,it,nt,st,ot,at,rt,lt,ct,ht,dt,mt,gt,ut,pt,ft,yt,xt,wt,bt,vt,St,kt,Mt,Lt,Pt,It,At,zt,jt,Ct,Et,Wt,$t,Nt,Rt,Tt,Ht,Dt;const[e,t]=P.useState(!0),[s,h]=P.useState(!1),[g,f]=P.useState(!1),[C,K]=P.useState(!1),[J,he]=P.useState(!1),[ie,pe]=P.useState(!1),Q=ze(z=>z.getAllGalleryItems()),Y=ze(z=>z.texts),ne=ze(z=>z.isPointerLocked),ee=ze(z=>z.setIsPointerLocked),be=P.useRef(new Map),U=P.useRef({w:!1,a:!1,s:!1,d:!1,ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1});P.useEffect(()=>{const z=()=>{const me=window.innerWidth<=768||"ontouchstart"in window;K(me),me&&he(!0)};return z(),window.addEventListener("resize",z),()=>window.removeEventListener("resize",z)},[]);const fe=P.useRef(null),se=P.useRef(null),oe=P.useRef(null),de=P.useRef(null),m=P.useRef(null),q=P.useRef(null),N=P.useRef(new Fe),ye=P.useRef(null),Me=P.useRef([]),Ye=P.useRef(null),Xe=P.useRef([]),je=P.useRef(null),Ce=P.useRef(null),He=P.useRef(null),xe=P.useRef(null),Zt=P.useRef(null),Jt=P.useRef(null);return P.useEffect(()=>{if(!fe.current)return;const z=fe.current,me=y=>{const c=new _t;y.add(c),ye.current=c;const x=32,A=72,R=new Ne(x,A),u=(()=>{const b=document.createElement("canvas"),a=1024;b.width=a,b.height=a;const i=b.getContext("2d"),L="#1a1a1a",H=["#262626","#2a2a2a","#1e1e1e","#333333","#2d2d2d"];i.fillStyle=L,i.fillRect(0,0,a,a);for(let j=0;j<2e3;j++){const $=Math.random()*a,ue=Math.random()*a,Z=Math.random()*8+2,ae=Math.random()*.3+.1;i.globalAlpha=ae,i.fillStyle=H[Math.floor(Math.random()*H.length)],i.beginPath(),i.arc($,ue,Z,0,Math.PI*2),i.fill()}i.globalAlpha=.15,i.strokeStyle="#404040",i.lineWidth=1;for(let j=0;j<50;j++){const $=Math.random()*a,ue=Math.random()*a,Z=Math.random()*100+50,ae=Math.random()*Math.PI*2;i.beginPath(),i.moveTo($,ue),i.lineTo($+Math.cos(ae)*Z,ue+Math.sin(ae)*Z),i.stroke()}const O=i.createRadialGradient(a/2,a/2,0,a/2,a/2,a/2);O.addColorStop(0,"rgba(80, 80, 80, 0.15)"),O.addColorStop(.5,"rgba(60, 60, 60, 0.08)"),O.addColorStop(1,"rgba(40, 40, 40, 0.02)"),i.globalAlpha=1,i.fillStyle=O,i.fillRect(0,0,a,a),i.globalAlpha=.06;for(let j=0;j<15;j++){const $=Math.random()*a,ue=Math.random()*a,Z=Math.random()*2+1;i.fillStyle="#00ffaa",i.beginPath(),i.arc($,ue,Z,0,Math.PI*2),i.fill()}i.globalAlpha=1;const F=new Kt(b);return F.wrapS=Ae,F.wrapT=Ae,F.repeat.set(6,6),F})(),X=new Te({map:u,color:1710618,metalness:.05,roughness:.3,envMapIntensity:1.2}),G=new te(R,X);G.rotation.x=-Math.PI/2,G.position.y=-2,G.receiveShadow=!0,y.add(G);const ge=(()=>{const b=document.createElement("canvas"),a=1024;b.width=a,b.height=a;const i=b.getContext("2d");i.fillStyle="#f8f8f8",i.fillRect(0,0,a,a);const L=64,H=2;i.strokeStyle="#e0e0e0",i.lineWidth=H;for(let F=0;F<=a;F+=L)i.beginPath(),i.moveTo(F,0),i.lineTo(F,a),i.stroke();for(let F=0;F<=a;F+=L)i.beginPath(),i.moveTo(0,F),i.lineTo(a,F),i.stroke();const O=new Kt(b);return O.wrapS=Ae,O.wrapT=Ae,O.repeat.set(4,4),O})(),W=new te(new Ne(x,A),new Ie({map:ge,color:16777215,transparent:!1,side:Re}));W.rotation.x=Math.PI/2,W.position.y=8,W.receiveShadow=!0,y.add(W);const D=new Ie({color:16316664,side:De,transparent:!1}),B=32,Le=72,S=12,p=.5,w=new te(new le(B,S,p),D);w.position.set(0,3,-36),w.receiveShadow=!0,w.castShadow=!1,c.add(w),y.add(w);const v=new te(new le(10,S,p),D);v.position.set(-11,3,36),v.receiveShadow=!0,v.castShadow=!1,c.add(v),y.add(v);const o=new te(new le(10,S,p),D);o.position.set(11,3,36),o.receiveShadow=!0,o.castShadow=!1,c.add(o),y.add(o);const r=new te(new le(p,S,Le),D);r.position.set(-16,3,0),r.receiveShadow=!0,r.castShadow=!1,c.add(r),y.add(r);const l=new te(new le(p,S,Le),D);l.position.set(16,3,0),l.receiveShadow=!0,l.castShadow=!1,c.add(l),y.add(l)},T=(y,c=null)=>{if(!Q||Q.length===0){for(let S=0;S<6;S++){const p=new Ne(3,2),w=new Ie({color:6710886}),v=new te(p,w);S<3?(v.position.set(-6+S*6,3,-14.9),v.rotation.y=0):(v.position.set(-14.9,3,-6+(S-3)*6),v.rotation.y=Math.PI/2),y.add(v)}return}const x=Math.min(Q.length,22),A=2.2,R=4,I=async()=>{const S=[];for(let v=0;v<Math.min(Q.length,x);v++){const o=Q[v];if(o.src||o.thumbnail)try{let r,l;o.aspectRatio&&o.dimensions?(r=o.aspectRatio,l=o.dimensions,console.log(`âœ… ä½¿ç”¨é¢„è®¡ç®—å°ºå¯¸: ${o.id} - ${l.width}x${l.height} (${r.toFixed(2)})`)):(console.log(`âš ï¸ ç¼ºå°‘é¢„è®¡ç®—å°ºå¯¸ï¼ŒåŠ¨æ€æ£€æµ‹: ${o.id}`),l=await G(o.src||o.thumbnail),r=l.width/l.height),S.push({index:v,item:o,aspectRatio:r,isPortrait:r<.8,isLandscape:r>1.3,isSquare:r>=.8&&r<=1.3,dimensions:l,isPrecomputed:!!(o.aspectRatio&&o.dimensions)})}catch(r){console.warn(`âŒ å›¾ç‰‡å°ºå¯¸åˆ†æå¤±è´¥: ${o.id}`,r),S.push({index:v,item:o,aspectRatio:1,isPortrait:!1,isLandscape:!1,isSquare:!0,dimensions:{width:300,height:200},isPrecomputed:!1})}}const p=S.filter(v=>v.isPrecomputed).length,w=S.length;return console.log(`ğŸ“Š å°ºå¯¸åˆ†æå®Œæˆ: ${p}/${w} ä½¿ç”¨é¢„è®¡ç®—æ•°æ® (${Math.round(p/w*100)}%)`),S},u=S=>{const p={backWall:[],rightWall:[],leftWall:[],frontWall:[]},w=S.filter(b=>b.item.position!=="lightbox"),v=w.filter(b=>b.item.wall==="vertical_wall_32m"),o=w.filter(b=>b.item.wall==="horizontal_wall_64m"),r=o.filter(b=>b.item.layer==="upper"),l=o.filter(b=>b.item.layer==="lower");return p.backWall=v.slice(0,3),p.frontWall=v.slice(3,5),p.rightWall=[...r.slice(0,4),...l.slice(0,4)],p.leftWall=[...r.slice(4,8),...l.slice(4,8)],p},X=async()=>{if(y.children.some(r=>r.name&&r.name.startsWith("painting_"))){console.log("â­ï¸ è·³è¿‡é‡å¤åˆ›å»ºç”»ä½œï¼ˆç”»ä½œå·²å­˜åœ¨ï¼‰");return}console.log("ğŸ¨ å¼€å§‹åˆ›å»ºç”»å»Šç”»ä½œ...");const S=await I(),p=u(S),w=new Map,v=async(r,l,b)=>{var Pe,We,$e,re;const a=r.item,i=r.aspectRatio;let L,H;i>1.5?(L=Math.min(R,A*i*.8),H=L/i):i<.7?(H=A,L=H*i):(H=A*.9,L=H*i);const O=new Ne(L,H),F=new Ue({color:16777215,metalness:0,roughness:.15,clearcoat:.1,clearcoatRoughness:.1,reflectivity:.3,emissive:1052688,emissiveIntensity:.02,side:Re}),j=new te(O,F),$=Le(j,L,H),ue=35.5;switch(l){case"backWall":$.position.set(-10+b*10,2.4,-35.5),$.rotation.y=0;break;case"rightWall":{const{x:M,y:k,z:V}=E(r.item,p.rightWall);$.position.set(M,k,V),$.rotation.y=-Math.PI/2;break}case"leftWall":{const{x:M,y:k,z:V}=ge(r.item,p.leftWall);$.position.set(M,k,V),$.rotation.y=Math.PI/2;break}case"frontWall":b===0?$.position.set(-10,2.4,ue):$.position.set(10,2.4,ue),$.rotation.y=Math.PI;break}$.castShadow=!1,$.receiveShadow=!1,$.name=`painting_${l}_${b}`,y.add($),Xe.current.push({mesh:$,position:$.position.clone(),painting:j}),be.current.set(a.id,{position:$.position.clone(),item:a,mesh:$}),setTimeout(()=>{(l==="frontWall"||l==="rightWall"&&r.item.layer==="lower"||l==="leftWall"&&r.item.layer==="lower")&&W($)},100);const Z=a.src||a.thumbnail,ae=Z.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,"");if(console.log(`ğŸ” æŸ¥æ‰¾çº¹ç† - item.id: ${a.id}, é¢„åŠ è½½çº¹ç†æ•°é‡: ${((Pe=xe.current)==null?void 0:Pe.textures.size)||0}`),console.log("ğŸ” é¢„åŠ è½½çº¹ç†keys:",Array.from(((We=xe.current)==null?void 0:We.textures.keys())||[])),($e=xe.current)!=null&&$e.textures.has(a.id)){const M=xe.current.textures.get(a.id);j.material.map=M,j.material.color.setHex(16777215),j.material.needsUpdate=!0,console.log(`âœ… ä½¿ç”¨é¢„åŠ è½½Galleryçº¹ç†: ${a.id}`)}else if((re=xe.current)!=null&&re.videos.has(a.id)){const M=xe.current.videos.get(a.id);if(j.material.map=M,j.material.color.setHex(16777215),j.material.needsUpdate=!0,console.log(`âœ… ä½¿ç”¨é¢„åŠ è½½è§†é¢‘çº¹ç†: ${a.id}`),M.image){const k=M.image;k.paused&&k.play().catch(V=>{console.warn("Galleryè§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œæ·»åŠ ç”¨æˆ·äº¤äº’ç›‘å¬:",V);const _=()=>{k.paused&&k.play().then(()=>{console.log(`ğŸ¬ Galleryè§†é¢‘ç”¨æˆ·äº¤äº’åå¼€å§‹æ’­æ”¾: ${a.id}`)}).catch(Be=>console.warn("ç”¨æˆ·äº¤äº’åæ’­æ”¾å¤±è´¥:",Be))};document.addEventListener("click",_,{once:!0}),document.addEventListener("touchstart",_,{once:!0})})}}else if(w.has(Z))j.material.map=w.get(Z),j.material.color.setHex(16777215),j.material.needsUpdate=!0;else try{if(a.type==="video"){const M=document.createElement("video");M.src=Z,M.autoplay=a.autoplay||!0,M.loop=a.loop||!0,M.muted=a.muted||!0,M.controls=a.controls||!1,M.crossOrigin="anonymous",M.playsInline=!0,await new Promise((V,_)=>{M.oncanplay=V,M.onerror=_,M.load()});const k=new Ot(M);k.generateMipmaps=!1,k.minFilter=Ge,k.magFilter=Ge,k.flipY=!0,k.colorSpace=_e,w.set(Z,k),j.material.map=k,j.material.color.setHex(16777215),j.material.needsUpdate=!0,M.play().catch(V=>{console.warn("è§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’:",V)}),console.log(`ğŸ¬ åŠ è½½è§†é¢‘çº¹ç†: ${a.title.zh||a.title.en}`)}else{let M;a.id==="gallery_lightbox"?M=a.src.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,""):M=a.id.replace(/_/g,"-"),console.log(`âš ï¸ é¢„åŠ è½½çº¹ç†ä¸å¯ç”¨ï¼Œå°è¯•å•ç‹¬åŠ è½½: ${a.id} -> ${M}`);const k=await ke.loadSceneTextures("gallery",{images:[M],folder:"gallery"});if(k.textures.has(M)){const V=k.textures.get(M);w.set(Z,V),j.material.map=V,j.material.color.setHex(16777215),j.material.needsUpdate=!0,console.log(`âœ… å•ç‹¬åŠ è½½Galleryçº¹ç†æˆåŠŸ: ${M}`)}else throw new Error(`çº¹ç†åŠ è½½å¤±è´¥: ${M}`)}}catch(M){console.warn(`Galleryçº¹ç†åŠ è½½å¤±è´¥: ${ae}`,M),j.material.color.setHex(6710886),j.material.needsUpdate=!0}},o=[...p.backWall.map((r,l)=>({data:r,wallType:"backWall",index:l})),...p.rightWall.map((r,l)=>({data:r,wallType:"rightWall",index:l})),...p.leftWall.map((r,l)=>({data:r,wallType:"leftWall",index:l})),...p.frontWall.map((r,l)=>({data:r,wallType:"frontWall",index:l}))];for(let r=0;r<o.length;r+=4){const l=o.slice(r,r+4);await Promise.all(l.map(({data:b,wallType:a,index:i})=>v(b,a,i))),r+4<o.length&&await new Promise(b=>setTimeout(b,100))}console.log("ğŸ¨ æ‰€æœ‰ç”»ä½œçº¹ç†åŠ è½½å®Œæˆï¼Œè§¦å‘åŠ è½½ç®¡ç†å™¨å›è°ƒ"),c&&c.onLoad&&setTimeout(()=>{c.onLoad()},200)},G=async S=>{try{const p=S.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,""),w=await ke.getOptimalPath(p,"gallery");return new Promise(v=>{const o=new Image;o.onload=()=>{v({width:o.width,height:o.height})},o.onerror=()=>{const r=new Image;r.onload=()=>{v({width:r.width,height:r.height})},r.onerror=()=>{v({width:300,height:200})},r.src=S},o.src=w})}catch{return new Promise(p=>{const w=new Image;w.onload=()=>{p({width:w.width,height:w.height})},w.onerror=()=>{p({width:300,height:200})},w.src=S})}},E=(S,p)=>{const l=[-28,-12,4,20],b=[-20,-4,12,28];if(S.layer==="upper"){const a=p.filter(i=>i.item.layer==="upper").findIndex(i=>i.item.id===S.id);return{x:15.5,y:1.8+1.2,z:b[a]||0}}else{const a=p.filter(i=>i.item.layer==="lower").findIndex(i=>i.item.id===S.id);return{x:15.5,y:1.8,z:l[a]||0}}},ge=(S,p)=>{const v=E(S,p);return{x:-15.5,y:v.y,z:-v.z}},W=S=>{const p=S.position,w=S.rotation,v=Math.abs(w.y)<.1||Math.abs(w.y-Math.PI)<.1;let o,r,l,b;v?(o=Math.PI/9,r=.08,l=12,b=6):(o=Math.PI/6,r=.15,l=15,b=3.5);const a=new Ve(16775393,1.5,l,o,r,1);let i=new Ut;const L=Math.max(7,p.y+b),H=1.8;return Math.abs(w.y)<.1?i.set(p.x,L,p.z+H):Math.abs(w.y-Math.PI)<.1?i.set(p.x,L,p.z-H):Math.abs(w.y+Math.PI/2)<.1?i.set(p.x-H,L,p.z):Math.abs(w.y-Math.PI/2)<.1&&i.set(p.x+H,L,p.z),a.position.copy(i),a.target=S,a.castShadow=!1,a.userData={paintingPosition:p.clone(),baseIntensity:1,maxIntensity:8,activationDistance:6,optimalDistance:2},y.add(a),y.add(a.target),Me.current.push(a),a},D=.05,B=.1,Le=(S,p=2.5,w=2)=>{const v=new _t,o=new Ue({color:1710618,metalness:.8,roughness:.2,clearcoat:.3,clearcoatRoughness:.1,emissive:657930,emissiveIntensity:.05}),r=[new le(p+B*2,B,D),new le(p+B*2,B,D),new le(B,w,D),new le(B,w,D)],l=[{x:0,y:(w+B)/2,z:D/2},{x:0,y:-(w+B)/2,z:D/2},{x:-(p+B)/2,y:0,z:D/2},{x:(p+B)/2,y:0,z:D/2}];return r.forEach((b,a)=>{const i=new te(b,o);i.position.set(l[a].x,l[a].y,l[a].z),i.castShadow=!1,i.receiveShadow=!1,v.add(i)}),v.add(S),v};X()},ve=(y,c)=>{const x=6*y,A=de.current,R=A.position.clone();(U.current.w||U.current.ArrowUp)&&c.moveForward(x),(U.current.s||U.current.ArrowDown)&&c.moveForward(-x),(U.current.d||U.current.ArrowRight)&&c.moveRight(x),(U.current.a||U.current.ArrowLeft)&&c.moveRight(-x),Se(A)&&A.position.copy(R),((u,X)=>{if(!X.isLocked)return;let G=null,E=1/0;const ge=4;if(be.current.forEach(W=>{const D=u.position.distanceTo(W.position);D<ge&&D<E&&(E=D,G=W)}),G){const W=G.position.y,D=u.position.y,B=W-D;u.position.y+=B*.15}else{const B=2.4-u.position.y;u.position.y+=B*.08}u.position.y=Math.max(1.2,Math.min(3.5,u.position.y))})(A,c),c.isLocked||(A.position.y=2.4),Ee(A.position)},Se=y=>{const c=y.position,x=14.5,A=34.5;if(c.x>x||c.x<-x||c.z>A||c.z<-A)return!0;const R=[{x:-5,z:18,radius:.5},{x:5,z:18,radius:.5},{x:0,z:-18,radius:1.618/2}],I=.5;for(const u of R)if(Math.sqrt(Math.pow(c.x-u.x,2)+Math.pow(c.z-u.z,2))<u.radius+I)return!0;return!1},Ee=y=>{Me.current.forEach(c=>{const x=c.userData;if(!x||!x.paintingPosition)return;const A=y.distanceTo(x.paintingPosition);let R=x.baseIntensity;if(A<=x.activationDistance){const I=Math.max(0,(x.activationDistance-A)/x.activationDistance),u=x.maxIntensity-x.baseIntensity,X=Math.pow(I,1.5);R=x.baseIntensity+u*X,A<=x.optimalDistance&&(R=x.maxIntensity)}c.intensity=qe.lerp(c.intensity,R,.12)}),Gt(y)},Gt=y=>{const c=Ye.current;if(!c)return;let x=1/0;Xe.current.forEach(R=>{const I=y.distanceTo(R.position);I<x&&(x=I)});const A=de.current;if(A){const R=new Ut;A.getWorldDirection(R);const I=A.position.clone().add(R.multiplyScalar(10));c.target.position.copy(I),c.target.updateMatrixWorld()}if(x<=6){const I=3+Math.max(0,(6-x)/6)*12;c.intensity=qe.lerp(c.intensity,I,.1)}else c.intensity=qe.lerp(c.intensity,1.5,.1)},Ft=()=>{const y=de.current;if(!y)return;const c={phase1:{duration:2500,startPos:{x:0,y:2.4,z:15},endPos:{x:0,y:2.4,z:12},startLookAt:{x:0,y:8,z:0},endLookAt:{x:0,y:8,z:0}},phase2:{duration:3e3,startPos:{x:0,y:2.4,z:12},endPos:{x:0,y:2.4,z:5},startLookAt:{x:0,y:8,z:0},endLookAt:{x:0,y:4,z:0}},phase3:{duration:2e3,startPos:{x:0,y:2.4,z:5},endPos:{x:0,y:2.4,z:0},startLookAt:{x:0,y:4,z:0},endLookAt:{x:0,y:2.4,z:-1}}};y.position.set(c.phase1.startPos.x,c.phase1.startPos.y,c.phase1.startPos.z),y.lookAt(c.phase1.startLookAt.x,c.phase1.startLookAt.y,c.phase1.startLookAt.z);let x=1,A=Date.now();const R=u=>{const X=Date.now()-A,G=Math.min(X/u.duration,1),E=G<.5?4*G*G*G:1-Math.pow(-2*G+2,3)/2;y.position.x=u.startPos.x+(u.endPos.x-u.startPos.x)*E,y.position.y=u.startPos.y+(u.endPos.y-u.startPos.y)*E,y.position.z=u.startPos.z+(u.endPos.z-u.startPos.z)*E;const ge={x:u.startLookAt.x+(u.endLookAt.x-u.startLookAt.x)*E,y:u.startLookAt.y+(u.endLookAt.y-u.startLookAt.y)*E,z:u.startLookAt.z+(u.endLookAt.z-u.startLookAt.z)*E};return y.lookAt(ge.x,ge.y,ge.z),G>=1},I=()=>{let u=!1;switch(x){case 1:u=R(c.phase1),u&&(x=2,A=Date.now());break;case 2:u=R(c.phase2),u&&(x=3,A=Date.now());break;case 3:if(u=R(c.phase3),u){h(!0),t(!1),setTimeout(()=>{f(!0)},9e3),m.current&&(m.current.getObject().position.copy(y.position),m.current.connect=m.current.connect.__original||m.current.connect);return}break}Zt.current=requestAnimationFrame(I)};I()};return(async()=>{try{if(se.current||oe.current)return;const y=new si;Jt.current=y;let c=!1;const x=async()=>{try{const o=[],r=[];Q.slice(0,12).forEach(i=>{let L;i.id==="gallery_lightbox"?L=i.src.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,""):L=i.id.replace(/_/g,"-"),i.type==="video"?r.push({id:i.id,fileName:L,src:i.src}):o.push({id:i.id,fileName:L})}),console.log("ğŸ¨ å¼€å§‹é¢„åŠ è½½Galleryçº¹ç†...",{images:o.length,videos:r.length});const l=await ke.loadSceneTextures("gallery",{images:o.map(i=>i.fileName),videos:r.map(i=>({name:i.fileName,src:i.src})),folder:"gallery",onProgress:(i,L,H)=>{console.log(`ğŸ“¦ Galleryçº¹ç†åŠ è½½è¿›åº¦: ${L}/${H} (${Math.round(i*100)}%)`)}}),b=new Map,a=new Map;o.forEach(({id:i,fileName:L})=>{l.textures.has(L)&&b.set(i,l.textures.get(L))}),r.forEach(({id:i,fileName:L})=>{l.videos.has(L)&&a.set(i,l.videos.get(L))}),xe.current={textures:b,videos:a,errors:l.errors},console.log(`âœ… Galleryçº¹ç†é¢„åŠ è½½å®Œæˆ: ${l.textures.size}å¼ å›¾ç‰‡, ${l.videos.size}ä¸ªè§†é¢‘`),l.errors.length>0&&console.warn("âš ï¸ éƒ¨åˆ†Galleryçº¹ç†åŠ è½½å¤±è´¥:",l.errors),c=!0,A&&c&&R()}catch(o){console.warn("Galleryçº¹ç†é¢„åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨fallback:",o),xe.current={textures:new Map,videos:new Map,errors:[]},c=!0,A&&R()}};let A=!1;const R=()=>{requestAnimationFrame(()=>{oe.current&&se.current&&de.current?(oe.current.render(se.current,de.current),requestAnimationFrame(()=>{setTimeout(()=>{Ft()},300)})):setTimeout(()=>{Ft()},500)})};y.onLoad=()=>{console.log("ğŸ­ THREE.jsåœºæ™¯åŠ è½½å®Œæˆ"),A=!0,c&&R()},y.onError=()=>{},x();const I=new oi;I.background=new ce(1710618),se.current=I;const u=new ai(75,z.clientWidth/z.clientHeight,.1,1e3);u.position.set(0,2.4,0),de.current=u;const X=new Ve(16774374,6,15,Math.PI/5,.15,1.2);X.position.set(0,0,0),X.castShadow=!1;const G=new ri;X.target=G,u.add(X),I.add(G),I.add(u),Ye.current=X;const E=new li({antialias:!0,alpha:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1});if(E.setSize(z.clientWidth,z.clientHeight),E.setClearColor(15790320,1),E.shadowMap.enabled=!0,E.shadowMap.type=ci,E.outputColorSpace=_e,E.toneMapping=hi,E.toneMappingExposure=1,!E.getContext())throw new Error("WebGL context creation failed");z.appendChild(E.domElement),oe.current=E;let W;try{document&&document.body&&document.documentElement&&window.self===window.top&&"requestPointerLock"in document.body?W=new Ke(u,document.body):(W=new Ke(u,E.domElement),console.warn("Pointer Lock API not available, using fallback mode"))}catch(o){console.warn("PointerLockControls initialization failed:",o),W=new Ke(u,E.domElement)}I.add(W.getObject()),m.current=W;try{W.addEventListener("lock",()=>{ee(!0)}),W.addEventListener("unlock",()=>{ee(!1)})}catch(o){console.warn("PointerLockControls event setup failed:",o)}try{const o=W.connect;o&&(W.connect.__original=o,W.connect=()=>{if(s)try{o.call(W)}catch(r){console.warn("PointerLockControls connect failed:",r)}})}catch(o){console.warn("PointerLockControls connect override failed:",o)}const D=o=>{const l=(()=>{const L=new le(12,12,.4),H=new Ue({color:1710618,metalness:.9,roughness:.1,clearcoat:.5,clearcoatRoughness:.05,emissive:3355443,emissiveIntensity:.15}),O=new te(L,H);O.position.set(0,3,35.8),o.add(O);const j=(()=>{const Z=new Ne(11,9),ae={useVideo:!0,videoPath:"/ui-test.mp4",imagePath:"/gallery/gallery-vertical-0.jpg"},Pe=Q.find(k=>k.position==="lightbox"),We=Pe?Pe.src||Pe.thumbnail:ae.imagePath;let $e;ae.useVideo&&($e=new Ie({color:0,emissive:0,emissiveIntensity:0,transparent:!0,opacity:.95,side:De}));const re=new te(Z,$e);if(re.position.set(0,3,36-.4-.02),re.rotation.y=Math.PI,re.name="LightboxGallery",o.add(re),ae.useVideo){console.log(`ğŸ¬ Lightboxè§†é¢‘åŠ è½½: ${ae.videoPath}`);const k=document.createElement("video");k.src=ae.videoPath,k.crossOrigin="anonymous",k.loop=!0,k.muted=!0,k.autoplay=!0,k.playsInline=!0,k.preload="auto";const V=()=>{try{const _=new Ot(k);_.minFilter=Ge,_.magFilter=Ge,_.format=di,_.generateMipmaps=!1,_.flipY=!0,_.colorSpace=_e;const Be=new Ie({map:_,emissive:0,emissiveIntensity:0,transparent:!1,side:De});re.material.dispose(),re.material=Be,console.log("âœ… Lightboxè§†é¢‘çº¹ç†è®¾ç½®å®Œæˆ"),k.play().catch(Qt=>{console.warn("Lightboxè§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥:",Qt)})}catch(_){console.warn("Lightboxè§†é¢‘çº¹ç†åˆ›å»ºå¤±è´¥:",_)}};k.addEventListener("loadeddata",V),k.addEventListener("canplay",V),k.addEventListener("loadedmetadata",()=>{k.play().catch(()=>{console.warn("Lightboxè§†é¢‘å…ƒæ•°æ®åŠ è½½åæ’­æ”¾å¤±è´¥")})}),k.addEventListener("error",_=>{console.warn("Lightboxè§†é¢‘åŠ è½½é”™è¯¯:",_),M()}),k.load()}function M(){console.log(`ğŸ–¼ï¸ Lightboxå›¾ç‰‡åŠ è½½: ${We}`);const k=We.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,"");ke.loadTexture(k).then(V=>{const _=new Ie({map:V,emissive:0,emissiveIntensity:0,transparent:!0,opacity:.61,side:De});re.material.dispose(),re.material=_,console.log("âœ… Lightboxå›¾ç‰‡çº¹ç†è®¾ç½®å®Œæˆ")}).catch(()=>{console.warn("Lightboxå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œä¿æŒå ä½æè´¨")})}return{screen:re}})();return console.log("ğŸ–¼ï¸ Lightboxå±å¹•åˆ›å»ºå®Œæˆ",j),{lightBox:O,lightboxDisplay:j}})();return{wallLightBox:l.lightBox,lightboxDisplay:l.lightboxDisplay.screen,ledFrame:l.lightboxDisplay.frame}},B=()=>{const o=[];return[{start:{x:-3,z:2.25},end:{x:3,z:2.25},name:"ç‹-ä¸Šæ¨ª"},{start:{x:-2.5,z:0},end:{x:2.5,z:0},name:"ç‹-ä¸­æ¨ª"},{start:{x:-3.5,z:-2.25},end:{x:3.5,z:-2.25},name:"ç‹-ä¸‹æ¨ª"},{start:{x:0,z:2.25},end:{x:0,z:-2.25},name:"ç‹-ç«–çº¿"}].forEach(l=>{const b=Math.sqrt(Math.pow(l.end.x-l.start.x,2)+Math.pow(l.end.z-l.start.z,2));let a;l.name.includes("ç«–")?a=new le(.4,.2,b):a=new le(b,.2,.4);const i=new Te({color:16777215,emissive:16777215,emissiveIntensity:2,transparent:!1}),L=new te(a,i),H=(l.start.x+l.end.x)/2,O=(l.start.z+l.end.z)/2;L.position.set(H,6,O),I.add(L);const F=new qt(16777215,7,45);F.position.set(H,5.5,O),I.add(F),o.push({tube:L,name:l.name})}),o},Le=D(I);console.log("ğŸ¨ è‰ºæœ¯å…ƒç´ åˆ›å»ºå®Œæˆ:",Le),B(),me(I),T(I,y);const S=()=>{try{const o={intensity:4,colors:[16739179,5164484,4569041,16370212],showHelpers:!1,enableAnimation:!0,animationSpeed:8e-4,lightWidth:8,lightHeight:6,positions:[{x:-30,y:10,z:0,rx:0,ry:Math.PI/2,rz:0},{x:30,y:10,z:0,rx:0,ry:-Math.PI/2,rz:0},{x:0,y:11.5,z:30,rx:-Math.PI/3,ry:0,rz:0},{x:0,y:11.5,z:-10,rx:-Math.PI/3,ry:Math.PI,rz:0}]};je.current=new pi(I,o),je.current.setPreset("soft"),console.log("RectAreaLightingç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ")}catch(o){console.warn("RectAreaLightingåˆå§‹åŒ–å¤±è´¥:",o)}},p=async()=>{try{const o={cubeSize:2.5,cubeCount:3,spacing:10,height:6,intensity:2.5,lightSize:2,enableAnimation:!0,animationSpeed:.001,showCubeMesh:!0,cubeOpacity:.05,showHelpers:!1};Ce.current=new fi(I,o,Q),await Ce.current.init(),console.log("å…‰æŸ±ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ")}catch(o){console.warn("å…‰æŸ±ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:",o)}},w=()=>{try{const o={lightCount:3,intensity:4200,distance:80,angle:Math.PI/1.8,penumbra:.4,enableAnimation:!0,animationSpeed:.3,showHelpers:!1};He.current=new yi(I,E,o),console.log("âœ¨ 3ç¯ä½IESèšå…‰ç¯ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ - é¿å¼€lightboxå¢™é¢")}catch(o){console.warn("âš ï¸ IESèšå…‰ç¯ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:",o)}};setTimeout(()=>{S(),setTimeout(async()=>{await p(),setTimeout(()=>{w()},200)},100)},300);const v=()=>{q.current=requestAnimationFrame(v);const o=N.current.getDelta();W.isLocked&&ve(o,W),I.traverse(r=>{r.material&&r.material.map&&r.material.map.isVideoTexture&&(r.material.map.needsUpdate=!0)}),E.render(I,u)};v(),t(!1)}catch(y){throw t(!1),y}})().catch(y=>{console.error("Galleryåœºæ™¯åˆå§‹åŒ–å¤±è´¥:",y),t(!1)}),()=>{var y;(y=m.current)!=null&&y.isLocked&&(console.log("ğŸ”“ Galleryç»„ä»¶å¸è½½æ—¶å¼ºåˆ¶è§£é”æŒ‡é’ˆ"),m.current.unlock()),ee(!1),je.current&&(je.current.dispose(),je.current=null,console.log(" ğŸ§¹ RectAreaLightingç³»ç»Ÿå·²æ¸…ç†")),Ce.current&&(Ce.current.dispose(),Ce.current=null,console.log(" ğŸ›ï¸ å‘å…‰åœ†æŸ±ä½“ç³»ç»Ÿå·²æ¸…ç†")),He.current&&(He.current.dispose(),He.current=null,console.log(" ğŸ§¹ IESèšå…‰ç¯ç³»ç»Ÿå·²æ¸…ç†")),q.current&&(cancelAnimationFrame(q.current),q.current=null),m.current&&(m.current.isLocked&&m.current.unlock(),m.current.dispose(),m.current=null,console.log(" ğŸ® Galleryæ§åˆ¶å™¨å·²æ¸…ç†")),se.current&&(se.current.traverse(c=>{c.geometry&&c.geometry.dispose(),c.material&&(Array.isArray(c.material)?c.material.forEach(x=>{x.map&&x.map.dispose(),x.normalMap&&x.normalMap.dispose(),x.roughnessMap&&x.roughnessMap.dispose(),x.dispose()}):(c.material.map&&c.material.map.dispose(),c.material.normalMap&&c.material.normalMap.dispose(),c.material.roughnessMap&&c.material.roughnessMap.dispose(),c.material.dispose()))}),se.current.clear(),se.current=null),oe.current&&(z&&z.contains(oe.current.domElement)&&z.removeChild(oe.current.domElement),oe.current.dispose(),oe.current=null),de.current=null,ye.current=null,console.log("ğŸ§¹ Gallery ç»„ä»¶æ¸…ç†å®Œæˆ")}},[Q,s,ee]),P.useEffect(()=>{const z=()=>{var T;!(document.pointerLockElement!==null)&&((T=m.current)!=null&&T.isLocked)&&(console.log("ğŸ”“ æ£€æµ‹åˆ°æŒ‡é’ˆé”å®šçŠ¶æ€ä¸ä¸€è‡´ï¼Œå¼ºåˆ¶åŒæ­¥çŠ¶æ€"),m.current&&(m.current.disconnect(),setTimeout(()=>{m.current&&m.current.connect()},100)),ee(!1))};return document.addEventListener("pointerlockchange",z),document.addEventListener("pointerlockerror",z),()=>{document.removeEventListener("pointerlockchange",z),document.removeEventListener("pointerlockerror",z)}},[ee]),P.useEffect(()=>{const z=T=>{var Se,Ee;if((Se=m.current)!=null&&Se.isLocked&&!["KeyW","KeyA","KeyS","KeyD","Escape"].includes(T.code)&&T.key!=="Escape"){T.preventDefault(),T.stopPropagation(),console.log("ğŸ”’ ç”»å»Šå¯¼èˆªæ¨¡å¼ï¼šåªå…è®¸WASDç§»åŠ¨å’ŒESCé€€å‡º");return}const ve=T.code==="KeyW"?"w":T.code==="KeyA"?"a":T.code==="KeyS"?"s":T.code==="KeyD"?"d":T.key.toLowerCase();ve in U.current&&(U.current[ve]=!0),T.key==="Escape"&&((Ee=m.current)!=null&&Ee.isLocked)&&(console.log("ğŸ”“ ESCé”®è§£é”æŒ‡é’ˆ"),m.current.unlock())},me=T=>{var Se;if((Se=m.current)!=null&&Se.isLocked&&!["KeyW","KeyA","KeyS","KeyD"].includes(T.code)){T.preventDefault(),T.stopPropagation();return}const ve=T.code==="KeyW"?"w":T.code==="KeyA"?"a":T.code==="KeyS"?"s":T.code==="KeyD"?"d":T.key;ve in U.current&&(U.current[ve]=!1)};return document.addEventListener("keydown",z),document.addEventListener("keyup",me),()=>{document.removeEventListener("keydown",z),document.removeEventListener("keyup",me)}},[]),n.jsxs(n.Fragment,{children:[C&&J&&n.jsx("div",{className:"fixed inset-0 z-[99999] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center max-w-md border border-white/20",children:[n.jsxs("div",{className:"mb-6",children:[n.jsx("svg",{className:"w-16 h-16 text-yellow-400 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})}),n.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:((et=(Qe=(Je=(Ze=Y[d])==null?void 0:Ze.gallery)==null?void 0:Je.mobile)==null?void 0:Qe.mobileNotice)==null?void 0:et.title)||(d==="zh"?"ç§»åŠ¨ç«¯ä½“éªŒæç¤º":"Mobile Experience Notice")}),n.jsx("p",{className:"text-white/80 leading-relaxed",children:((st=(nt=(it=(tt=Y[d])==null?void 0:tt.gallery)==null?void 0:it.mobile)==null?void 0:nt.mobileNotice)==null?void 0:st.description)||(d==="zh"?"3D ç”»å»Šé‡‡ç”¨ç¬¬ä¸€äººç§°æ¼«æ¸¸æŠ€æœ¯ï¼Œéœ€è¦é”®ç›˜å’Œé¼ æ ‡æ“ä½œï¼Œç§»åŠ¨ç«¯ä½“éªŒå¯èƒ½ä¸ä½³ã€‚å»ºè®®ä½¿ç”¨æ¡Œé¢è®¾å¤‡ä»¥è·å¾—æœ€ä½³æµè§ˆæ•ˆæœã€‚":"The 3D gallery uses first-person navigation technology requiring keyboard and mouse controls. For the best experience, Hua recommend using a desktop device.")})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("button",{onClick:()=>{he(!1),pe(!0)},className:"w-full bg-theme-primary/20 hover:bg-theme-primary/30 text-theme-primary border border-theme-primary/30 hover:border-theme-primary/50 py-3 px-6 rounded-lg transition-all duration-300",children:((lt=(rt=(at=(ot=Y[d])==null?void 0:ot.gallery)==null?void 0:at.mobile)==null?void 0:rt.mobileNotice)==null?void 0:lt.viewGallery)||(d==="zh"?"ç»§ç»­æµè§ˆå›¾ç‰‡é›†":"View Image Gallery")}),n.jsx("p",{className:"text-white/60 text-sm",children:((mt=(dt=(ht=(ct=Y[d])==null?void 0:ct.gallery)==null?void 0:ht.mobile)==null?void 0:dt.mobileNotice)==null?void 0:mt.desktopHint)||(d==="zh"?"æˆ–åœ¨æ¡Œé¢è®¾å¤‡ä¸Šä½“éªŒå®Œæ•´çš„ 3D ç”»å»Š":"Or visit on desktop for the full 3D gallery experience")})]})]})}),C&&ie&&n.jsx(Yt,{language:d}),!C&&n.jsxs("section",{id:"gallery",className:"min-h-screen flex flex-col justify-center items-center bg-gray-100 relative overflow-hidden",children:[(e||!s)&&n.jsx(Vt,{size:160,strokeWidth:12,showMask:!0,maskColor:"black-solid"}),n.jsx("div",{ref:fe,className:`w-full h-screen relative bg-gray-200 ${e||!s?"invisible":"visible"}`,style:{minHeight:"100vh"}}),n.jsxs("div",{className:`absolute bottom-6 left-6 bg-black/50 backdrop-blur-md rounded-xl p-4 text-white z-20 max-w-sm transition-all duration-1000 ${!e&&s&&g&&!ne?"opacity-100 translate-y-0":"opacity-0 translate-y-4 pointer-events-none"}`,children:[n.jsx("p",{className:"text-lg font-medium mb-3",children:((ft=(pt=(ut=(gt=Y[d])==null?void 0:gt.gallery)==null?void 0:ut.gallery3D)==null?void 0:pt.instructions)==null?void 0:ft.howToPlay)||(d==="zh"?"å¦‚ä½•æ“ä½œï¼Ÿ":"How to Play?")}),n.jsxs("div",{className:"space-y-3 text-sm",children:[n.jsxs("p",{className:"flex items-center",children:[n.jsx("span",{className:"w-2"}),((bt=(wt=(xt=(yt=Y[d])==null?void 0:yt.gallery)==null?void 0:xt.gallery3D)==null?void 0:wt.instructions)==null?void 0:bt.clickToEnter)||(d==="zh"?"ç‚¹å‡»è¿›å…¥é•¿å»Š":"Click to enter the gallery")]}),n.jsxs("p",{className:"flex items-center",children:[n.jsx("span",{className:"w-2"}),((Mt=(kt=(St=(vt=Y[d])==null?void 0:vt.gallery)==null?void 0:St.gallery3D)==null?void 0:kt.instructions)==null?void 0:Mt.mouseControl)||(d==="zh"?"é¼ æ ‡ - ç¯è§†å‘¨å›´ï¼Œæ¢ç´¢ç”»ä½œ":"Mouse - Look around and explore")]}),n.jsxs("p",{className:"flex items-center",children:[n.jsx("span",{className:"w-2"}),n.jsxs("span",{className:"inline-flex items-center gap-1 mr-2",children:[n.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"W"}),n.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"A"}),n.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"S"}),n.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"D"})]}),n.jsx("span",{children:((At=(It=(Pt=(Lt=Y[d])==null?void 0:Lt.gallery)==null?void 0:Pt.gallery3D)==null?void 0:It.instructions)==null?void 0:At.keyboardControl)||(d==="zh"?"ç§»åŠ¨ç©¿è¡Œé•¿å»Š":"Move through the gallery")})]}),n.jsxs("p",{className:"flex items-center",children:[n.jsx("span",{className:"w-2"}),n.jsx("span",{className:"inline-flex items-center px-2 py-0.5 mr-2 bg-white/20 rounded text-xs font-mono border border-white/30",children:"ESC"}),n.jsx("span",{children:((Et=(Ct=(jt=(zt=Y[d])==null?void 0:zt.gallery)==null?void 0:jt.gallery3D)==null?void 0:Ct.instructions)==null?void 0:Et.escapeControl)||(d==="zh"?"é€€å‡ºæŒ‡é’ˆé”å®šæ¨¡å¼":"Exit pointer lock mode")})]})]})]}),n.jsx("div",{className:`absolute inset-0 flex items-center justify-center cursor-pointer z-10 transition-all duration-1000 ${!e&&s&&g&&!ne?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,onClick:()=>{var z;if(!e&&s&&g&&!ne)if((z=m.current)!=null&&z.lock)try{m.current.lock(),setTimeout(()=>{ne||(console.log("Fallback: manually setting pointer locked state"),ee(!0))},100)}catch(me){console.log("Pointer lock failed, using fallback:",me.message),ee(!0)}else ee(!0)},children:n.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center transition-all duration-300 border border-white/20 hover:bg-white/20 hover:scale-105",children:[n.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:((Nt=($t=(Wt=Y[d])==null?void 0:Wt.gallery)==null?void 0:$t.gallery3D)==null?void 0:Nt.title)||"æµ®ç”Ÿé•¿å»Š"}),n.jsx("p",{className:"text-white/80 mb-6",children:((Dt=(Ht=(Tt=(Rt=Y[d])==null?void 0:Rt.gallery)==null?void 0:Tt.gallery3D)==null?void 0:Ht.instructions)==null?void 0:Dt.clickToStart)||"ç‚¹å‡»è¿›å…¥"}),n.jsx("div",{className:"animate-bounce",children:n.jsxs("svg",{className:"w-8 h-8 text-white mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})}),ne&&n.jsx(n.Fragment,{children:n.jsxs("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-20",children:[n.jsx("div",{className:"w-2 h-2 bg-white rounded-full shadow-lg border border-white/30"}),n.jsx("div",{className:"absolute w-6 h-0.5 bg-white/60 rounded shadow-sm"}),n.jsx("div",{className:"absolute w-0.5 h-6 bg-white/60 rounded shadow-sm"}),n.jsx("div",{className:"absolute w-8 h-8 border border-white/20 rounded-full"})]})})]})]})};Xt.propTypes={language:we.string};const Mi=Object.freeze(Object.defineProperty({__proto__:null,default:Xt},Symbol.toStringTag,{value:"Module"}));export{Vt as C,Mi as G,gi as P,ui as u};
