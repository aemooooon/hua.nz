const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/three-Bc0g6PSw.js","assets/vendor-Bn9U8WJN.js","assets/d3-BbFmVfHF.js","assets/vendor-DSulWsr7.css"])))=>i.map(i=>d[i]);
import{r as M,j as i}from"./react-n2EiWjuo.js";import{P as be}from"./vendor-Bn9U8WJN.js";import{C as Ge,S as _e,a as re,b as qe,T as gt,c as ut,M as ie,P as rt,D as $e,d as Re,R as Ie,e as pt,f as ft,g as it,L as yt,h as xt,i as wt,O as bt,W as vt,j as St,k as Oe,l as kt,m as Ke,B as ae,n as Ue,o as We,p as Pe,F as He,V as nt,q as De,r as Mt,G as st,s as ot,t as Ve,u as at}from"./three-Bc0g6PSw.js";import{u as ve,_ as Lt}from"./about-B57KrMgB.js";import{t as Se}from"./texture-system-IP6rrmUB.js";const Pt=M.createContext(),It=()=>{const I=M.useContext(Pt);if(!I)throw new Error("usePhotoSwipe must be used within a PhotoSwipeProvider");return I},Ye=({size:I=80,showMask:e=!0,maskColor:t="black-glass",className:s="",onMaskClick:r=null})=>{const{getText:m}=ve(),u=m("ui.loading"),z=typeof window<"u"?window.matchMedia("(prefers-reduced-motion: reduce)").matches:!1,Y=()=>{switch(t){case"black-solid":return"absolute inset-0 bg-black";case"black-glass":return"absolute inset-0 bg-black/80 backdrop-blur-sm";case"default":default:return"absolute inset-0 bg-black/40 backdrop-blur-lg backdrop-saturate-150"}},ee=({className:ne=""})=>i.jsxs("div",{className:`relative ${ne}`,style:{width:I,height:I},children:[i.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`radial-gradient(circle,
                            rgba(var(--theme-primary-rgb), 0.9) 0%,
                            rgba(var(--theme-primary-rgb), 0.7) 15%,
                            rgba(var(--theme-primary-rgb), 0.5) 35%,
                            rgba(var(--theme-primary-rgb), 0.3) 55%,
                            rgba(var(--theme-primary-rgb), 0.15) 75%,
                            rgba(var(--theme-primary-rgb), 0.05) 90%,
                            transparent 100%
                        )`,boxShadow:`
                            0 0 ${I*.5}px rgba(var(--theme-primary-rgb), 0.6),
                            0 0 ${I*.8}px rgba(var(--theme-primary-rgb), 0.4),
                            0 0 ${I*1.2}px rgba(var(--theme-primary-rgb), 0.2)
                        `,animation:z?"none":"optimized-breathing-glow 2.5s ease-in-out infinite"}}),i.jsx("div",{className:"absolute inset-0 rounded-full pointer-events-none",style:{background:`conic-gradient(
                            from 0deg,
                            transparent 0deg,
                            rgba(var(--theme-primary-rgb), 0.1) 15deg,
                            rgba(var(--theme-primary-rgb), 0.4) 35deg,
                            rgba(var(--theme-primary-rgb), 0.8) 45deg,
                            rgba(var(--theme-primary-rgb), 0.6) 55deg,
                            rgba(var(--theme-primary-rgb), 0.2) 75deg,
                            transparent 90deg,
                            transparent 360deg
                        )`,animation:z?"none":"rotate-glow 3s linear infinite",filter:"blur(0.5px)",mixBlendMode:"screen"}}),i.jsx("div",{className:"absolute inset-0 rounded-full pointer-events-none",style:{background:`conic-gradient(
                            from 180deg,
                            transparent 0deg,
                            rgba(var(--theme-primary-rgb), 0.15) 25deg,
                            rgba(var(--theme-primary-rgb), 0.3) 50deg,
                            rgba(var(--theme-primary-rgb), 0.15) 75deg,
                            transparent 100deg,
                            transparent 360deg
                        )`,animation:z?"none":"rotate-glow 4s linear infinite reverse",filter:"blur(1px)",mixBlendMode:"screen"}}),i.jsx("div",{className:"absolute rounded-full transform -translate-x-1/2 -translate-y-1/2",style:{width:I*.08,height:I*.08,top:"50%",left:"50%",backgroundColor:"var(--theme-primary)",boxShadow:`
                            0 0 ${I*.08}px rgba(var(--theme-primary-rgb), 0.8),
                            0 0 ${I*.15}px rgba(var(--theme-primary-rgb), 0.4)
                        `,animation:z?"none":"breathing-glow 1.8s ease-in-out infinite"}}),i.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",style:{zIndex:30},children:i.jsx("span",{className:"text-lg font-medium",style:{color:"white",textShadow:"0 0 8px rgba(255, 255, 255, 0.6)"},children:u})})]});return e?i.jsxs("div",{className:`fixed inset-0 z-50 flex items-center justify-center ${s}`,onClick:r,style:{overflow:"visible"},children:[i.jsx("div",{className:Y()}),i.jsx("div",{className:"relative z-10 flex flex-col items-center",children:i.jsx(ee,{})})]}):i.jsx(ee,{className:s})};Ye.propTypes={size:be.number,showMask:be.bool,maskColor:be.oneOf(["black-glass","black-solid","default"]),className:be.string,onMaskClick:be.func};const lt=({language:I="zh"})=>{var ke;const e=ve(p=>p.getAllGalleryItems()),{getNewContent:t}=ve(),r=t().gallery,{openPhotoSwipe:m}=It(),u=M.useRef(null),[z,Y]=M.useState(new Map),[ee,ne]=M.useState(!0),[le,ye]=M.useState(0),[J,Ae]=M.useState(0),he=M.useMemo(()=>Array.isArray(e)?e.filter(p=>p.type!=="video"):[],[e]),R=async p=>{try{if(!p||p.match(/\.(mp4|webm|mov|avi|mkv)$/i)||!p.match(/\.(jpg|jpeg|png|webp|avif)$/i))return p;const W=p.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,"");return await Se.getOptimalPath(W,"gallery")}catch(W){return console.warn("ç§»åŠ¨ç«¯å›¾ç‰‡æ ¼å¼ä¼˜åŒ–å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹è·¯å¾„:",W),p}},ue=p=>new Promise((W,N)=>{const x=new Image;x.onload=()=>W(p),x.onerror=()=>N(new Error(`Failed to load image: ${p}`)),x.src=p}),te=M.useCallback(async p=>{Ae(p.length),ye(0);const W=p.map(async N=>{try{return await ue(N),ye(x=>x+1),N}catch(x){return console.warn(`å›¾ç‰‡åŠ è½½å¤±è´¥: ${N}`,x),ye(ce=>ce+1),null}});await Promise.allSettled(W),ne(!1)},[]);M.useEffect(()=>{(async()=>{if(he.length===0){ne(!1);return}console.log("ğŸ“± å¼€å§‹åŠ è½½ç§»åŠ¨ç«¯ç”»å»Š...");try{console.log("ğŸ” æ­£åœ¨ä¼˜åŒ–å›¾ç‰‡è·¯å¾„...");const W=new Map;for(const x of he){const ce=await R(x.src),Fe=x.thumbnail?await R(x.thumbnail):ce;W.set(x.id,{src:ce,thumbnail:Fe})}Y(W),console.log("ğŸš€ å¼€å§‹æ‰¹é‡åŠ è½½å›¾ç‰‡...");const N=Array.from(W.values()).map(x=>x.thumbnail);await te(N),console.log("âœ… æ‰€æœ‰å›¾ç‰‡åŠ è½½å®Œæˆï¼")}catch(W){console.warn("âŒ ç”»å»ŠåŠ è½½å¤±è´¥:",W),ne(!1)}})()},[he,te]);const pe=he.map((p,W)=>{const N=z.get(p.id);return{id:p.id||W,src:(N==null?void 0:N.src)||p.src,thumbnail:(N==null?void 0:N.thumbnail)||p.thumbnail||p.src,title:p.title||"",description:p.description||""}}),X=p=>{m(pe,p)};return i.jsxs(i.Fragment,{children:[ee&&i.jsx("div",{className:"fixed inset-0 bg-black/95 z-50 flex items-center justify-center",children:i.jsxs("div",{className:"text-center max-w-sm mx-auto px-6",children:[i.jsx(Ye,{size:140,strokeWidth:10,showMask:!1}),i.jsxs("div",{className:"mt-6 space-y-3",children:[i.jsx("h3",{className:"text-white text-lg font-medium",children:((ke=r.mobile.loading)==null?void 0:ke[I])||"åŠ è½½ç”»å»Šå›¾ç‰‡..."}),J>0&&i.jsxs("div",{className:"space-y-2",children:[i.jsx("div",{className:"w-full bg-white/20 rounded-full h-2",children:i.jsx("div",{className:"bg-gradient-to-r from-blue-400 to-purple-400 h-2 rounded-full transition-all duration-300",style:{width:`${le/J*100}%`}})}),i.jsxs("p",{className:"text-white/70 text-sm",children:[le," / ",J," å¼ å›¾ç‰‡å·²åŠ è½½"]})]}),i.jsx("p",{className:"text-white/60 text-xs leading-relaxed",children:"ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰å›¾ç‰‡ä»¥ç¡®ä¿æµç•…ä½“éªŒ"})]})]})}),i.jsx("style",{children:`
                /* ğŸŒ Galleryå®¹å™¨ - ä¸SmartScrollManageré›†æˆ */
                .gallery-mobile-container {
                    /* ä½œä¸ºé•¿å†…å®¹é¡µé¢ï¼Œé…åˆSmartScrollManageræ­£ç¡®è®¡ç®—æ»šåŠ¨é«˜åº¦ */
                    position: relative;
                    width: 100%;
                    min-height: 100vh;
                    overflow: visible;

                    /* èƒŒæ™¯å’Œä¸»é¢˜ */
                    background: linear-gradient(135deg, #0f0f23 0%, #1a1a3a 50%, #0f0f23 100%);

                    /* ç§»åŠ¨ç«¯å®‰å…¨åŒºåŸŸæ”¯æŒ */
                    /* ğŸ›¡ï¸ ç§»åŠ¨ç«¯å®‰å…¨åŒºåŸŸé€‚é… */
                    padding-top: max(2rem, env(safe-area-inset-top));
                    padding-bottom: max(4rem, env(safe-area-inset-bottom));
                    padding-left: max(1rem, env(safe-area-inset-left));
                    padding-right: max(1rem, env(safe-area-inset-right));

                    /* ğŸš« é˜²æ­¢æ„å¤–é€‰æ‹© */
                    -webkit-user-select: none;
                    user-select: none;

                    /* âœ‹ ä¼˜åŒ–è§¦æ‘¸äº¤äº’ */
                    touch-action: manipulation;
                }

                /* ğŸ–¼ï¸ å›¾ç‰‡é¡¹ç›®äº¤äº’ä¼˜åŒ– */
                .gallery-image-item {
                    position: relative;
                    cursor: pointer;
                    transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
                    touch-action: manipulation;
                    -webkit-user-select: none;
                    user-select: none;
                }

                /* ğŸ¯ æ‚¬åœæ•ˆæœï¼ˆä¸»è¦é’ˆå¯¹æ¡Œé¢ç«¯é¢„è§ˆï¼‰ */
                .gallery-image-item:hover {
                    transform: scale(1.02);
                    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
                }

                /* ğŸ“± è§¦æ‘¸åé¦ˆ */
                .gallery-image-item:active {
                    transform: scale(0.98);
                }

                /* ğŸ® ç§»åŠ¨ç«¯ç‰¹æ®Šä¼˜åŒ– */
                @media (max-width: 768px) {
                    .gallery-mobile-container {
                        padding-top: max(3rem, calc(env(safe-area-inset-top) + 2rem));
                        padding-bottom: max(6rem, calc(env(safe-area-inset-bottom) + 4rem));
                    }

                    .gallery-image-item img {
                        will-change: auto;
                        transform: translateZ(0);
                        image-rendering: -webkit-optimize-contrast;
                        image-rendering: crisp-edges;
                    }

                    /* ğŸ“± ç§»åŠ¨ç«¯è§¦æ‘¸åé¦ˆæ›´æ˜æ˜¾ */
                    .gallery-image-item:active {
                        transform: scale(0.95);
                        transition: transform 0.1s ease-out;
                    }
                }
            `}),!ee&&i.jsxs("div",{ref:u,className:"gallery-mobile-container w-full relative",children:[i.jsxs("div",{className:"text-center mb-12 px-4",children:[i.jsx("h2",{className:"text-4xl md:text-5xl font-bold text-white mb-6 tracking-wide",children:r.mobile.title[I]||r.mobile.title.en}),i.jsx("p",{className:"text-white/70 max-w-2xl mx-auto leading-relaxed text-lg",children:r.mobile.subtitle[I]||r.mobile.subtitle.en}),i.jsx("div",{className:"mt-8 flex justify-center",children:i.jsx("div",{className:"w-24 h-0.5 bg-gradient-to-r from-transparent via-white/50 to-transparent"})})]}),i.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[i.jsx("div",{className:"grid grid-cols-3 gap-2 sm:gap-3 md:gap-4 pb-20",children:pe.map((p,W)=>{const N=z.get(p.id),x=(N==null?void 0:N.thumbnail)||(N==null?void 0:N.src);return i.jsx("div",{onClick:()=>X(W),className:"gallery-image-item group project-card cursor-pointer",children:i.jsx("div",{className:"relative aspect-square rounded-xl overflow-hidden bg-white/5 shadow-lg hover:shadow-2xl transition-all duration-300 border border-white/10",children:x?i.jsx("img",{src:x,alt:`Gallery item ${W+1}`,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110",loading:"lazy",onError:ce=>{console.warn(`ğŸ“± ä¼˜åŒ–å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå›é€€åˆ°åŸå§‹å›¾ç‰‡: ${p.id}`),ce.target.src=p.thumbnail||p.src}}):i.jsx("div",{className:"w-full h-full flex items-center justify-center bg-white/5",children:i.jsx("div",{className:"w-8 h-8 border-2 border-white/30 border-t-white rounded-full animate-spin"})})})},p.id)})}),pe.length===0&&i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"w-16 h-16 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-4",children:i.jsx("svg",{className:"w-8 h-8 text-white/50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),i.jsx("div",{className:"text-white/70 text-lg mb-2",children:r.mobile.noContent[I]||r.mobile.noContent.en}),i.jsx("div",{className:"text-white/50 text-sm",children:r.mobile.tryAgain[I]||r.mobile.tryAgain.en})]}),i.jsx("div",{className:"pb-safe-area-inset-bottom",style:{paddingBottom:"max(4rem, env(safe-area-inset-bottom))"}})]})]})]})};lt.propTypes={language:be.string};class At{constructor(e,t,s={}){this.scene=e,this.renderer=t,this.spotlights=[],this.animationId=null,this.config={lightCount:s.lightCount||4,ceilingHeight:s.ceilingHeight||10,positions:[{x:-36,y:10,z:0},{x:36,y:10,z:0},{x:0,y:10,z:-24}],targets:[{x:-32,y:1,z:0},{x:32,y:1,z:0},{x:0,y:1,z:-20}],intensity:s.intensity||3500,distance:s.distance||70,angle:s.angle||Math.PI/2,penumbra:s.penumbra||.3,colors:[16711744,65416,65535],enableAnimation:s.enableAnimation!==!1,animationSpeed:s.animationSpeed||.5,showHelpers:s.showHelpers||!1},this.clock=new Ge,this.init()}async init(){try{await this.createSpotlights(),this.config.enableAnimation&&this.startAnimation(),console.log("âœ¨ IESèšå…‰ç¯ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ")}catch(e){console.warn("âš ï¸ IESèšå…‰ç¯åˆå§‹åŒ–å¤±è´¥ï¼Œä½¿ç”¨æ ‡å‡†èšå…‰ç¯:",e),this.createStandardSpotlights()}}async createSpotlights(){let e=null;try{e=(await Lt(()=>import("./three-Bc0g6PSw.js").then(s=>s.a8),__vite__mapDeps([0,1,2,3]))).IESSpotLight}catch(t){console.log("ğŸ¯ IESSpotLightä¸å¯ç”¨:",t.message)}e&&this.renderer.isWebGPURenderer?(console.log("ğŸ¯ ä½¿ç”¨IESèšå…‰ç¯ (WebGPU)"),await this.createIESSpotlights(e)):(console.log("ğŸ¯ ä½¿ç”¨æ ‡å‡†èšå…‰ç¯ï¼ˆé™çº§æ–¹æ¡ˆï¼‰"),this.createStandardSpotlights())}async createIESSpotlights(e){for(let t=0;t<this.config.lightCount;t++){const s=this.config.positions[t],r=this.config.targets[t],m=this.config.colors[t%this.config.colors.length],u=new e(m,this.config.intensity);if(u.position.set(s.x,s.y,s.z),u.angle=this.config.angle,u.penumbra=this.config.penumbra,u.distance=this.config.distance,u.castShadow=!0,u.shadow.mapSize.width=2048,u.shadow.mapSize.height=2048,u.shadow.camera.near=.5,u.shadow.camera.far=this.config.distance,u.shadow.bias=-1e-4,u.shadow.normalBias=.02,u.target.position.set(r.x,r.y,r.z),this.scene.add(u),this.scene.add(u.target),this.config.showHelpers){const Y=new _e(u);u.userData.helper=Y,this.scene.add(Y)}const z={light:u,originalPosition:{...s},originalTarget:{...r},originalIntensity:this.config.intensity,originalColor:new re(m),animationPhase:t*Math.PI*.5,index:t};this.spotlights.push(z),console.log(`ğŸ’¡ åˆ›å»ºIESèšå…‰ç¯ ${t+1}: ä½ç½®(${s.x}, ${s.y}, ${s.z}) -> ç›®æ ‡(${r.x}, ${r.y}, ${r.z})`)}}createStandardSpotlights(){for(let e=0;e<this.config.lightCount;e++){const t=this.config.positions[e],s=this.config.targets[e],r=this.config.colors[e%this.config.colors.length],m=new qe(r,this.config.intensity,this.config.distance,this.config.angle,this.config.penumbra);if(m.position.set(t.x,t.y,t.z),m.castShadow=!0,m.shadow.mapSize.width=2048,m.shadow.mapSize.height=2048,m.shadow.camera.near=.5,m.shadow.camera.far=this.config.distance,m.shadow.bias=-1e-4,m.shadow.normalBias=.02,m.target.position.set(s.x,s.y,s.z),this.scene.add(m),this.scene.add(m.target),this.config.showHelpers){const z=new _e(m);m.userData.helper=z,this.scene.add(z)}const u={light:m,originalPosition:{...t},originalTarget:{...s},originalIntensity:this.config.intensity,originalColor:new re(r),animationPhase:e*Math.PI*.5,index:e};this.spotlights.push(u),console.log(`ğŸ’¡ åˆ›å»ºæ ‡å‡†èšå…‰ç¯ ${e+1}: ä½ç½®(${t.x}, ${t.y}, ${t.z}) -> ç›®æ ‡(${s.x}, ${s.y}, ${s.z})`)}}startAnimation(){const e=()=>{this.config.enableAnimation&&(this.updateAnimation(),this.animationId=requestAnimationFrame(e))};e()}updateAnimation(){const e=this.clock.getElapsedTime()*this.config.animationSpeed;this.spotlights.forEach((t,s)=>{const{light:r,originalTarget:m,animationPhase:u}=t,z=e+u,Y=2,ee=m.x+Math.sin(z*.8)*Y*.3,ne=m.z+Math.cos(z*.6)*Y*.3,le=m.y+Math.sin(z*.4)*.5;r.target.position.x=ee,r.target.position.y=le,r.target.position.z=ne;const ye=.9,J=Math.sin(z*1.2+s*.5)*.2;r.intensity=t.originalIntensity*(ye+J);const Ae=Math.sin(z*.8+s*.6)*.3,he={};t.originalColor.getHSL(he);const R=(he.h+Ae+e*.1)%1,ue=Math.max(.7,he.s+Math.sin(z*1.5)*.3),te=Math.max(.4,Math.min(.8,he.l+Math.sin(z*2)*.2)),pe=new re().setHSL(R,ue,te);r.color.copy(pe);const X=Math.sin(z*.5+s*.3)*.02;r.angle=this.config.angle+X,r.userData.helper&&r.userData.helper.update()})}setIntensity(e){this.config.intensity=e,this.spotlights.forEach(t=>{t.originalIntensity=e,t.light.intensity=e})}setAnimationSpeed(e){this.config.animationSpeed=e}toggleHelpers(){this.config.showHelpers=!this.config.showHelpers,this.spotlights.forEach(e=>{const{light:t}=e;if(this.config.showHelpers){if(!t.userData.helper){const s=new _e(t);t.userData.helper=s,this.scene.add(s)}t.userData.helper.visible=!0}else t.userData.helper&&(t.userData.helper.visible=!1)})}toggleAnimation(){this.config.enableAnimation=!this.config.enableAnimation,this.config.enableAnimation?this.startAnimation():this.stopAnimation()}stopAnimation(){this.config.enableAnimation=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}getStatus(){return{lightCount:this.config.lightCount,intensity:this.config.intensity,enableAnimation:this.config.enableAnimation,showHelpers:this.config.showHelpers,animationSpeed:this.config.animationSpeed}}dispose(){this.stopAnimation(),this.spotlights.forEach(e=>{const{light:t}=e;t&&(this.scene.remove(t),this.scene.remove(t.target),t.userData.helper&&this.scene.remove(t.userData.helper))}),this.spotlights=[],console.log("ğŸ§¹ IESèšå…‰ç¯ç³»ç»Ÿå·²æ¸…ç†")}}class zt{generatePositionsFromGallery(){return null}extractBaseName(e){return e?e.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,""):null}constructor(e,t={},s=[]){this.scene=e,this.galleryData=s,this.lightCylinders=[],this.animationId=null,this.textureLoader=new gt,this.roomConfig={floorY:-2,ceilingY:8,height:10},this.config={radius:t.radius||.5,height:this.roomConfig.height,radialSegments:t.radialSegments||32,heightSegments:t.heightSegments||1,cubeWidth:t.cubeWidth||1,cubeHeight:t.cubeHeight||8,cubeDepth:t.cubeDepth||1,cubeCount:t.cubeCount||3,enableTexture:t.enableTexture!==!1,textureUrl:t.textureUrl||null,textureDelay:t.textureDelay||1e3,baseColor:t.baseColor||16711744,enableGlow:t.enableGlow!==!1,glowIntensity:t.glowIntensity||.7,emissiveIntensity:t.emissiveIntensity||.3,positions:[{x:-5,z:18,color:65535,textureBaseName:null},{x:5,z:18,color:16711744,textureBaseName:null},{x:0,z:-18,color:65416,textureBaseName:"gallery-horizontal-11",radius:1.2,rotationY:Math.PI/1.5}],intensity:t.intensity||20,lightIntensity:t.lightIntensity||20,lightDistance:t.lightDistance||80,enableAnimation:t.enableAnimation!==!1,animationSpeed:t.animationSpeed||.001,colors:[65535,16711744,65416]},this.clock=new Ge,this.lightCubes=this.lightCylinders}async init(){console.log("ğŸ›ï¸ åˆå§‹åŒ–å‘å…‰åœ†æŸ±ä½“ç³»ç»Ÿï¼ˆä»åœ°æ¿åˆ°å¤©èŠ±æ¿ï¼‰..."),await this.preloadTextures(),this.createLightCylinders(),this.config.enableAnimation&&this.startAnimation()}async preloadTextures(){try{console.log("â© è·³è¿‡çº¹ç†é¢„åŠ è½½ï¼Œä½¿ç”¨æŒ‰éœ€åŠ è½½ç­–ç•¥")}catch(e){console.warn("âš ï¸ çº¹ç†é¢„åŠ è½½å¤±è´¥ï¼Œå°†ä½¿ç”¨åŸå§‹è·¯å¾„:",e)}}createLightCubes(){this.createLightCylinders()}createLightCylinders(){this.config.positions.forEach((e,t)=>{this.createSingleLightCylinder(e,t)}),console.log(`âœ… æ‰€æœ‰ ${this.config.positions.length} ä¸ªå‘å…‰åœ†æŸ±ä½“åˆ›å»ºå®Œæˆï¼ˆçº¹ç†å°†å»¶è¿ŸåŠ è½½ï¼‰`)}createSingleLightCube(e,t,s,r){const m={x:e,z:s,color:this.config.colors[r]||this.config.baseColor,textureBaseName:null};this.createSingleLightCylinder(m,r)}createSingleLightCylinder(e,t){const s={position:{x:e.x,y:2,z:e.z},mesh:null,light:null,index:t,config:e},r=e.radius||this.config.radius,m=this.config.height-.05,u=new ut(r,r,m,this.config.radialSegments,this.config.heightSegments),z=this.createCylinderMaterial(e,t),Y=new ie(u,z),ee=(this.roomConfig.floorY+this.roomConfig.ceilingY)/2;if(Y.position.set(e.x,ee,e.z),e.rotationY!==void 0&&(Y.rotation.y=e.rotationY,console.log(`ğŸ”„ æŸ±å­ç»•Yè½´æ—‹è½¬: ${(e.rotationY*180/Math.PI).toFixed(1)}åº¦`)),this.scene.add(Y),s.mesh=Y,s.position.y=ee,this.config.enableGlow){const le=new rt(e.color,this.config.lightIntensity,this.config.lightDistance);le.position.set(e.x,ee,e.z),this.scene.add(le),s.light=le}s.originalColor=new re(e.color),s.originalIntensity=this.config.lightIntensity,s.animationPhase=t*Math.PI*.6,this.lightCylinders.push(s);const ne=["Lightboxå‰å·¦ä¾§æŸ±å­(32ç±³å¢™çš„1/3ä½ç½®ï¼Œçº¦-10.67ç±³) - é’è‰²ä¸»é¢˜","Lightboxå‰å³ä¾§æŸ±å­(32ç±³å¢™çš„2/3ä½ç½®ï¼Œçº¦10.67ç±³) - çº¢è‰²ä¸»é¢˜","æ‘„åƒæœºèƒŒåç»¿è‰²æŸ±å­(ä»åœ°æ¿åˆ°å¤©èŠ±æ¿ï¼Œé»„é‡‘æ¯”ä¾‹ç›´å¾„) - ç»¿è‰²ä¸»é¢˜"];console.log(`ğŸ›ï¸ åˆ›å»ºå‘å…‰åœ†æŸ±ä½“ ${t+1}: ${ne[t]} ä½ç½®(${e.x}, ${ee}, ${e.z}), é«˜åº¦${this.config.height}ç±³, åŠå¾„${r}ç±³, ç›´å¾„${(r*2).toFixed(3)}ç±³`),e.textureUrl&&console.log(`ğŸ–¼ï¸ åœ†æŸ±ä½“ ${t+1} åº”ç”¨è´´å›¾: ${e.textureUrl}`)}createCylinderMaterial(e,t){const s=e.color||this.config.baseColor,r=e.textureBaseName||this.config.textureBaseName;let m={transparent:!0,opacity:.9,side:$e};m={...m,color:s,emissive:new re(s).multiplyScalar(this.config.emissiveIntensity)};const u=new Re(m);return r&&this.config.enableTexture&&setTimeout(async()=>{try{console.log(`ğŸ–¼ï¸ å»¶è¿ŸåŠ è½½åœ†æŸ±ä½“ ${t+1} çš„çº¹ç†: ${r}`);const z=await this.loadGalleryTexture(r);z.repeat.set(1,1),u.map=z,u.color=new re(1,1,1),u.needsUpdate=!0,console.log(`âœ… åœ†æŸ±ä½“ ${t+1} çº¹ç†åŠ è½½å®Œæˆ: ${r}`)}catch(z){console.warn(`âŒ åœ†æŸ±ä½“ ${t+1} çº¹ç†åŠ è½½å¤±è´¥: ${r}`,z)}},this.config.textureDelay||2e3),u}setTexture(e,t){if(e>=0&&e<this.lightCylinders.length){const s=this.lightCylinders[e];if(t){console.log(`ğŸ–¼ï¸ ä¸ºåœ†æŸ±ä½“ ${e+1} è®¾ç½®æ–°è´´å›¾: ${t}`);const r=this.textureLoader.load(t);r.wrapS=Ie,r.wrapT=Ie,r.repeat.set(1,1);const m=new Re({map:r,transparent:!0,opacity:.9,emissive:new re(s.config.color).multiplyScalar(this.config.emissiveIntensity),side:$e});s.mesh&&s.mesh.material&&(s.mesh.material.dispose(),s.mesh.material=m),console.log(`âœ… åœ†æŸ±ä½“ ${e+1} è´´å›¾å·²åº”ç”¨ï¼Œç…§æ˜åŠŸèƒ½ä¿æŒæ­£å¸¸`)}else{console.log(`ğŸ”„ ç§»é™¤åœ†æŸ±ä½“ ${e+1} çš„è´´å›¾ï¼Œæ¢å¤å‘å…‰æ•ˆæœ`);const r=new Re({color:s.config.color,transparent:!0,opacity:.9,emissive:new re(s.config.color).multiplyScalar(this.config.emissiveIntensity),side:$e});s.mesh&&s.mesh.material&&(s.mesh.material.dispose(),s.mesh.material=r)}}}startAnimation(){const e=()=>{this.config.enableAnimation&&(this.updateAnimation(),this.animationId=requestAnimationFrame(e))};e()}updateAnimation(){const e=this.clock.getElapsedTime();this.lightCylinders.forEach(t=>{if(t.light){const s=Math.sin(e*this.config.animationSpeed*1e3+t.animationPhase)*.3+.7;t.light.intensity=t.originalIntensity*s;const r=Math.sin(e*this.config.animationSpeed*500+t.animationPhase)*.1,m={};t.originalColor.getHSL(m),m.h=(m.h+r)%1;const u=new re().setHSL(m.h,m.s,m.l);t.light.color.copy(u),t.mesh&&t.mesh.material&&(t.mesh.material.map||(t.mesh.material.color.copy(u),t.mesh.material.emissive&&t.mesh.material.emissive.copy(u.clone().multiplyScalar(this.config.emissiveIntensity))))}})}stopAnimation(){this.config.enableAnimation=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}setIntensity(e){this.setLightIntensity(e)}setLightIntensity(e){this.config.lightIntensity=e,this.config.intensity=e,this.lightCylinders.forEach(t=>{t.originalIntensity=e,t.light&&(t.light.intensity=e)})}toggleAnimation(){this.config.enableAnimation=!this.config.enableAnimation,this.config.enableAnimation?this.startAnimation():this.stopAnimation()}getStatus(){return{cylinderCount:this.lightCylinders.length,cubeCount:this.lightCylinders.length,lightIntensity:this.config.lightIntensity,intensity:this.config.intensity,enableAnimation:this.config.enableAnimation,enableTexture:this.config.enableTexture,radius:this.config.radius,height:this.config.height}}dispose(){this.stopAnimation(),this.lightCylinders.forEach(e=>{e.mesh&&(this.scene.remove(e.mesh),e.mesh.geometry&&e.mesh.geometry.dispose(),e.mesh.material&&e.mesh.material.dispose()),e.light&&this.scene.remove(e.light)}),this.lightCylinders=[],console.log("ğŸ›ï¸ å‘å…‰åœ†æŸ±ä½“ç³»ç»Ÿå·²æ¸…ç†")}getBestTexturePath(e){return!e||!e.startsWith("/gallery/")?e:e.split("/").pop().replace(".jpg","")}async loadGalleryTexture(e){if(!e)throw new Error("åŸºç¡€åç§°ä¸èƒ½ä¸ºç©º");try{console.log(`ğŸ–¼ï¸ ä½¿ç”¨textureSystemåŠ è½½Galleryçº¹ç†: ${e}`);const t=await Se.getCompressionInfo();console.log(`ğŸ¯ å½“å‰æµè§ˆå™¨æ”¯æŒæ ¼å¼: ${t.format} (${t.description})`);const s=await Se.loadTexture(e);return console.log(`âœ… Galleryçº¹ç†åŠ è½½æˆåŠŸ: ${e}`),s}catch(t){throw console.error(`âŒ Galleryçº¹ç†åŠ è½½å¤±è´¥: ${e}`,t),t}}}class jt{constructor(e,t={}){this.scene=e,this.rectLights=[],this.helpers=[],this.animationId=null,this.config={intensity:t.intensity||5,colors:t.colors||[16739179,5164484,4569041,16370212],showHelpers:t.showHelpers||!1,enableAnimation:t.enableAnimation!==!1,animationSpeed:t.animationSpeed||.001,lightWidth:t.lightWidth||6,lightHeight:t.lightHeight||8,positions:t.positions||[{x:-18,y:8,z:15,rx:0,ry:0,rz:0},{x:18,y:8,z:15,rx:0,ry:Math.PI,rz:0},{x:0,y:10,z:35,rx:-Math.PI/2,ry:0,rz:0},{x:0,y:10,z:-15,rx:-Math.PI/2,ry:Math.PI,rz:0}]},this.clock=new Ge,this.init()}init(){pt.init(),this.createRectAreaLights(),this.config.enableAnimation&&this.startAnimation()}createRectAreaLights(){this.config.positions.forEach((e,t)=>{const s=this.config.colors[t%this.config.colors.length],r=new ft(s,this.config.intensity,this.config.lightWidth,this.config.lightHeight);if(r.position.set(e.x,e.y,e.z),r.rotation.set(e.rx,e.ry,e.rz),this.scene.add(r),this.rectLights.push(r),this.config.showHelpers){const m=new it(r);this.scene.add(m),this.helpers.push(m)}r.userData={originalIntensity:this.config.intensity,originalColor:new re(s),animationPhase:t/this.config.positions.length*Math.PI*2,index:t}})}startAnimation(){const e=()=>{this.animationId=requestAnimationFrame(e),this.updateAnimation()};e()}updateAnimation(){const e=this.clock.getElapsedTime();this.rectLights.forEach((t,s)=>{const r=t.userData,m=Math.sin(e*this.config.animationSpeed*1e3+r.animationPhase);t.intensity=r.originalIntensity+m*2;const u=Math.sin(e*this.config.animationSpeed*500+r.animationPhase*2)*.1;switch(t.color.copy(r.originalColor),s){case 0:t.color.r=Math.max(.3,t.color.r+u);break;case 1:t.color.g=Math.max(.3,t.color.g+u),t.color.b=Math.max(.3,t.color.b+u);break;case 2:t.color.b=Math.max(.3,t.color.b+u);break;case 3:t.color.r=Math.max(.3,t.color.r+u),t.color.g=Math.max(.3,t.color.g+u);break}})}setIntensity(e){this.config.intensity=e,this.rectLights.forEach(t=>{t.userData.originalIntensity=e})}setAnimationSpeed(e){this.config.animationSpeed=e}toggleHelpers(){this.config.showHelpers=!this.config.showHelpers,this.config.showHelpers?this.rectLights.forEach(e=>{const t=new it(e);this.scene.add(t),this.helpers.push(t)}):(this.helpers.forEach(e=>{this.scene.remove(e)}),this.helpers=[])}setPreset(e){switch(e){case"warm":this.config.colors=[16739179,16370212,16752627,15620644],this.setIntensity(6),this.setAnimationSpeed(8e-4);break;case"cool":this.config.colors=[5164484,4569041,10837738,2547329],this.setIntensity(5),this.setAnimationSpeed(.0012);break;case"dramatic":this.config.colors=[16726072,3093826,16737096,8121759],this.setIntensity(8),this.setAnimationSpeed(.002);break;case"soft":this.config.colors=[16771751,14524637,10016968,16243823],this.setIntensity(3),this.setAnimationSpeed(5e-4);break}this.rectLights.forEach((t,s)=>{const r=this.config.colors[s%this.config.colors.length];t.userData.originalColor=new re(r)})}toggleAnimation(){this.config.enableAnimation=!this.config.enableAnimation,this.config.enableAnimation?this.startAnimation():(this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.rectLights.forEach(e=>{e.intensity=e.userData.originalIntensity,e.color.copy(e.userData.originalColor)}))}getStatus(){return{intensity:this.config.intensity,animationSpeed:this.config.animationSpeed,enableAnimation:this.config.enableAnimation,showHelpers:this.config.showHelpers,lightCount:this.rectLights.length}}dispose(){this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.rectLights.forEach(e=>{this.scene.remove(e)}),this.rectLights=[],this.helpers.forEach(e=>{this.scene.remove(e)}),this.helpers=[]}}const ct=({language:I="en"})=>{const[e,t]=M.useState(!0),[s,r]=M.useState(!1),[m,u]=M.useState(!1),[z,Y]=M.useState(!1),[ee,ne]=M.useState(!1),[le,ye]=M.useState(!1),J=ve(E=>E.getAllGalleryItems()),{getNewContent:Ae}=ve(),R=Ae().gallery,ue=ve(E=>E.isPointerLocked),te=ve(E=>E.setIsPointerLocked),pe=M.useRef(new Map),X=M.useRef({w:!1,a:!1,s:!1,d:!1,ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1});M.useEffect(()=>{const E=()=>{const de=window.innerWidth<=768||"ontouchstart"in window;Y(de),de&&ne(!0)};return E(),window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]);const ke=M.useRef(null),p=M.useRef(null),W=M.useRef(null),N=M.useRef(null),x=M.useRef(null),ce=M.useRef(null),Fe=M.useRef(new Ge),Xe=M.useRef(null),Ze=M.useRef([]),Je=M.useRef(null),Qe=M.useRef([]),ze=M.useRef(null),je=M.useRef(null),Te=M.useRef(null),fe=M.useRef(null),ht=M.useRef(null),dt=M.useRef(null);return M.useEffect(()=>{if(!ke.current)return;const E=ke.current,de=f=>{const h=new st;f.add(h),Xe.current=h;const y=32,j=72,D=new We(y,j),d=(()=>{const b=document.createElement("canvas"),a=1024;b.width=a,b.height=a;const n=b.getContext("2d"),P="#1a1a1a",F=["#262626","#2a2a2a","#1e1e1e","#333333","#2d2d2d"];n.fillStyle=P,n.fillRect(0,0,a,a);for(let C=0;C<2e3;C++){const H=Math.random()*a,ge=Math.random()*a,Q=Math.random()*8+2,se=Math.random()*.3+.1;n.globalAlpha=se,n.fillStyle=F[Math.floor(Math.random()*F.length)],n.beginPath(),n.arc(H,ge,Q,0,Math.PI*2),n.fill()}n.globalAlpha=.15,n.strokeStyle="#404040",n.lineWidth=1;for(let C=0;C<50;C++){const H=Math.random()*a,ge=Math.random()*a,Q=Math.random()*100+50,se=Math.random()*Math.PI*2;n.beginPath(),n.moveTo(H,ge),n.lineTo(H+Math.cos(se)*Q,ge+Math.sin(se)*Q),n.stroke()}const U=n.createRadialGradient(a/2,a/2,0,a/2,a/2,a/2);U.addColorStop(0,"rgba(80, 80, 80, 0.15)"),U.addColorStop(.5,"rgba(60, 60, 60, 0.08)"),U.addColorStop(1,"rgba(40, 40, 40, 0.02)"),n.globalAlpha=1,n.fillStyle=U,n.fillRect(0,0,a,a),n.globalAlpha=.06;for(let C=0;C<15;C++){const H=Math.random()*a,ge=Math.random()*a,Q=Math.random()*2+1;n.fillStyle="#00ffaa",n.beginPath(),n.arc(H,ge,Q,0,Math.PI*2),n.fill()}n.globalAlpha=1;const O=new ot(b);return O.wrapS=Ie,O.wrapT=Ie,O.repeat.set(6,6),O})(),Z=new Re({map:d,color:1710618,metalness:.05,roughness:.3,envMapIntensity:1.2}),_=new ie(D,Z);_.rotation.x=-Math.PI/2,_.position.y=-2,_.receiveShadow=!0,f.add(_);const me=(()=>{const b=document.createElement("canvas"),a=1024;b.width=a,b.height=a;const n=b.getContext("2d");n.fillStyle="#f8f8f8",n.fillRect(0,0,a,a);const P=64,F=2;n.strokeStyle="#e0e0e0",n.lineWidth=F;for(let O=0;O<=a;O+=P)n.beginPath(),n.moveTo(O,0),n.lineTo(O,a),n.stroke();for(let O=0;O<=a;O+=P)n.beginPath(),n.moveTo(0,O),n.lineTo(a,O),n.stroke();const U=new ot(b);return U.wrapS=Ie,U.wrapT=Ie,U.repeat.set(4,4),U})(),T=new ie(new We(y,j),new Pe({map:me,color:16777215,transparent:!1,side:$e}));T.rotation.x=Math.PI/2,T.position.y=8,T.receiveShadow=!0,f.add(T);const B=new Pe({color:16316664,side:He,transparent:!1}),K=32,Me=72,S=12,g=.5,w=new ie(new ae(K,S,g),B);w.position.set(0,3,-36),w.receiveShadow=!0,w.castShadow=!1,h.add(w),f.add(w);const v=new ie(new ae(10,S,g),B);v.position.set(-11,3,36),v.receiveShadow=!0,v.castShadow=!1,h.add(v),f.add(v);const o=new ie(new ae(10,S,g),B);o.position.set(11,3,36),o.receiveShadow=!0,o.castShadow=!1,h.add(o),f.add(o);const l=new ie(new ae(g,S,Me),B);l.position.set(-16,3,0),l.receiveShadow=!0,l.castShadow=!1,h.add(l),f.add(l);const c=new ie(new ae(g,S,Me),B);c.position.set(16,3,0),c.receiveShadow=!0,c.castShadow=!1,h.add(c),f.add(c)},G=(f,h=null)=>{if(!J||J.length===0){for(let S=0;S<6;S++){const g=new We(3,2),w=new Pe({color:6710886}),v=new ie(g,w);S<3?(v.position.set(-6+S*6,3,-14.9),v.rotation.y=0):(v.position.set(-14.9,3,-6+(S-3)*6),v.rotation.y=Math.PI/2),f.add(v)}return}const y=Math.min(J.length,22),j=2.2,D=4,A=async()=>{const S=[];for(let v=0;v<Math.min(J.length,y);v++){const o=J[v];if(o.src||o.thumbnail)try{let l,c;o.aspectRatio&&o.dimensions?(l=o.aspectRatio,c=o.dimensions,console.log(`âœ… ä½¿ç”¨é¢„è®¡ç®—å°ºå¯¸: ${o.id} - ${c.width}x${c.height} (${l.toFixed(2)})`)):(console.log(`âš ï¸ ç¼ºå°‘é¢„è®¡ç®—å°ºå¯¸ï¼ŒåŠ¨æ€æ£€æµ‹: ${o.id}`),c=await _(o.src||o.thumbnail),l=c.width/c.height),S.push({index:v,item:o,aspectRatio:l,isPortrait:l<.8,isLandscape:l>1.3,isSquare:l>=.8&&l<=1.3,dimensions:c,isPrecomputed:!!(o.aspectRatio&&o.dimensions)})}catch(l){console.warn(`âŒ å›¾ç‰‡å°ºå¯¸åˆ†æå¤±è´¥: ${o.id}`,l),S.push({index:v,item:o,aspectRatio:1,isPortrait:!1,isLandscape:!1,isSquare:!0,dimensions:{width:300,height:200},isPrecomputed:!1})}}const g=S.filter(v=>v.isPrecomputed).length,w=S.length;return console.log(`ğŸ“Š å°ºå¯¸åˆ†æå®Œæˆ: ${g}/${w} ä½¿ç”¨é¢„è®¡ç®—æ•°æ® (${Math.round(g/w*100)}%)`),S},d=S=>{const g={backWall:[],rightWall:[],leftWall:[],frontWall:[]},w=S.filter(b=>b.item.position!=="lightbox"),v=w.filter(b=>b.item.wall==="vertical_wall_32m"),o=w.filter(b=>b.item.wall==="horizontal_wall_64m"),l=o.filter(b=>b.item.layer==="upper"),c=o.filter(b=>b.item.layer==="lower");return g.backWall=v.slice(0,3),g.frontWall=v.slice(3,5),g.rightWall=[...l.slice(0,4),...c.slice(0,4)],g.leftWall=[...l.slice(4,8),...c.slice(4,8)],g},Z=async()=>{if(f.children.some(l=>l.name&&l.name.startsWith("painting_"))){console.log("â­ï¸ è·³è¿‡é‡å¤åˆ›å»ºç”»ä½œï¼ˆç”»ä½œå·²å­˜åœ¨ï¼‰");return}console.log("ğŸ¨ å¼€å§‹åˆ›å»ºç”»å»Šç”»ä½œ...");const S=await A(),g=d(S),w=new Map,v=async(l,c,b)=>{var Le,Ne,Ee,oe;const a=l.item,n=l.aspectRatio;let P,F;n>1.5?(P=Math.min(D,j*n*.8),F=P/n):n<.7?(F=j,P=F*n):(F=j*.9,P=F*n);const U=new We(P,F),O=new Ue({color:16777215,metalness:0,roughness:.15,clearcoat:.1,clearcoatRoughness:.1,reflectivity:.3,emissive:1052688,emissiveIntensity:.02,side:$e}),C=new ie(U,O),H=Me(C,P,F),ge=35.5;switch(c){case"backWall":H.position.set(-10+b*10,2.4,-35.5),H.rotation.y=0;break;case"rightWall":{const{x:L,y:k,z:q}=$(l.item,g.rightWall);H.position.set(L,k,q),H.rotation.y=-Math.PI/2;break}case"leftWall":{const{x:L,y:k,z:q}=me(l.item,g.leftWall);H.position.set(L,k,q),H.rotation.y=Math.PI/2;break}case"frontWall":b===0?H.position.set(-10,2.4,ge):H.position.set(10,2.4,ge),H.rotation.y=Math.PI;break}H.castShadow=!1,H.receiveShadow=!1,H.name=`painting_${c}_${b}`,f.add(H),Qe.current.push({mesh:H,position:H.position.clone(),painting:C}),pe.current.set(a.id,{position:H.position.clone(),item:a,mesh:H}),setTimeout(()=>{(c==="frontWall"||c==="rightWall"&&l.item.layer==="lower"||c==="leftWall"&&l.item.layer==="lower")&&T(H)},100);const Q=a.src||a.thumbnail,se=Q.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,"");if(console.log(`ğŸ” æŸ¥æ‰¾çº¹ç† - item.id: ${a.id}, é¢„åŠ è½½çº¹ç†æ•°é‡: ${((Le=fe.current)==null?void 0:Le.textures.size)||0}`),console.log("ğŸ” é¢„åŠ è½½çº¹ç†keys:",Array.from(((Ne=fe.current)==null?void 0:Ne.textures.keys())||[])),(Ee=fe.current)!=null&&Ee.textures.has(a.id)){const L=fe.current.textures.get(a.id);C.material.map=L,C.material.color.setHex(16777215),C.material.needsUpdate=!0,console.log(`âœ… ä½¿ç”¨é¢„åŠ è½½Galleryçº¹ç†: ${a.id}`)}else if((oe=fe.current)!=null&&oe.videos.has(a.id)){const L=fe.current.videos.get(a.id);if(C.material.map=L,C.material.color.setHex(16777215),C.material.needsUpdate=!0,console.log(`âœ… ä½¿ç”¨é¢„åŠ è½½è§†é¢‘çº¹ç†: ${a.id}`),L.image){const k=L.image;k.paused&&k.play().catch(q=>{console.warn("Galleryè§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œæ·»åŠ ç”¨æˆ·äº¤äº’ç›‘å¬:",q);const V=()=>{k.paused&&k.play().then(()=>{console.log(`ğŸ¬ Galleryè§†é¢‘ç”¨æˆ·äº¤äº’åå¼€å§‹æ’­æ”¾: ${a.id}`)}).catch(Be=>console.warn("ç”¨æˆ·äº¤äº’åæ’­æ”¾å¤±è´¥:",Be))};document.addEventListener("click",V,{once:!0}),document.addEventListener("touchstart",V,{once:!0})})}}else if(w.has(Q))C.material.map=w.get(Q),C.material.color.setHex(16777215),C.material.needsUpdate=!0;else try{if(a.type==="video"){const L=document.createElement("video");L.src=Q,L.autoplay=a.autoplay||!0,L.loop=a.loop||!0,L.muted=a.muted||!0,L.controls=a.controls||!1,L.crossOrigin="anonymous",L.playsInline=!0,await new Promise((q,V)=>{L.oncanplay=q,L.onerror=V,L.load()});const k=new nt(L);k.generateMipmaps=!1,k.minFilter=De,k.magFilter=De,k.flipY=!0,k.colorSpace=Oe,w.set(Q,k),C.material.map=k,C.material.color.setHex(16777215),C.material.needsUpdate=!0,L.play().catch(q=>{console.warn("è§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’:",q)}),console.log(`ğŸ¬ åŠ è½½è§†é¢‘çº¹ç†: ${a.title.zh||a.title.en}`)}else{let L;a.id==="gallery_lightbox"?L=a.src.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,""):L=a.id.replace(/_/g,"-"),console.log(`âš ï¸ é¢„åŠ è½½çº¹ç†ä¸å¯ç”¨ï¼Œå°è¯•å•ç‹¬åŠ è½½: ${a.id} -> ${L}`);const k=await Se.loadSceneTextures("gallery",{images:[L],folder:"gallery"});if(k.textures.has(L)){const q=k.textures.get(L);w.set(Q,q),C.material.map=q,C.material.color.setHex(16777215),C.material.needsUpdate=!0,console.log(`âœ… å•ç‹¬åŠ è½½Galleryçº¹ç†æˆåŠŸ: ${L}`)}else throw new Error(`çº¹ç†åŠ è½½å¤±è´¥: ${L}`)}}catch(L){console.warn(`Galleryçº¹ç†åŠ è½½å¤±è´¥: ${se}`,L),C.material.color.setHex(6710886),C.material.needsUpdate=!0}},o=[...g.backWall.map((l,c)=>({data:l,wallType:"backWall",index:c})),...g.rightWall.map((l,c)=>({data:l,wallType:"rightWall",index:c})),...g.leftWall.map((l,c)=>({data:l,wallType:"leftWall",index:c})),...g.frontWall.map((l,c)=>({data:l,wallType:"frontWall",index:c}))];for(let l=0;l<o.length;l+=4){const c=o.slice(l,l+4);await Promise.all(c.map(({data:b,wallType:a,index:n})=>v(b,a,n))),l+4<o.length&&await new Promise(b=>setTimeout(b,100))}console.log("ğŸ¨ æ‰€æœ‰ç”»ä½œçº¹ç†åŠ è½½å®Œæˆï¼Œè§¦å‘åŠ è½½ç®¡ç†å™¨å›è°ƒ"),h&&h.onLoad&&setTimeout(()=>{h.onLoad()},200)},_=async S=>{try{const g=S.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,""),w=await Se.getOptimalPath(g,"gallery");return new Promise(v=>{const o=new Image;o.onload=()=>{v({width:o.width,height:o.height})},o.onerror=()=>{const l=new Image;l.onload=()=>{v({width:l.width,height:l.height})},l.onerror=()=>{v({width:300,height:200})},l.src=S},o.src=w})}catch{return new Promise(g=>{const w=new Image;w.onload=()=>{g({width:w.width,height:w.height})},w.onerror=()=>{g({width:300,height:200})},w.src=S})}},$=(S,g)=>{const c=[-28,-12,4,20],b=[-20,-4,12,28];if(S.layer==="upper"){const a=g.filter(n=>n.item.layer==="upper").findIndex(n=>n.item.id===S.id);return{x:15.5,y:1.8+1.2,z:b[a]||0}}else{const a=g.filter(n=>n.item.layer==="lower").findIndex(n=>n.item.id===S.id);return{x:15.5,y:1.8,z:c[a]||0}}},me=(S,g)=>{const v=$(S,g);return{x:-15.5,y:v.y,z:-v.z}},T=S=>{const g=S.position,w=S.rotation,v=Math.abs(w.y)<.1||Math.abs(w.y-Math.PI)<.1;let o,l,c,b;v?(o=Math.PI/9,l=.08,c=12,b=6):(o=Math.PI/6,l=.15,c=15,b=3.5);const a=new qe(16775393,1.5,c,o,l,1);let n=new at;const P=Math.max(7,g.y+b),F=1.8;return Math.abs(w.y)<.1?n.set(g.x,P,g.z+F):Math.abs(w.y-Math.PI)<.1?n.set(g.x,P,g.z-F):Math.abs(w.y+Math.PI/2)<.1?n.set(g.x-F,P,g.z):Math.abs(w.y-Math.PI/2)<.1&&n.set(g.x+F,P,g.z),a.position.copy(n),a.target=S,a.castShadow=!1,a.userData={paintingPosition:g.clone(),baseIntensity:1,maxIntensity:8,activationDistance:6,optimalDistance:2},f.add(a),f.add(a.target),Ze.current.push(a),a},B=.05,K=.1,Me=(S,g=2.5,w=2)=>{const v=new st,o=new Ue({color:1710618,metalness:.8,roughness:.2,clearcoat:.3,clearcoatRoughness:.1,emissive:657930,emissiveIntensity:.05}),l=[new ae(g+K*2,K,B),new ae(g+K*2,K,B),new ae(K,w,B),new ae(K,w,B)],c=[{x:0,y:(w+K)/2,z:B/2},{x:0,y:-(w+K)/2,z:B/2},{x:-(g+K)/2,y:0,z:B/2},{x:(g+K)/2,y:0,z:B/2}];return l.forEach((b,a)=>{const n=new ie(b,o);n.position.set(c[a].x,c[a].y,c[a].z),n.castShadow=!1,n.receiveShadow=!1,v.add(n)}),v.add(S),v};Z()},xe=(f,h)=>{const y=6*f,j=N.current,D=j.position.clone();(X.current.w||X.current.ArrowUp)&&h.moveForward(y),(X.current.s||X.current.ArrowDown)&&h.moveForward(-y),(X.current.d||X.current.ArrowRight)&&h.moveRight(y),(X.current.a||X.current.ArrowLeft)&&h.moveRight(-y),we(j)&&j.position.copy(D),((d,Z)=>{if(!Z.isLocked)return;let _=null,$=1/0;const me=4;if(pe.current.forEach(T=>{const B=d.position.distanceTo(T.position);B<me&&B<$&&($=B,_=T)}),_){const T=_.position.y,B=d.position.y,K=T-B;d.position.y+=K*.15}else{const K=2.4-d.position.y;d.position.y+=K*.08}d.position.y=Math.max(1.2,Math.min(3.5,d.position.y))})(j,h),h.isLocked||(j.position.y=2.4),Ce(j.position)},we=f=>{const h=f.position,y=14.5,j=34.5;if(h.x>y||h.x<-y||h.z>j||h.z<-j)return!0;const D=[{x:-5,z:18,radius:.5},{x:5,z:18,radius:.5},{x:0,z:-18,radius:1.2/2}],A=.5;for(const d of D)if(Math.sqrt(Math.pow(h.x-d.x,2)+Math.pow(h.z-d.z,2))<d.radius+A)return!0;return!1},Ce=f=>{Ze.current.forEach(h=>{const y=h.userData;if(!y||!y.paintingPosition)return;const j=f.distanceTo(y.paintingPosition);let D=y.baseIntensity;if(j<=y.activationDistance){const A=Math.max(0,(y.activationDistance-j)/y.activationDistance),d=y.maxIntensity-y.baseIntensity,Z=Math.pow(A,1.5);D=y.baseIntensity+d*Z,j<=y.optimalDistance&&(D=y.maxIntensity)}h.intensity=Ve.lerp(h.intensity,D,.12)}),et(f)},et=f=>{const h=Je.current;if(!h)return;let y=1/0;Qe.current.forEach(D=>{const A=f.distanceTo(D.position);A<y&&(y=A)});const j=N.current;if(j){const D=new at;j.getWorldDirection(D);const A=j.position.clone().add(D.multiplyScalar(10));h.target.position.copy(A),h.target.updateMatrixWorld()}if(y<=6){const A=3+Math.max(0,(6-y)/6)*12;h.intensity=Ve.lerp(h.intensity,A,.1)}else h.intensity=Ve.lerp(h.intensity,1.5,.1)},tt=()=>{const f=N.current;if(!f)return;const h={phase1:{duration:2500,startPos:{x:0,y:2.4,z:15},endPos:{x:0,y:2.4,z:12},startLookAt:{x:0,y:8,z:0},endLookAt:{x:0,y:8,z:0}},phase2:{duration:3e3,startPos:{x:0,y:2.4,z:12},endPos:{x:0,y:2.4,z:5},startLookAt:{x:0,y:8,z:0},endLookAt:{x:0,y:4,z:0}},phase3:{duration:2e3,startPos:{x:0,y:2.4,z:5},endPos:{x:0,y:2.4,z:0},startLookAt:{x:0,y:4,z:0},endLookAt:{x:0,y:2.4,z:-1}}};f.position.set(h.phase1.startPos.x,h.phase1.startPos.y,h.phase1.startPos.z),f.lookAt(h.phase1.startLookAt.x,h.phase1.startLookAt.y,h.phase1.startLookAt.z);let y=1,j=Date.now();const D=d=>{const Z=Date.now()-j,_=Math.min(Z/d.duration,1),$=_<.5?4*_*_*_:1-Math.pow(-2*_+2,3)/2;f.position.x=d.startPos.x+(d.endPos.x-d.startPos.x)*$,f.position.y=d.startPos.y+(d.endPos.y-d.startPos.y)*$,f.position.z=d.startPos.z+(d.endPos.z-d.startPos.z)*$;const me={x:d.startLookAt.x+(d.endLookAt.x-d.startLookAt.x)*$,y:d.startLookAt.y+(d.endLookAt.y-d.startLookAt.y)*$,z:d.startLookAt.z+(d.endLookAt.z-d.startLookAt.z)*$};return f.lookAt(me.x,me.y,me.z),_>=1},A=()=>{let d=!1;switch(y){case 1:d=D(h.phase1),d&&(y=2,j=Date.now());break;case 2:d=D(h.phase2),d&&(y=3,j=Date.now());break;case 3:if(d=D(h.phase3),d){r(!0),t(!1),setTimeout(()=>{u(!0)},9e3),x.current&&(x.current.getObject().position.copy(f.position),x.current.connect=x.current.connect.__original||x.current.connect);return}break}ht.current=requestAnimationFrame(A)};A()};return(async()=>{try{if(p.current||W.current)return;const f=new yt;dt.current=f;let h=!1;const y=async()=>{try{const o=[],l=[];J.slice(0,12).forEach(n=>{let P;n.id==="gallery_lightbox"?P=n.src.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,""):P=n.id.replace(/_/g,"-"),n.type==="video"?l.push({id:n.id,fileName:P,src:n.src}):o.push({id:n.id,fileName:P})}),console.log("ğŸ¨ å¼€å§‹é¢„åŠ è½½Galleryçº¹ç†...",{images:o.length,videos:l.length});const c=await Se.loadSceneTextures("gallery",{images:o.map(n=>n.fileName),videos:l.map(n=>({name:n.fileName,src:n.src})),folder:"gallery",onProgress:(n,P,F)=>{console.log(`ğŸ“¦ Galleryçº¹ç†åŠ è½½è¿›åº¦: ${P}/${F} (${Math.round(n*100)}%)`)}}),b=new Map,a=new Map;o.forEach(({id:n,fileName:P})=>{c.textures.has(P)&&b.set(n,c.textures.get(P))}),l.forEach(({id:n,fileName:P})=>{c.videos.has(P)&&a.set(n,c.videos.get(P))}),fe.current={textures:b,videos:a,errors:c.errors},console.log(`âœ… Galleryçº¹ç†é¢„åŠ è½½å®Œæˆ: ${c.textures.size}å¼ å›¾ç‰‡, ${c.videos.size}ä¸ªè§†é¢‘`),c.errors.length>0&&console.warn("âš ï¸ éƒ¨åˆ†Galleryçº¹ç†åŠ è½½å¤±è´¥:",c.errors),h=!0,j&&h&&D()}catch(o){console.warn("Galleryçº¹ç†é¢„åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨fallback:",o),fe.current={textures:new Map,videos:new Map,errors:[]},h=!0,j&&D()}};let j=!1;const D=()=>{requestAnimationFrame(()=>{W.current&&p.current&&N.current?(W.current.render(p.current,N.current),requestAnimationFrame(()=>{setTimeout(()=>{tt()},300)})):setTimeout(()=>{tt()},500)})};f.onLoad=()=>{console.log("ğŸ­ THREE.jsåœºæ™¯åŠ è½½å®Œæˆ"),j=!0,h&&D()},f.onError=()=>{},y();const A=new xt;A.background=new re(1710618),p.current=A;const d=new wt(75,E.clientWidth/E.clientHeight,.1,1e3);d.position.set(0,2.4,0),N.current=d;const Z=new qe(16774374,6,15,Math.PI/5,.15,1.2);Z.position.set(0,0,0),Z.castShadow=!1;const _=new bt;Z.target=_,d.add(Z),A.add(_),A.add(d),Je.current=Z;const $=new vt({antialias:!0,alpha:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1});if($.setSize(E.clientWidth,E.clientHeight),$.setClearColor(15790320,1),$.shadowMap.enabled=!0,$.shadowMap.type=St,$.outputColorSpace=Oe,$.toneMapping=kt,$.toneMappingExposure=1,!$.getContext())throw new Error("WebGL context creation failed");E.appendChild($.domElement),W.current=$;let T;try{document&&document.body&&document.documentElement&&window.self===window.top&&"requestPointerLock"in document.body?T=new Ke(d,document.body):(T=new Ke(d,$.domElement),console.warn("Pointer Lock API not available, using fallback mode"))}catch(o){console.warn("PointerLockControls initialization failed:",o),T=new Ke(d,$.domElement)}A.add(T.getObject()),x.current=T;try{T.addEventListener("lock",()=>{te(!0)}),T.addEventListener("unlock",()=>{te(!1)})}catch(o){console.warn("PointerLockControls event setup failed:",o)}try{const o=T.connect;o&&(T.connect.__original=o,T.connect=()=>{if(s)try{o.call(T)}catch(l){console.warn("PointerLockControls connect failed:",l)}})}catch(o){console.warn("PointerLockControls connect override failed:",o)}const B=o=>{const c=(()=>{const P=new ae(12,12,.4),F=new Ue({color:1710618,metalness:.9,roughness:.1,clearcoat:.5,clearcoatRoughness:.05,emissive:3355443,emissiveIntensity:.15}),U=new ie(P,F);U.position.set(0,3,35.8),o.add(U);const C=(()=>{const Q=new We(11,9),se={useVideo:!0,videoPath:"/ui-test.mp4",imagePath:"/gallery/gallery-vertical-0.jpg"},Le=J.find(k=>k.position==="lightbox"),Ne=Le?Le.src||Le.thumbnail:se.imagePath;let Ee;se.useVideo&&(Ee=new Pe({color:0,emissive:0,emissiveIntensity:0,transparent:!0,opacity:.95,side:He}));const oe=new ie(Q,Ee);if(oe.position.set(0,3,36-.4-.02),oe.rotation.y=Math.PI,oe.name="LightboxGallery",o.add(oe),se.useVideo){console.log(`ğŸ¬ Lightboxè§†é¢‘åŠ è½½: ${se.videoPath}`);const k=document.createElement("video");k.src=se.videoPath,k.crossOrigin="anonymous",k.loop=!0,k.muted=!0,k.autoplay=!0,k.playsInline=!0,k.preload="auto";const q=()=>{try{const V=new nt(k);V.minFilter=De,V.magFilter=De,V.format=Mt,V.generateMipmaps=!1,V.flipY=!0,V.colorSpace=Oe;const Be=new Pe({map:V,emissive:0,emissiveIntensity:0,transparent:!1,side:He});oe.material.dispose(),oe.material=Be,console.log("âœ… Lightboxè§†é¢‘çº¹ç†è®¾ç½®å®Œæˆ"),k.play().catch(mt=>{console.warn("Lightboxè§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥:",mt)})}catch(V){console.warn("Lightboxè§†é¢‘çº¹ç†åˆ›å»ºå¤±è´¥:",V)}};k.addEventListener("loadeddata",q),k.addEventListener("canplay",q),k.addEventListener("loadedmetadata",()=>{k.play().catch(()=>{console.warn("Lightboxè§†é¢‘å…ƒæ•°æ®åŠ è½½åæ’­æ”¾å¤±è´¥")})}),k.addEventListener("error",V=>{console.warn("Lightboxè§†é¢‘åŠ è½½é”™è¯¯:",V),L()}),k.load()}function L(){console.log(`ğŸ–¼ï¸ Lightboxå›¾ç‰‡åŠ è½½: ${Ne}`);const k=Ne.split("/").pop().replace(/\.(jpg|jpeg|png|webp|avif)$/i,"");Se.loadTexture(k).then(q=>{const V=new Pe({map:q,emissive:0,emissiveIntensity:0,transparent:!0,opacity:.61,side:He});oe.material.dispose(),oe.material=V,console.log("âœ… Lightboxå›¾ç‰‡çº¹ç†è®¾ç½®å®Œæˆ")}).catch(()=>{console.warn("Lightboxå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œä¿æŒå ä½æè´¨")})}return{screen:oe}})();return console.log("ğŸ–¼ï¸ Lightboxå±å¹•åˆ›å»ºå®Œæˆ",C),{lightBox:U,lightboxDisplay:C}})();return{wallLightBox:c.lightBox,lightboxDisplay:c.lightboxDisplay.screen,ledFrame:c.lightboxDisplay.frame}},K=()=>{const o=[];return[{start:{x:-3,z:2.25},end:{x:3,z:2.25},name:"ç‹-ä¸Šæ¨ª"},{start:{x:-2.5,z:0},end:{x:2.5,z:0},name:"ç‹-ä¸­æ¨ª"},{start:{x:-3.5,z:-2.25},end:{x:3.5,z:-2.25},name:"ç‹-ä¸‹æ¨ª"},{start:{x:0,z:2.25},end:{x:0,z:-2.25},name:"ç‹-ç«–çº¿"}].forEach(c=>{const b=Math.sqrt(Math.pow(c.end.x-c.start.x,2)+Math.pow(c.end.z-c.start.z,2));let a;c.name.includes("ç«–")?a=new ae(.4,.2,b):a=new ae(b,.2,.4);const n=new Re({color:16777215,emissive:16777215,emissiveIntensity:2,transparent:!1}),P=new ie(a,n),F=(c.start.x+c.end.x)/2,U=(c.start.z+c.end.z)/2;P.position.set(F,6,U),A.add(P);const O=new rt(16777215,7,45);O.position.set(F,5.5,U),A.add(O),o.push({tube:P,name:c.name})}),o},Me=B(A);console.log("ğŸ¨ è‰ºæœ¯å…ƒç´ åˆ›å»ºå®Œæˆ:",Me),K(),de(A),G(A,f);const S=()=>{try{const o={intensity:4,colors:[16739179,5164484,4569041,16370212],showHelpers:!1,enableAnimation:!0,animationSpeed:8e-4,lightWidth:8,lightHeight:6,positions:[{x:-30,y:10,z:0,rx:0,ry:Math.PI/2,rz:0},{x:30,y:10,z:0,rx:0,ry:-Math.PI/2,rz:0},{x:0,y:11.5,z:30,rx:-Math.PI/3,ry:0,rz:0},{x:0,y:11.5,z:-10,rx:-Math.PI/3,ry:Math.PI,rz:0}]};ze.current=new jt(A,o),ze.current.setPreset("soft"),console.log("RectAreaLightingç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ")}catch(o){console.warn("RectAreaLightingåˆå§‹åŒ–å¤±è´¥:",o)}},g=async()=>{try{const o={cubeSize:2.5,cubeCount:3,spacing:10,height:6,intensity:2.5,lightSize:2,enableAnimation:!0,animationSpeed:.001,showCubeMesh:!0,cubeOpacity:.05,showHelpers:!1};je.current=new zt(A,o,J),await je.current.init(),console.log("å…‰æŸ±ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ")}catch(o){console.warn("å…‰æŸ±ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:",o)}},w=()=>{try{const o={lightCount:3,intensity:4200,distance:80,angle:Math.PI/1.8,penumbra:.4,enableAnimation:!0,animationSpeed:.3,showHelpers:!1};Te.current=new At(A,$,o),console.log("âœ¨ 3ç¯ä½IESèšå…‰ç¯ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ - é¿å¼€lightboxå¢™é¢")}catch(o){console.warn("âš ï¸ IESèšå…‰ç¯ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:",o)}};setTimeout(()=>{S(),setTimeout(async()=>{await g(),setTimeout(()=>{w()},200)},100)},300);const v=()=>{ce.current=requestAnimationFrame(v);const o=Fe.current.getDelta();T.isLocked&&xe(o,T),A.traverse(l=>{l.material&&l.material.map&&l.material.map.isVideoTexture&&(l.material.map.needsUpdate=!0)}),$.render(A,d)};v(),t(!1)}catch(f){throw t(!1),f}})().catch(f=>{console.error("Galleryåœºæ™¯åˆå§‹åŒ–å¤±è´¥:",f),t(!1)}),()=>{var f;(f=x.current)!=null&&f.isLocked&&(console.log("ğŸ”“ Galleryç»„ä»¶å¸è½½æ—¶å¼ºåˆ¶è§£é”æŒ‡é’ˆ"),x.current.unlock()),te(!1),ze.current&&(ze.current.dispose(),ze.current=null,console.log(" ğŸ§¹ RectAreaLightingç³»ç»Ÿå·²æ¸…ç†")),je.current&&(je.current.dispose(),je.current=null,console.log(" ğŸ›ï¸ å‘å…‰åœ†æŸ±ä½“ç³»ç»Ÿå·²æ¸…ç†")),Te.current&&(Te.current.dispose(),Te.current=null,console.log(" ğŸ§¹ IESèšå…‰ç¯ç³»ç»Ÿå·²æ¸…ç†")),ce.current&&(cancelAnimationFrame(ce.current),ce.current=null),x.current&&(x.current.isLocked&&x.current.unlock(),x.current.dispose(),x.current=null,console.log(" ğŸ® Galleryæ§åˆ¶å™¨å·²æ¸…ç†")),p.current&&(p.current.traverse(h=>{h.geometry&&h.geometry.dispose(),h.material&&(Array.isArray(h.material)?h.material.forEach(y=>{y.map&&y.map.dispose(),y.normalMap&&y.normalMap.dispose(),y.roughnessMap&&y.roughnessMap.dispose(),y.dispose()}):(h.material.map&&h.material.map.dispose(),h.material.normalMap&&h.material.normalMap.dispose(),h.material.roughnessMap&&h.material.roughnessMap.dispose(),h.material.dispose()))}),p.current.clear(),p.current=null),W.current&&(E&&E.contains(W.current.domElement)&&E.removeChild(W.current.domElement),W.current.dispose(),W.current=null),N.current=null,Xe.current=null,console.log("ğŸ§¹ Gallery ç»„ä»¶æ¸…ç†å®Œæˆ")}},[J,s,te]),M.useEffect(()=>{const E=()=>{var G;!(document.pointerLockElement!==null)&&((G=x.current)!=null&&G.isLocked)&&(console.log("ğŸ”“ æ£€æµ‹åˆ°æŒ‡é’ˆé”å®šçŠ¶æ€ä¸ä¸€è‡´ï¼Œå¼ºåˆ¶åŒæ­¥çŠ¶æ€"),x.current&&(x.current.disconnect(),setTimeout(()=>{x.current&&x.current.connect()},100)),te(!1))};return document.addEventListener("pointerlockchange",E),document.addEventListener("pointerlockerror",E),()=>{document.removeEventListener("pointerlockchange",E),document.removeEventListener("pointerlockerror",E)}},[te]),M.useEffect(()=>{const E=G=>{var we,Ce;if((we=x.current)!=null&&we.isLocked&&!["KeyW","KeyA","KeyS","KeyD","Escape"].includes(G.code)&&G.key!=="Escape"){G.preventDefault(),G.stopPropagation(),console.log("ğŸ”’ ç”»å»Šå¯¼èˆªæ¨¡å¼ï¼šåªå…è®¸WASDç§»åŠ¨å’ŒESCé€€å‡º");return}const xe=G.code==="KeyW"?"w":G.code==="KeyA"?"a":G.code==="KeyS"?"s":G.code==="KeyD"?"d":G.key.toLowerCase();xe in X.current&&(X.current[xe]=!0),G.key==="Escape"&&((Ce=x.current)!=null&&Ce.isLocked)&&(console.log("ğŸ”“ ESCé”®è§£é”æŒ‡é’ˆ"),x.current.unlock())},de=G=>{var we;if((we=x.current)!=null&&we.isLocked&&!["KeyW","KeyA","KeyS","KeyD"].includes(G.code)){G.preventDefault(),G.stopPropagation();return}const xe=G.code==="KeyW"?"w":G.code==="KeyA"?"a":G.code==="KeyS"?"s":G.code==="KeyD"?"d":G.key;xe in X.current&&(X.current[xe]=!1)};return document.addEventListener("keydown",E),document.addEventListener("keyup",de),()=>{document.removeEventListener("keydown",E),document.removeEventListener("keyup",de)}},[]),i.jsxs(i.Fragment,{children:[z&&ee&&!le&&i.jsx("div",{className:"fixed inset-0 z-[99999] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4",children:i.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center max-w-md border border-white/20",children:[i.jsxs("div",{className:"mb-6",children:[i.jsx("svg",{className:"w-16 h-16 text-yellow-400 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})}),i.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:R.mobile.mobileNotice.title[I]||R.mobile.mobileNotice.title.en}),i.jsx("p",{className:"text-white/80 leading-relaxed",children:R.mobile.mobileNotice.description[I]||R.mobile.mobileNotice.description.en})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("button",{onClick:()=>{ne(!1),ye(!0)},className:"w-full bg-theme-primary/20 hover:bg-theme-primary/30 text-theme-primary border border-theme-primary/30 hover:border-theme-primary/50 py-3 px-6 rounded-lg transition-all duration-300",children:R.mobile.mobileNotice.viewGallery[I]||R.mobile.mobileNotice.viewGallery.en}),i.jsx("p",{className:"text-white/60 text-sm",children:R.mobile.mobileNotice.desktopHint[I]||R.mobile.mobileNotice.desktopHint.en})]})]})}),z&&le&&i.jsx(lt,{language:I}),!z&&i.jsxs("section",{id:"gallery",className:"min-h-screen flex flex-col justify-center items-center bg-gray-100 relative overflow-hidden",children:[(e||!s)&&i.jsx(Ye,{size:160,strokeWidth:12,showMask:!0,maskColor:"black-solid"}),i.jsx("div",{ref:ke,className:`w-full h-screen relative bg-gray-200 ${e||!s?"invisible":"visible"}`,style:{minHeight:"100vh"}}),i.jsxs("div",{className:`absolute bottom-6 left-6 bg-black/50 backdrop-blur-md rounded-xl p-4 text-white z-20 max-w-sm transition-all duration-1000 ${!e&&s&&m&&!ue?"opacity-100 translate-y-0":"opacity-0 translate-y-4 pointer-events-none"}`,children:[i.jsx("p",{className:"text-lg font-medium mb-3",children:R.gallery3D.instructions.howToPlay[I]||R.gallery3D.instructions.howToPlay.en}),i.jsxs("div",{className:"space-y-3 text-sm",children:[i.jsxs("p",{className:"flex items-center",children:[i.jsx("span",{className:"w-2"}),R.gallery3D.instructions.clickToEnter[I]||R.gallery3D.instructions.clickToEnter.en]}),i.jsxs("p",{className:"flex items-center",children:[i.jsx("span",{className:"w-2"}),R.gallery3D.instructions.mouseControl[I]||R.gallery3D.instructions.mouseControl.en]}),i.jsxs("p",{className:"flex items-center",children:[i.jsx("span",{className:"w-2"}),i.jsxs("span",{className:"inline-flex items-center gap-1 mr-2",children:[i.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"W"}),i.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"A"}),i.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"S"}),i.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"D"})]}),i.jsx("span",{children:R.gallery3D.instructions.keyboardControl[I]||R.gallery3D.instructions.keyboardControl.en})]}),i.jsxs("p",{className:"flex items-center",children:[i.jsx("span",{className:"w-2"}),i.jsx("span",{className:"inline-flex items-center px-2 py-0.5 mr-2 bg-white/20 rounded text-xs font-mono border border-white/30",children:"ESC"}),i.jsx("span",{children:R.gallery3D.instructions.escapeControl[I]||R.gallery3D.instructions.escapeControl.en})]})]})]}),i.jsx("div",{className:`absolute inset-0 flex items-center justify-center cursor-pointer z-10 transition-all duration-1000 ${!e&&s&&m&&!ue?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,onClick:()=>{var E;if(!e&&s&&m&&!ue)if((E=x.current)!=null&&E.lock)try{x.current.lock(),setTimeout(()=>{ue||(console.log("Fallback: manually setting pointer locked state"),te(!0))},100)}catch(de){console.log("Pointer lock failed, using fallback:",de.message),te(!0)}else te(!0)},children:i.jsxs("div",{className:"glass-card p-8 text-center cursor-pointer",children:[i.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:R.gallery3D.title[I]||R.gallery3D.title.en}),i.jsx("p",{className:"text-white/80 mb-6",children:R.gallery3D.instructions.clickToStart[I]||R.gallery3D.instructions.clickToStart.en}),i.jsx("div",{className:"animate-bounce",children:i.jsxs("svg",{className:"w-8 h-8 text-white mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})}),ue&&i.jsx(i.Fragment,{children:i.jsxs("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-20",children:[i.jsx("div",{className:"w-2 h-2 bg-white rounded-full shadow-lg border border-white/30"}),i.jsx("div",{className:"absolute w-6 h-0.5 bg-white/60 rounded shadow-sm"}),i.jsx("div",{className:"absolute w-0.5 h-6 bg-white/60 rounded shadow-sm"}),i.jsx("div",{className:"absolute w-8 h-8 border border-white/20 rounded-full"})]})})]})]})};ct.propTypes={language:be.string};const Tt=Object.freeze(Object.defineProperty({__proto__:null,default:ct},Symbol.toStringTag,{value:"Module"}));export{Ye as C,Tt as G,Pt as P,It as u};
