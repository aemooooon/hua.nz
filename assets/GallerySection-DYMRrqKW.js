import{r as y,j as e}from"./react-DudRe3MH.js";import{P as Ue}from"./vendor-D2t9TNkl.js";import{H as tt,J as at,S as st,C as nt,b as ot,K as De,X as rt,W as it,Y as lt,p as Te,Z as ct,_ as dt,f as ht,D as Ce,$ as B,a0 as ge,M as E,P as ne,T as Ee,w as oe,F as we,g as Ge,a1 as Fe,x as Be,k as He,a2 as ce,a3 as ye,a4 as Oe,L as Ke,j as qe}from"./three-Hf6x_wfq.js";import{u as re,b as mt}from"./index-DgBMB1h9.js";import{C as ut}from"./CircularLoadingIndicator-BO6eWUEl.js";import"./leaflet-BcfEFI1A.js";const _e=({language:P="zh"})=>{const q=re(S=>S.getAllGalleryItems()),{openPhotoSwipe:ae}=mt(),U=y.useRef(null),O=y.useMemo(()=>Array.isArray(q)?q:[],[q]).map((S,Q)=>({id:S.id||Q,src:S.src,thumbnail:S.thumbnail||S.src,title:S.title||"",description:S.description||""})),de=S=>{ae(O,S)};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        .gallery-mobile-container {
          min-height: 100vh;
          max-height: 100vh;
          overflow-y: auto;
          overflow-x: hidden;
          overscroll-behavior: none;
          
          /* iOS 安全区域支持 */
          padding-top: max(1rem, env(safe-area-inset-top));
          padding-bottom: max(1.5rem, env(safe-area-inset-bottom));
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
          
          /* 确保在iOS上平滑滚动 */
          -webkit-overflow-scrolling: touch;
          
          /* 防止选择文本 */
          -webkit-user-select: none;
          user-select: none;
          
          /* 确保触摸滚动正常工作 */
          touch-action: pan-y;
        }
        
        /* 自定义滚动条样式 */
        .gallery-mobile-container::-webkit-scrollbar {
          width: 4px;
        }
        .gallery-mobile-container::-webkit-scrollbar-track {
          background: transparent;
        }
        .gallery-mobile-container::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.2);
          border-radius: 2px;
        }
        .gallery-mobile-container::-webkit-scrollbar-thumb:hover {
          background: rgba(255, 255, 255, 0.3);
        }
        
        /* 移动端特殊处理 */
        @media (max-width: 768px) {
          .gallery-mobile-container {
            /* 在移动设备上隐藏滚动条 */
            scrollbar-width: none;
            -ms-overflow-style: none;
          }
          
          .gallery-mobile-container::-webkit-scrollbar {
            display: none;
          }
          
          /* 确保图片点击区域可用 */
          .gallery-image-item {
            touch-action: manipulation;
          }
        }
      `}),e.jsxs("div",{ref:U,className:"gallery-mobile-container w-full",children:[e.jsxs("div",{className:"text-center mb-8 px-4",children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-theme-text-primary mb-4",children:P==="zh"?"作品集":"Gallery"}),e.jsx("p",{className:"text-theme-text-secondary max-w-2xl mx-auto leading-relaxed",children:P==="zh"?"记录生活中的美好瞬间，每一张照片都承载着独特的故事与回忆。":"Capturing beautiful moments in life, each photo carries unique stories and memories."}),e.jsx("p",{className:"text-theme-text-secondary/60 text-sm mt-2",children:P==="zh"?"点击图片查看大图":"Tap images to view full size"})]}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4",children:[e.jsx("div",{className:"grid grid-cols-3 gap-2 sm:gap-3 md:gap-4 pb-8",children:O.map((S,Q)=>e.jsx("div",{onClick:()=>de(Q),className:"group project-card cursor-pointer transform transition-all duration-300 active:scale-95",children:e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-theme-surface/10",children:[e.jsx("img",{src:S.thumbnail||S.src,alt:`Gallery item ${Q+1}`,className:"w-full h-full object-cover",loading:"lazy",onError:he=>{he.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjMzMzIj48L3JlY3Q+PC9zdmc+"}}),e.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-active:opacity-100 transition-opacity duration-200 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-white rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})}),e.jsx("div",{className:"absolute top-2 right-2 bg-black/50 backdrop-blur-sm rounded-full w-6 h-6 flex items-center justify-center text-white text-xs font-medium",children:Q+1})]})},S.id))}),O.length===0&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-theme-surface/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-theme-text-secondary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("div",{className:"text-theme-text-secondary text-lg mb-2",children:P==="zh"?"暂无图片内容":"No gallery items available"}),e.jsx("div",{className:"text-theme-text-secondary/60 text-sm",children:P==="zh"?"请稍后再试":"Please try again later"})]}),O.length>0&&e.jsx("div",{className:"text-center mt-8 py-6",children:e.jsx("p",{className:"text-theme-text-secondary/60 text-sm",children:P==="zh"?`共 ${O.length} 张图片 • 点击查看大图`:`${O.length} images • Tap to view full size`})})]})]})]})};_e.propTypes={language:Ue.string};const pt=({language:P="en"})=>{var ze,Se,je,We,Ae,Ie,Ne;const[q,ae]=y.useState(!0),[U,be]=y.useState(!1),[O,de]=y.useState(!1),[S,Q]=y.useState(!1),[he,ke]=y.useState(!1),[Ze,$e]=y.useState(!1),V=re(w=>w.getAllGalleryItems()),me=re(w=>w.texts),se=re(w=>w.isPointerLocked),ee=re(w=>w.setIsPointerLocked),G=y.useRef({w:!1,a:!1,s:!1,d:!1,ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1});y.useEffect(()=>{const w=()=>{const _=window.innerWidth<=768||"ontouchstart"in window;Q(_),_&&ke(!0)};return w(),window.addEventListener("resize",w),()=>window.removeEventListener("resize",w)},[]);const ue=y.useRef(null),J=y.useRef(null),$=y.useRef(null),X=y.useRef(null),T=y.useRef(null),ie=y.useRef(null),Qe=y.useRef(new tt),ve=y.useRef(null),Me=y.useRef([]),Pe=y.useRef(null),Le=y.useRef([]),Je=y.useRef(null),Xe=y.useRef(null);return y.useEffect(()=>{if(!ue.current)return;const w=ue.current,_=n=>{const a=new Fe;n.add(a),ve.current=a;const i=32,d=64,v=new ne(i,d),h=(()=>{const x=document.createElement("canvas"),r=1024;x.width=r,x.height=r;const s=x.getContext("2d"),z="#e8e8e8",k=["#f0f0f0","#e0e0e0","#dcdcdc","#f5f5f5","#efefef"];s.fillStyle=z,s.fillRect(0,0,r,r);for(let M=0;M<2e3;M++){const b=Math.random()*r,N=Math.random()*r,K=Math.random()*8+2,F=Math.random()*.3+.1;s.globalAlpha=F,s.fillStyle=k[Math.floor(Math.random()*k.length)],s.beginPath(),s.arc(b,N,K,0,Math.PI*2),s.fill()}s.globalAlpha=.15,s.strokeStyle="#d0d0d0",s.lineWidth=1;for(let M=0;M<50;M++){const b=Math.random()*r,N=Math.random()*r,K=Math.random()*100+50,F=Math.random()*Math.PI*2;s.beginPath(),s.moveTo(b,N),s.lineTo(b+Math.cos(F)*K,N+Math.sin(F)*K),s.stroke()}const C=s.createRadialGradient(r/2,r/2,0,r/2,r/2,r/2);C.addColorStop(0,"rgba(255, 255, 255, 0.1)"),C.addColorStop(.5,"rgba(255, 255, 255, 0.05)"),C.addColorStop(1,"rgba(255, 255, 255, 0)"),s.globalAlpha=1,s.fillStyle=C,s.fillRect(0,0,r,r),s.globalAlpha=.08;for(let M=0;M<20;M++){const b=Math.random()*r,N=Math.random()*r,K=Math.random()*3+1;s.fillStyle="#00ffaa",s.beginPath(),s.arc(b,N,K,0,Math.PI*2),s.fill()}s.globalAlpha=1;const W=new He(x);return W.wrapS=ce,W.wrapT=ce,W.repeat.set(6,6),W})(),j=new ge({map:h,color:16777215,metalness:.1,roughness:.6,envMapIntensity:.8}),A=new E(v,j);A.rotation.x=-Math.PI/2,A.position.y=-2,A.receiveShadow=!0,n.add(A);const Z=(()=>{const x=document.createElement("canvas"),r=1024;x.width=r,x.height=r;const s=x.getContext("2d");s.fillStyle="#f8f8f8",s.fillRect(0,0,r,r);const z=64,k=2;s.strokeStyle="#e0e0e0",s.lineWidth=k;for(let W=0;W<=r;W+=z)s.beginPath(),s.moveTo(W,0),s.lineTo(W,r),s.stroke();for(let W=0;W<=r;W+=z)s.beginPath(),s.moveTo(0,W),s.lineTo(r,W),s.stroke();const C=new He(x);return C.wrapS=ce,C.wrapT=ce,C.repeat.set(4,4),C})(),R=new E(new ne(i,d),new oe({map:Z,color:16777215,transparent:!1,side:Be}));R.rotation.x=Math.PI/2,R.position.y=8,R.receiveShadow=!0,n.add(R);const L=new oe({color:16316664,side:we,transparent:!1}),I=32,u=64,t=12,o=.5,l=new E(new B(I,t,o),L);l.position.set(0,3,-32),l.receiveShadow=!0,l.castShadow=!1,a.add(l),n.add(l);const p=new E(new B(10,t,o),L);p.position.set(-11,3,32),p.receiveShadow=!0,p.castShadow=!1,a.add(p),n.add(p);const f=new E(new B(10,t,o),L);f.position.set(11,3,32),f.receiveShadow=!0,f.castShadow=!1,a.add(f),n.add(f);const c=new E(new B(o,t,u),L);c.position.set(-16,3,0),c.receiveShadow=!0,c.castShadow=!1,a.add(c),n.add(c);const g=new E(new B(o,t,u),L);g.position.set(16,3,0),g.receiveShadow=!0,g.castShadow=!1,a.add(g),n.add(g)},D=(n,a=null)=>{if(!V||V.length===0){for(let u=0;u<6;u++){const t=new ne(3,2),o=new oe({color:6710886}),l=new E(t,o);u<3?(l.position.set(-6+u*6,3,-14.9),l.rotation.y=0):(l.position.set(-14.9,3,-6+(u-3)*6),l.rotation.y=Math.PI/2),n.add(l)}return}const i=Math.min(V.length,20),d=2.2,v=4,m=1.6,h=async()=>{const u=[];for(let t=0;t<Math.min(V.length,i);t++){const o=V[t];if(o.src||o.thumbnail)try{const l=await H(o.src||o.thumbnail),p=l.width/l.height;u.push({index:t,item:o,aspectRatio:p,isPortrait:p<.8,isLandscape:p>1.3,isSquare:p>=.8&&p<=1.3})}catch{u.push({index:t,item:o,aspectRatio:1,isPortrait:!1,isLandscape:!1,isSquare:!0})}}return u},j=u=>{const t={backWall:[],rightWall:[],leftWall:[],frontWall:[]},o=u.filter(r=>r.isPortrait),l=u.filter(r=>!r.isPortrait),p=o.slice(0,3);if(t.backWall=p,p.length<3){const r=3-p.length,s=l.slice(0,r);t.backWall.push(...s),s.forEach(z=>{const k=l.indexOf(z);k>-1&&l.splice(k,1)})}const f=o.slice(3,5);if(t.frontWall=f,f.length<2){const r=2-f.length,s=l.slice(0,r);t.frontWall.push(...s),s.forEach(z=>{const k=l.indexOf(z);k>-1&&l.splice(k,1)})}const c=[...p,...f],x=[...o.filter(r=>!c.some(s=>s.index===r.index)),...l];return t.rightWall=x.slice(0,6),t.leftWall=x.slice(6,12),t},A=async()=>{const u=await h(),t=j(u),o=new Ee(a||void 0),l=new Map,p=async(c,g,x)=>{const r=c.item,s=c.aspectRatio;let z,k;s>1.5?(z=Math.min(v,d*s*.8),k=z/s):s<.7?(k=d,z=k*s):(k=d*.9,z=k*s);const C=new ne(z,k),W=new Oe({color:16777215,metalness:0,roughness:.15,clearcoat:.1,clearcoatRoughness:.1,reflectivity:.3,emissive:1052688,emissiveIntensity:.02,side:Be}),M=new E(C,W),b=I(M,z,k),N=31.5,K=15.5;switch(g){case"backWall":b.position.set(-10+x*10,m,-31.5),b.rotation.y=0;break;case"rightWall":b.position.set(K,m,-27.5+x*11),b.rotation.y=-Math.PI/2;break;case"leftWall":b.position.set(-15.5,m,27.5-x*11),b.rotation.y=Math.PI/2;break;case"frontWall":x===0?b.position.set(-12,m,N):b.position.set(12,m,N),b.rotation.y=Math.PI;break}b.castShadow=!1,b.receiveShadow=!1,n.add(b),Le.current.push({mesh:b,position:b.position.clone(),painting:M}),setTimeout(()=>{Z(b)},100);const F=r.src||r.thumbnail;if(l.has(F))M.material.map=l.get(F),M.material.color.setHex(16777215),M.material.needsUpdate=!0;else try{await(pe=>new Promise((xe,et)=>{const fe=new Image;fe.onload=()=>xe(!0),fe.onerror=()=>et(!1),fe.src=pe}))(F);const te=await new Promise((pe,xe)=>{o.load(F,pe,void 0,xe)});te.generateMipmaps=!1,te.minFilter=Ke,te.magFilter=Ke,te.colorSpace=Te,l.set(F,te),M.material.map=te,M.material.color.setHex(16777215),M.material.needsUpdate=!0}catch{M.material.color.setHex(6710886),M.material.needsUpdate=!0}},f=[...t.backWall.map((c,g)=>({data:c,wallType:"backWall",index:g})),...t.rightWall.map((c,g)=>({data:c,wallType:"rightWall",index:g})),...t.leftWall.map((c,g)=>({data:c,wallType:"leftWall",index:g})),...t.frontWall.map((c,g)=>({data:c,wallType:"frontWall",index:g}))];for(let c=0;c<f.length;c+=4){const g=f.slice(c,c+4);await Promise.all(g.map(({data:x,wallType:r,index:s})=>p(x,r,s))),c+4<f.length&&await new Promise(x=>setTimeout(x,100))}},H=u=>new Promise(t=>{const o=new Image;o.onload=()=>{t({width:o.width,height:o.height})},o.onerror=()=>{t({width:300,height:200})},o.src=u}),Z=u=>{const t=new De(16775393,1.5,15,Math.PI/6,.15,1),o=u.position,l=u.rotation;let p=new qe;const f=7,c=1.8;return Math.abs(l.y)<.1?p.set(o.x,f,o.z+c):Math.abs(l.y-Math.PI)<.1?p.set(o.x,f,o.z-c):Math.abs(l.y+Math.PI/2)<.1?p.set(o.x-c,f,o.z):Math.abs(l.y-Math.PI/2)<.1&&p.set(o.x+c,f,o.z),t.position.copy(p),t.target=u,t.castShadow=!1,t.userData={paintingPosition:o.clone(),baseIntensity:1,maxIntensity:8,activationDistance:6,optimalDistance:2},n.add(t),n.add(t.target),Me.current.push(t),t},R=.05,L=.1,I=(u,t=2.5,o=2)=>{const l=new Fe,p=new Oe({color:1710618,metalness:.8,roughness:.2,clearcoat:.3,clearcoatRoughness:.1,emissive:657930,emissiveIntensity:.05}),f=[new B(t+L*2,L,R),new B(t+L*2,L,R),new B(L,o,R),new B(L,o,R)],c=[{x:0,y:(o+L)/2,z:R/2},{x:0,y:-(o+L)/2,z:R/2},{x:-(t+L)/2,y:0,z:R/2},{x:(t+L)/2,y:0,z:R/2}];return f.forEach((g,x)=>{const r=new E(g,p);r.position.set(c[x].x,c[x].y,c[x].z),r.castShadow=!1,r.receiveShadow=!1,l.add(r)}),l.add(u),l};A()},Y=(n,a)=>{const i=6*n,d=X.current,v=d.position.clone();(G.current.w||G.current.ArrowUp)&&a.moveForward(i),(G.current.s||G.current.ArrowDown)&&a.moveForward(-i),(G.current.d||G.current.ArrowRight)&&a.moveRight(i),(G.current.a||G.current.ArrowLeft)&&a.moveRight(-i),le(d)&&d.position.copy(v),d.position.y=1.6,Ye(d.position)},le=n=>{const a=n.position,i=14.5,d=30.5;return a.x>i||a.x<-i||a.z>d||a.z<-d},Ye=n=>{Me.current.forEach(a=>{const i=a.userData;if(!i||!i.paintingPosition)return;const d=n.distanceTo(i.paintingPosition);let v=i.baseIntensity;if(d<=i.activationDistance){const m=Math.max(0,(i.activationDistance-d)/i.activationDistance),h=i.maxIntensity-i.baseIntensity,j=Math.pow(m,1.5);v=i.baseIntensity+h*j,d<=i.optimalDistance&&(v=i.maxIntensity)}a.intensity=ye.lerp(a.intensity,v,.12)}),Ve(n)},Ve=n=>{const a=Pe.current;if(!a)return;let i=1/0;Le.current.forEach(v=>{const m=n.distanceTo(v.position);m<i&&(i=m)});const d=X.current;if(d){const v=new qe;d.getWorldDirection(v);const m=d.position.clone().add(v.multiplyScalar(10));a.target.position.copy(m),a.target.updateMatrixWorld()}if(i<=6){const m=3+Math.max(0,(6-i)/6)*12;a.intensity=ye.lerp(a.intensity,m,.1)}else a.intensity=ye.lerp(a.intensity,1.5,.1)},Re=()=>{const n=X.current;if(!n)return;const a={phase1:{duration:2500,startPos:{x:0,y:1.6,z:15},endPos:{x:0,y:1.6,z:12},startLookAt:{x:0,y:8,z:0},endLookAt:{x:0,y:8,z:0}},phase2:{duration:3e3,startPos:{x:0,y:1.6,z:12},endPos:{x:0,y:1.6,z:5},startLookAt:{x:0,y:8,z:0},endLookAt:{x:0,y:4,z:0}},phase3:{duration:2e3,startPos:{x:0,y:1.6,z:5},endPos:{x:0,y:1.6,z:0},startLookAt:{x:0,y:4,z:0},endLookAt:{x:0,y:1.6,z:-1}}};n.position.set(a.phase1.startPos.x,a.phase1.startPos.y,a.phase1.startPos.z),n.lookAt(a.phase1.startLookAt.x,a.phase1.startLookAt.y,a.phase1.startLookAt.z);let i=1,d=Date.now();const v=h=>{const j=Date.now()-d,A=Math.min(j/h.duration,1),H=A<.5?4*A*A*A:1-Math.pow(-2*A+2,3)/2;n.position.x=h.startPos.x+(h.endPos.x-h.startPos.x)*H,n.position.y=h.startPos.y+(h.endPos.y-h.startPos.y)*H,n.position.z=h.startPos.z+(h.endPos.z-h.startPos.z)*H;const Z={x:h.startLookAt.x+(h.endLookAt.x-h.startLookAt.x)*H,y:h.startLookAt.y+(h.endLookAt.y-h.startLookAt.y)*H,z:h.startLookAt.z+(h.endLookAt.z-h.startLookAt.z)*H};return n.lookAt(Z.x,Z.y,Z.z),A>=1},m=()=>{let h=!1;switch(i){case 1:h=v(a.phase1),h&&(i=2,d=Date.now());break;case 2:h=v(a.phase2),h&&(i=3,d=Date.now());break;case 3:if(h=v(a.phase3),h){be(!0),ae(!1),setTimeout(()=>{de(!0)},9e3),T.current&&(T.current.getObject().position.copy(n.position),T.current.connect=T.current.connect.__original||T.current.connect);return}break}Je.current=requestAnimationFrame(m)};m()};return(()=>{try{const n=new at;Xe.current=n,n.onLoad=()=>{requestAnimationFrame(()=>{$.current&&J.current&&X.current?($.current.render(J.current,X.current),requestAnimationFrame(()=>{setTimeout(()=>{Re()},300)})):setTimeout(()=>{Re()},500)})},n.onError=()=>{};const a=new st;a.background=new nt(1710618),J.current=a;const i=new ot(75,w.clientWidth/w.clientHeight,.1,1e3);i.position.set(0,1.6,0),X.current=i;const d=new De(16774374,6,15,Math.PI/5,.15,1.2);d.position.set(0,0,0),d.castShadow=!1;const v=new rt;d.target=v,i.add(d),a.add(v),a.add(i),Pe.current=d;const m=new it({antialias:!0,alpha:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1});if(m.setSize(w.clientWidth,w.clientHeight),m.setClearColor(15790320,1),m.shadowMap.enabled=!0,m.shadowMap.type=lt,m.outputColorSpace=Te,m.toneMapping=ct,m.toneMappingExposure=1,!m.getContext())throw new Error("WebGL context creation failed");w.appendChild(m.domElement),$.current=m;const j=new dt(i,m.domElement);a.add(j.getObject()),T.current=j,j.addEventListener("lock",()=>{ee(!0)}),j.addEventListener("unlock",()=>{ee(!1)});const A=j.connect;j.connect.__original=A,j.connect=()=>{U&&A.call(j)};const H=I=>{const u=new ht(6316128,1.2);I.add(u);const t=new Ce(16777215,.9);t.position.set(0,12,5),t.castShadow=!0,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024,t.shadow.camera.near=.5,t.shadow.camera.far=25,t.shadow.camera.left=-25,t.shadow.camera.right=25,t.shadow.camera.top=25,t.shadow.camera.bottom=-25,I.add(t);const o=new Ce(16777215,.2);return o.position.set(-10,8,-10),I.add(o),[u,t,o]},Z=I=>{const t=(()=>{const f=new B(12,12,.4),c=new ge({color:16777215,emissive:16777215,emissiveIntensity:2}),g=new E(f,c);g.position.set(0,3,31.8),I.add(g);const r=(()=>{const C=new ne(11,9),W="/gallery/Image_2025-08-11_154142_853.jpg",M=new Ee,b=new oe({color:4474111,emissive:2236996,emissiveIntensity:.3,transparent:!1,opacity:1,side:we}),N=new E(C,b);return N.position.set(0,3,32-.4-.02),N.rotation.y=Math.PI,N.name="BaguaAdvertisement",I.add(N),M.load(W,K=>{const F=new oe({map:K,emissive:2236962,emissiveIntensity:.25,transparent:!1,opacity:1,side:we});N.material=F},()=>{},()=>{}),N})();return[{pos:[0,3,32-.4-.8],intensity:1.8}].forEach(z=>{const k=new Ge(16777198,z.intensity,12);k.position.set(...z.pos),k.decay=1.8,I.add(k)}),{lightBox:g,lightboxAd:r}})();return{wallLightBox:t.lightBox,lightboxAd:t.lightboxAd}},R=()=>{const I=[];return[{start:{x:-3,z:2.25},end:{x:3,z:2.25},name:"王-上横"},{start:{x:-2.5,z:0},end:{x:2.5,z:0},name:"王-中横"},{start:{x:-3.5,z:-2.25},end:{x:3.5,z:-2.25},name:"王-下横"},{start:{x:0,z:2.25},end:{x:0,z:-2.25},name:"王-竖线"}].forEach(t=>{const o=Math.sqrt(Math.pow(t.end.x-t.start.x,2)+Math.pow(t.end.z-t.start.z,2));let l;t.name.includes("竖")?l=new B(.4,.2,o):l=new B(o,.2,.4);const p=new ge({color:16777215,emissive:16777215,emissiveIntensity:2,transparent:!1}),f=new E(l,p),c=(t.start.x+t.end.x)/2,g=(t.start.z+t.end.z)/2;f.position.set(c,6,g),a.add(f);const x=new Ge(16777215,7,45);x.position.set(c,5.5,g),a.add(x),I.push({tube:f,name:t.name})}),I};H(a),Z(a),R(),_(a),D(a,n);const L=()=>{ie.current=requestAnimationFrame(L);const I=Qe.current.getDelta();j.isLocked&&Y(I,j),m.render(a,i)};L(),ae(!1)}catch(n){throw ae(!1),n}})(),()=>{ie.current&&(cancelAnimationFrame(ie.current),ie.current=null),T.current&&(T.current.dispose(),T.current=null),J.current&&(J.current.traverse(n=>{n.geometry&&n.geometry.dispose(),n.material&&(Array.isArray(n.material)?n.material.forEach(a=>{a.map&&a.map.dispose(),a.normalMap&&a.normalMap.dispose(),a.roughnessMap&&a.roughnessMap.dispose(),a.dispose()}):(n.material.map&&n.material.map.dispose(),n.material.normalMap&&n.material.normalMap.dispose(),n.material.roughnessMap&&n.material.roughnessMap.dispose(),n.material.dispose()))}),J.current.clear(),J.current=null),$.current&&(w&&w.contains($.current.domElement)&&w.removeChild($.current.domElement),$.current.dispose(),$.current=null),X.current=null,ve.current=null}},[V,U,ee]),y.useEffect(()=>{const w=D=>{var le;const Y=D.code==="KeyW"?"w":D.code==="KeyA"?"a":D.code==="KeyS"?"s":D.code==="KeyD"?"d":D.key.toLowerCase();Y in G.current&&(G.current[Y]=!0),D.key==="Escape"&&((le=T.current)!=null&&le.isLocked)&&T.current.unlock()},_=D=>{const Y=D.code==="KeyW"?"w":D.code==="KeyA"?"a":D.code==="KeyS"?"s":D.code==="KeyD"?"d":D.key;Y in G.current&&(G.current[Y]=!1)};return document.addEventListener("keydown",w),document.addEventListener("keyup",_),()=>{document.removeEventListener("keydown",w),document.removeEventListener("keyup",_)}},[]),e.jsxs(e.Fragment,{children:[S&&he&&e.jsx("div",{className:"fixed inset-0 z-[99999] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center max-w-md border border-white/20",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("svg",{className:"w-16 h-16 text-yellow-400 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:P==="zh"?"移动端体验提示":"Mobile Experience Notice"}),e.jsx("p",{className:"text-white/80 leading-relaxed",children:P==="zh"?"3D 画廊采用第一人称漫游技术，需要键盘和鼠标操作，移动端体验可能不佳。建议使用桌面设备以获得最佳浏览效果。":"The 3D gallery uses first-person navigation technology requiring keyboard and mouse controls. For the best experience, Hua recommend using a desktop device."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>{ke(!1),$e(!0)},className:"w-full bg-theme-primary/20 hover:bg-theme-primary/30 text-theme-primary border border-theme-primary/30 hover:border-theme-primary/50 py-3 px-6 rounded-lg transition-all duration-300",children:P==="zh"?"继续浏览图片集":"View Image Gallery"}),e.jsx("p",{className:"text-white/60 text-sm",children:P==="zh"?"或在桌面设备上体验完整的 3D 画廊":"Or visit on desktop for the full 3D gallery experience"})]})]})}),S&&Ze&&e.jsx(_e,{language:P,texts:me}),!S&&e.jsxs("section",{id:"gallery",className:"min-h-screen flex flex-col justify-center items-center bg-gray-100 relative overflow-hidden",children:[(q||!U)&&e.jsx(ut,{size:160,strokeWidth:12,showMask:!0,maskColor:"black-solid"}),e.jsx("div",{ref:ue,className:`w-full h-screen relative bg-gray-200 ${q||!U?"invisible":"visible"}`,style:{minHeight:"100vh"}}),e.jsxs("div",{className:`absolute bottom-6 left-6 bg-black/50 backdrop-blur-md rounded-xl p-4 text-white z-20 max-w-sm transition-all duration-1000 ${!q&&U&&O&&!se?"opacity-100 translate-y-0":"opacity-0 translate-y-4 pointer-events-none"}`,children:[e.jsx("p",{className:"text-lg font-medium mb-3",children:P==="zh"?"如何操作？":"How to Play?"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("p",{className:"flex items-center",children:[e.jsx("span",{className:"w-2"}),P==="zh"?"点击进入长廊":"Click to enter the gallery"]}),e.jsxs("p",{className:"flex items-center",children:[e.jsx("span",{className:"w-2"}),P==="zh"?"鼠标 - 环视周围，探索画作":"Mouse - Look around and explore"]}),e.jsxs("p",{className:"flex items-center",children:[e.jsx("span",{className:"w-2"}),e.jsxs("span",{className:"inline-flex items-center gap-1 mr-2",children:[e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"W"}),e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"A"}),e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"S"}),e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 bg-white/20 rounded text-xs font-mono border border-white/30",children:"D"})]}),e.jsx("span",{children:P==="zh"?"移动穿行长廊":"Move through the gallery"})]}),e.jsxs("p",{className:"flex items-center",children:[e.jsx("span",{className:"w-2"}),e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 mr-2 bg-white/20 rounded text-xs font-mono border border-white/30",children:"ESC"}),e.jsx("span",{children:P==="zh"?"退出指针锁定模式":"Exit pointer lock mode"})]})]})]}),e.jsx("div",{className:`absolute inset-0 flex items-center justify-center cursor-pointer z-10 transition-all duration-1000 ${!q&&U&&O&&!se?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"}`,onClick:()=>{var w;if(!q&&U&&O&&!se)if((w=T.current)!=null&&w.lock)try{T.current.lock(),setTimeout(()=>{se||(console.log("Fallback: manually setting pointer locked state"),ee(!0))},100)}catch(_){console.log("Pointer lock failed, using fallback:",_.message),ee(!0)}else ee(!0)},children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-8 text-center transition-all duration-300 border border-white/20 hover:bg-white/20 hover:scale-105",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:((je=(Se=(ze=me[P])==null?void 0:ze.gallery)==null?void 0:Se.gallery3D)==null?void 0:je.title)||"浮生长廊"}),e.jsx("p",{className:"text-white/80 mb-6",children:((Ne=(Ie=(Ae=(We=me[P])==null?void 0:We.gallery)==null?void 0:Ae.gallery3D)==null?void 0:Ie.instructions)==null?void 0:Ne.clickToStart)||"点击进入"}),e.jsx("div",{className:"animate-bounce",children:e.jsxs("svg",{className:"w-8 h-8 text-white mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})}),se&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-20",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full shadow-lg border border-white/30"}),e.jsx("div",{className:"absolute w-6 h-0.5 bg-white/60 rounded shadow-sm"}),e.jsx("div",{className:"absolute w-0.5 h-6 bg-white/60 rounded shadow-sm"}),e.jsx("div",{className:"absolute w-8 h-8 border border-white/20 rounded-full"})]})]})]})};pt.propTypes={language:Ue.string};export{pt as default};
